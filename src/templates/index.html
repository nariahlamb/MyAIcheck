<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyAIcheck - AIæ¥å£å¯†é’¥éªŒè¯å·¥å…·</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ”‘</text></svg>" type="image/svg+xml">
    <style>
        :root {
            --primary-color: #f06292; /* ç²‰è‰²ä¸»è‰²è°ƒ */
            --primary-light: #ffb6c1; /* æµ…ç²‰è‰² */
            --primary-dark: #d81b60; /* æ·±ç²‰è‰² */
            --secondary-color: #9c27b0; /* ç´«è‰²è¾…åŠ©è‰² */
            --accent-color: #64b5f6; /* è“è‰²å¼ºè°ƒè‰² */
            --success-color: #66bb6a; /* ç»¿è‰²æˆåŠŸæç¤º */
            --error-color: #ef5350; /* çº¢è‰²é”™è¯¯æç¤º */
            --warning-color: #ffca28; /* é»„è‰²è­¦å‘Šæç¤º */
            --bg-color: #fce4ec; /* ç²‰è‰²èƒŒæ™¯ */
            --bg-gradient: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%); /* æ¸å˜èƒŒæ™¯ */
            --card-bg: #ffffff; /* å¡ç‰‡èƒŒæ™¯ */
            --text-color: #424242; /* æ–‡æœ¬é¢œè‰² */
            --text-light: #757575; /* æµ…è‰²æ–‡æœ¬ */
            --border-color: #f8bbd0; /* è¾¹æ¡†é¢œè‰² */
            --border-radius: 15px; /* åœ†è§’åŠå¾„ */
            --box-shadow: 0 4px 20px rgba(236, 64, 122, 0.1); /* é˜´å½±æ•ˆæœ */
            --font-family: 'Helvetica Neue', Arial, sans-serif;
            --transition: all 0.3s ease;
        }
        
        /* æš—è‰²æ¨¡å¼å˜é‡ */
        .dark-mode {
            --primary-color: #88C0D0; /* Nordè“è‰²è°ƒ */
            --primary-light: #8FBCBB; /* Nordæµ…è“ */
            --primary-dark: #5E81AC; /* Nordæ·±è“ */
            --secondary-color: #B48EAD; /* Nordç´«è‰² */
            --accent-color: #81A1C1; /* Nordäº®è“ */
            --success-color: #A3BE8C; /* Nordç»¿è‰² */
            --error-color: #BF616A; /* Nordçº¢è‰² */
            --warning-color: #EBCB8B; /* Nordé»„è‰² */
            --bg-color: #2E3440; /* Nordæœ€æ·±èƒŒæ™¯ */
            --bg-gradient: linear-gradient(135deg, #2E3440 0%, #3B4252 100%); /* Nordæ¸å˜èƒŒæ™¯ */
            --card-bg: #3B4252; /* Nordæ¬¡æ·±èƒŒæ™¯ */
            --text-color: #ECEFF4; /* Nordé›ªç™½ */
            --text-light: #E5E9F0; /* Nordæµ…é›ªç™½ */
            --border-color: #4C566A; /* Nordæµ…ç°è‰² */
            --box-shadow: 0 4px 20px rgba(46, 52, 64, 0.5); /* é˜´å½±æ•ˆæœ */
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: var(--font-family);
            line-height: 1.5; /* å‡å°è¡Œé«˜ */
            color: var(--text-color);
            background: var(--bg-gradient);
            min-height: 100vh;
            padding: 10px 0; /* è¿›ä¸€æ­¥å‡å°ä¸Šä¸‹å†…è¾¹è· */
        }
        
        .container {
            max-width: 1400px; /* å¢åŠ å®½åº¦ */
            margin: 0 auto;
            padding: 0 10px; /* å‡å°å·¦å³å†…è¾¹è· */
        }
        
        header {
            text-align: center;
            margin-bottom: 1rem; /* å‡å°ä¸‹è¾¹è· */
            animation: fadeIn 1s ease;
        }
        
        h1 {
            font-size: 2.2rem; /* å‡å°å­—ä½“å¤§å° */
            margin-bottom: 0.5rem; /* å‡å°ä¸‹è¾¹è· */
            color: var(--primary-dark);
            font-weight: 600;
            letter-spacing: -0.5px;
        }
        
        .description {
            color: var(--text-light);
            margin-bottom: 0.8rem; /* å‡å°ä¸‹è¾¹è· */
            font-size: 1rem; /* å‡å°å­—ä½“å¤§å° */
        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 15px; /* å‡å°å†…è¾¹è· */
            margin-bottom: 1rem; /* å‡å°ä¸‹è¾¹è· */
            animation: slideUp 0.5s ease;
            border: 1px solid var(--border-color);
        }
        
        .api-type-selector {
            display: flex;
            flex-wrap: nowrap; /* ç¡®ä¿åœ¨ä¸€è¡Œæ˜¾ç¤º */
            gap: 8px; /* å‡å°é—´è· */
            margin-bottom: 15px;
            justify-content: center;
        }
        
        .api-type-btn {
            padding: 10px 15px; /* å‡å°å†…è¾¹è· */
            border: 2px solid var(--primary-light);
            background-color: white;
            color: var(--primary-dark);
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            font-size: 0.95rem; /* å‡å°å­—ä½“å¤§å° */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
            white-space: nowrap; /* é˜²æ­¢æ–‡æœ¬æ¢è¡Œ */
        }
        
        .api-type-btn::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: linear-gradient(rgba(255,255,255,0.2), transparent);
            pointer-events: none;
        }
        
        .api-type-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(240, 98, 146, 0.2);
        }
        
        .api-type-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 5px 15px rgba(240, 98, 146, 0.3);
        }
        
        .api-settings {
            margin: 15px 0; /* å‡å°ä¸Šä¸‹è¾¹è· */
            padding: 12px; /* å‡å°å†…è¾¹è· */
            border-radius: 10px;
            background-color: #fff5f8;
            border: 1px dashed var(--primary-light);
            animation: fadeIn 0.5s ease;
        }
        
        .custom-settings {
            display: none;
            background-color: #f3e5f5;
            border-color: #ce93d8;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .model-select-container {
            margin-top: 10px; /* å‡å°ä¸Šè¾¹è· */
        }
        
        .model-select {
            width: 100%;
            padding: 10px; /* å‡å°å†…è¾¹è· */
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95rem; /* å‡å°å­—ä½“å¤§å° */
            color: var(--text-color);
            transition: var(--transition);
            background-color: white;
            margin-top: 5px; /* å‡å°ä¸Šè¾¹è· */
        }
        
        .model-select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(240, 98, 146, 0.2);
        }
        
        .input-group {
            margin-bottom: 1rem; /* å‡å°ä¸‹è¾¹è· */
        }
        
        .custom-input {
            width: 100%;
            padding: 10px; /* å‡å°å†…è¾¹è· */
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            color: var(--text-color);
            transition: var(--transition);
            background-color: white;
        }
        
        .custom-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(240, 98, 146, 0.2);
        }
        
        .custom-input::placeholder {
            color: #bdbdbd;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--primary-dark);
        }
        
        .toggle-container {
            display: flex;
            align-items: center;
            margin-bottom: 15px; /* å‡å°ä¸‹è¾¹è· */
            background-color: #fff5f8;
            padding: 10px 15px;
            border-radius: 8px;
        }
        
        .toggle-label {
            margin-right: 15px;
            font-weight: 500;
            color: var(--primary-dark);
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 54px;
            height: 28px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f8bbd0;
            transition: var(--transition);
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        .help-text {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-left: 10px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-color);
        }
        
        .tab {
            padding: 12px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            transition: var(--transition);
            color: var(--text-light);
            position: relative;
        }
        
        .tab::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 3px;
            background-color: var(--primary-color);
            transition: var(--transition);
        }
        
        .tab.active {
            color: var(--primary-color);
        }
        
        .tab.active::after {
            width: 100%;
        }
        
        .tab:hover:not(.active) {
            color: var(--primary-dark);
        }
        
        textarea {
            width: 100%;
            min-height: 100px; /* å‡å°æ–‡æœ¬æ¡†é«˜åº¦ */
            padding: 10px; /* å‡å°å†…è¾¹è· */
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95rem; /* å‡å°å­—ä½“å¤§å° */
            resize: vertical;
            transition: var(--transition);
        }
        
        textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(240, 98, 146, 0.2);
        }
        
        .file-input-container {
            position: relative;
            margin-top: 10px;
        }
        
        .file-input-label {
            display: inline-block;
            padding: 12px 20px;
            background-color: #f8bbd0;
            color: var(--primary-dark);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }
        
        .file-input-label:hover {
            background-color: var(--primary-light);
        }
        
        .file-input-label i {
            margin-right: 8px;
        }
        
        .file-input {
            position: absolute;
            left: -9999px;
        }
        
        .file-name {
            margin-top: 8px;
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .actions-container {
            display: flex;
            gap: 8px; /* å‡å°æŒ‰é’®é—´éš” */
            margin-top: 1rem; /* å‡å°ä¸Šè¾¹è· */
            flex-wrap: wrap;
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px; /* å‡å°å†…è¾¹è· */
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.95rem; /* å‡å°å­—ä½“å¤§å° */
            font-weight: 500;
            text-align: center;
            transition: var(--transition);
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: linear-gradient(rgba(255,255,255,0.2), transparent);
            pointer-events: none;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(240, 98, 146, 0.3);
        }
        
        .btn-secondary {
            background-color: #f8bbd0;
            color: var(--primary-dark);
        }
        
        .btn-secondary:hover {
            background-color: var(--primary-light);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(240, 98, 146, 0.2);
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #43a047;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(102, 187, 106, 0.3);
        }
        
        .btn-pause {
            background-color: var(--warning-color);
            color: #5d4037;
        }
        
        .btn-pause:hover {
            background-color: #ffb300;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.3);
        }
        
        .progress {
            margin-top: 1rem; /* å‡å°ä¸Šè¾¹è· */
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--primary-dark);
            font-weight: 500;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 12px;
            background-color: #f8bbd0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-light), var(--primary-color));
            transition: width 0.3s ease;
            width: 0%;
            border-radius: 6px;
        }
        
        .dark-mode .progress-bar-container {
            background-color: #4C566A;
        }
        
        .dark-mode .progress-bar {
            background: linear-gradient(90deg, #81A1C1, #5E81AC);
        }
        
        .dark-mode .progress-info,
        .dark-mode .progress-stats {
            color: #E5E9F0;
        }
        
        .progress-stats {
            margin-top: 12px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .progress-control {
            margin-top: 12px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .results-container {
            margin-top: 2.5rem;
            display: none;
            animation: slideUp 0.5s ease;
        }
        
        .results-heading {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .results-heading h2 {
            color: var(--primary-dark);
            font-size: 1.6rem;
            margin: 0;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
        }
        
        .results-summary {
            display: flex;
            gap: 20px;
            margin-bottom: 2rem;
        }
        
        .summary-item {
            flex: 1;
            padding: 18px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.07);
            transition: var(--transition);
        }
        
        .summary-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .summary-total {
            background-color: #e1f5fe;
            border: 1px solid #b3e5fc;
        }
        
        .summary-valid {
            background-color: #e8f5e9;
            border: 1px solid #c8e6c9;
            color: var(--success-color);
        }
        
        .summary-invalid {
            background-color: #ffebee;
            border: 1px solid #ffcdd2;
            color: var(--error-color);
        }
        
        .summary-item h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .summary-item p {
            font-size: 2.5rem;
            margin: 15px 0 0;
            font-weight: 600;
        }
        
        .results-table-container {
            overflow-x: auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #f8bbd0;
            border-radius: 8px;
            overflow: hidden;
            table-layout: fixed; /* ä¸ºå®½å±ä¼˜åŒ–è¡¨æ ¼å¸ƒå±€ */
        }
        
        .results-table th, .results-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #f8bbd0;
        }
        
        .results-table th {
            background-color: #fce4ec;
            color: var(--primary-dark);
            font-weight: 600;
        }
        
        .results-table tr:nth-child(even) {
            background-color: #fff9fb;
        }
        
        .results-table tr:hover {
            background-color: #fce4ec;
        }
        
        .results-table th:nth-child(1),
        .results-table td:nth-child(1) {
            width: 30%; /* å¯†é’¥åˆ—å®½åº¦ */
            word-break: break-all;
        }
        
        .results-table th:nth-child(2),
        .results-table td:nth-child(2) {
            width: 15%; /* çŠ¶æ€åˆ—å®½åº¦ */
        }
        
        .results-table th:nth-child(3),
        .results-table td:nth-child(3) {
            width: 55%; /* é”™è¯¯ä¿¡æ¯åˆ—å®½åº¦ */
            word-break: break-word;
        }
        
        .valid-key {
            color: var(--success-color);
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        .valid-key::before {
            content: 'âœ“';
            margin-right: 5px;
        }
        
        .invalid-key {
            color: var(--error-color);
            font-weight: 500;
            display: flex;
            align-items: center;
        }
        
        .invalid-key::before {
            content: 'âœ—';
            margin-right: 5px;
        }
        
        .network-error {
            color: var(--warning-color);
            font-weight: 500;
            display: flex;
            align-items: center;
        }
        
        .network-error::before {
            content: '!';
            margin-right: 5px;
        }
        
        /* å®½å±é€‚é…çš„ä¸¤åˆ—å¸ƒå±€ */
        @media (min-width: 1200px) {
            .two-column-layout {
                display: flex;
                gap: 20px; /* å‡å°ä¸¤åˆ—é—´éš” */
                align-items: flex-start;
            }
            
            .input-column {
                flex: 0.6; /* ç¼©å°è¾“å…¥åŒºåŸŸçš„æ¯”ä¾‹ */
            }
            
            .results-column {
                flex: 0.4; /* å¢å¤§ç»“æœåŒºåŸŸçš„æ¯”ä¾‹ */
                margin-top: 0;
            }
            
            .results-container {
                margin-top: 0;
            }
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        @keyframes slideUp {
            0% { 
                opacity: 0; 
                transform: translateY(20px);
            }
            100% { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @media (max-width: 768px) {
            .results-summary {
                flex-direction: column;
                gap: 15px;
            }
            
            .api-type-selector {
                flex-direction: column;
                align-items: stretch;
            }
            
            .actions-container {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .results-heading {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .export-buttons {
                width: 100%;
                justify-content: space-between;
            }
        }
        
        .results-table tr:hover {
            background-color: #fce4ec;
        }
        
        .dark-mode .results-table th {
            background-color: #434C5E;
            color: #ECEFF4;
        }
        
        .dark-mode .results-table {
            border-color: #4C566A;
        }
        
        .dark-mode .results-table td {
            border-bottom-color: #4C566A;
        }
        
        .dark-mode .results-table tr:nth-child(even) {
            background-color: #3B4252;
        }
        
        .dark-mode .results-table tr:hover {
            background-color: #4C566A;
        }
        
        /* æš—è‰²æ¨¡å¼ä¸‹çš„æŒ‰é’®æ ·å¼ä¼˜åŒ– */
        .dark-mode .btn-primary {
            background-color: #5E81AC;
            color: #ECEFF4;
        }
        
        .dark-mode .btn-primary:hover {
            background-color: #81A1C1;
        }
        
        .dark-mode .btn-secondary {
            background-color: #4C566A;
            color: #E5E9F0;
        }
        
        .dark-mode .btn-secondary:hover {
            background-color: #5E81AC;
        }
        
        .dark-mode .btn-success {
            background-color: #A3BE8C;
            color: #2E3440;
        }
        
        .dark-mode .btn-success:hover {
            background-color: #8FBCBB;
        }
        
        .dark-mode .btn-pause {
            background-color: #EBCB8B;
            color: #2E3440;
        }
        
        .dark-mode .btn-pause:hover {
            background-color: #D08770;
        }
        
        .dark-mode .api-type-btn {
            border-color: #4C566A;
            background-color: #3B4252;
            color: #E5E9F0;
        }
        
        .dark-mode .api-type-btn.active {
            background-color: #5E81AC;
            color: #ECEFF4;
            border-color: #5E81AC;
        }
        
        .dark-mode .api-type-btn:hover {
            box-shadow: 0 5px 15px rgba(136, 192, 208, 0.3);
        }
        
        .results-table th:nth-child(1),
        .results-table td:nth-child(1) {
            width: 30%; /* å¯†é’¥åˆ—å®½åº¦ */
            word-break: break-all;
        }
        
        /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’®æ ·å¼ */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: var(--card-bg);
            border-radius: 50%;
            box-shadow: var(--box-shadow);
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--border-color);
        }
        
        .theme-toggle:hover {
            transform: translateY(-2px) rotate(15deg);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        
        .theme-toggle-icon {
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        /* èŠ‚ç‚¹ä¿¡æ¯æŒ‰é’®æ ·å¼ */
        .node-toggle {
            position: fixed;
            top: 20px;
            right: 70px;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: var(--card-bg);
            border-radius: 50%;
            box-shadow: var(--box-shadow);
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--border-color);
        }
        
        .node-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        
        .node-toggle-icon {
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        /* èŠ‚ç‚¹ä¿¡æ¯åŒºåŸŸæ ·å¼ */
        .node-info {
            position: fixed;
            top: 70px;
            right: 20px;
            width: 300px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 15px;
            z-index: 1000;
            border: 1px solid var(--border-color);
            max-height: 500px;
            overflow-y: auto;
            display: none;
        }
        
        .node-info.visible {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .node-info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .node-info-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin: 0;
        }
        
        .node-info-refresh {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-light);
            color: var(--card-bg);
            cursor: pointer;
            border: none;
            font-size: 1.2rem;
            transition: var(--transition);
        }
        
        .node-info-refresh:hover {
            transform: rotate(180deg);
            background-color: var(--primary-color);
        }
        
        .node-info-item {
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .node-info-label {
            font-weight: 500;
            color: var(--primary-color);
            margin-right: 5px;
        }
        
        .node-info-value {
            color: var(--text-color);
            word-break: break-all;
        }
        
        .node-info-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            color: var(--text-light);
        }
        
        /* æŒ‰é’®æ ‡å¿— */
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-left: 5px;
            vertical-align: middle;
        }
        
        .badge-warning {
            background-color: var(--warning-color);
            color: #5d4037;
        }
        
        .badge-info {
            background-color: var(--accent-color);
            color: white;
        }
        
        /* æš—è‰²æ¨¡å¼ä¸‹çš„æ–‡æœ¬è¾“å…¥å’Œé€‰æ‹©æ¡†æ ·å¼ */
        .dark-mode .custom-input,
        .dark-mode .model-select,
        .dark-mode textarea {
            background-color: #434C5E;
            color: #E5E9F0;
            border-color: #4C566A;
        }
        
        .dark-mode .custom-input::placeholder,
        .dark-mode textarea::placeholder {
            color: #D8DEE9;
        }
        
        .dark-mode .toggle-label,
        .dark-mode .input-group label,
        .dark-mode .tab,
        .dark-mode .toggle-container {
            color: #E5E9F0;
        }
        
        .dark-mode .toggle-container {
            background-color: #3B4252;
        }
        
        .dark-mode .tab.active {
            color: #88C0D0;
        }
        
        .dark-mode .tab::after {
            background-color: #88C0D0;
        }
        
        .dark-mode .api-settings {
            background-color: #3B4252;
            border-color: #4C566A;
        }
        
        .dark-mode .custom-settings {
            background-color: #2E3440;
            border-color: #4C566A;
        }
        
        .dark-mode .file-input-label {
            background-color: #4C566A;
            color: #E5E9F0;
        }
        
        .dark-mode .file-input-label:hover {
            background-color: #5E81AC;
        }
        
        .dark-mode .file-name {
            color: #D8DEE9;
        }
        
        /* æš—è‰²æ¨¡å¼ä¸‹çš„èŠ‚ç‚¹ä¿¡æ¯æ ·å¼ */
        .dark-mode .node-info {
            background-color: #3B4252;
            border-color: #4C566A;
        }
        
        .dark-mode .node-info-title {
            color: #88C0D0;
        }
        
        .dark-mode .node-info-refresh {
            background-color: #5E81AC;
            color: #ECEFF4;
        }
        
        .dark-mode .node-info-refresh:hover {
            background-color: #81A1C1;
        }
        
        .dark-mode .node-info-label {
            color: #88C0D0;
        }
        
        .dark-mode .node-info-value {
            color: #E5E9F0;
        }
        
        .dark-mode .node-toggle-icon,
        .dark-mode .theme-toggle-icon {
            color: #88C0D0;
        }
        
        .dark-mode .node-toggle,
        .dark-mode .theme-toggle {
            background-color: #3B4252;
            border-color: #4C566A;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>MyAIcheck</h1>
            <p class="description">ä¸€ç«™å¼AIæ¥å£å¯†é’¥éªŒè¯å·¥å…· | æ”¯æŒOpenAIã€Claudeã€Geminiç­‰å¤šå¹³å°</p>
        </header>
        
        <!-- æš—è‰²æ¨¡å¼åˆ‡æ¢æŒ‰é’® -->
        <div class="theme-toggle" id="theme-toggle">
            <span class="theme-toggle-icon">ğŸŒ™</span>
        </div>
        
        <!-- èŠ‚ç‚¹ä¿¡æ¯æŒ‰é’® -->
        <div class="node-toggle" id="node-toggle">
            <span class="node-toggle-icon">ğŸ“¶</span>
        </div>
        
        <!-- èŠ‚ç‚¹ä¿¡æ¯åŒºåŸŸ -->
        <div class="node-info" id="node-info">
            <div class="node-info-header">
                <h3 class="node-info-title">èŠ‚ç‚¹ä¿¡æ¯</h3>
                <button class="node-info-refresh" id="refresh-node-info">
                    â†»
                </button>
            </div>
            <div id="node-info-content">
                <div class="node-info-loading">æ­£åœ¨è·å–èŠ‚ç‚¹ä¿¡æ¯...</div>
            </div>
        </div>
        
        <div class="two-column-layout">
            <div class="input-column">
                <div class="card">
                    <div class="api-type-selector">
                        <button class="api-type-btn active" data-api-type="openai">OpenAI</button>
                        <button class="api-type-btn" data-api-type="claude">Claude</button>
                        <button class="api-type-btn" data-api-type="gemini">Gemini</button>
                        <button class="api-type-btn" data-api-type="deepseek">Deepseek</button>
                        <button class="api-type-btn" data-api-type="xai">XAI (Grok)</button>
                        <button class="api-type-btn" data-api-type="openai_like">è‡ªå®šä¹‰</button>
                    </div>
                    
                    <div class="toggle-container">
                        <span class="toggle-label">ä½¿ç”¨æµè§ˆå™¨ç«¯éªŒè¯:</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="client-side-toggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="help-text">æ¨èå¯ç”¨ï¼Œè§£å†³ç½‘ç»œè¿æ¥é—®é¢˜</span>
                    </div>
                    
                    <div class="api-settings" id="openai-settings">
                        <p><strong>éªŒè¯ OpenAI API å¯†é’¥</strong> - æ ¼å¼: sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</p>
                        <div class="model-select-container">
                            <label for="openai-model">é€‰æ‹©æ¨¡å‹:</label>
                            <select id="openai-model" class="model-select">
                                <option value="gpt-4o-2024-05-13">GPT-4o</option>
                                <option value="gpt-4o-mini">GPT-4o-mini</option>
                                <option value="gpt-4-turbo">GPT-4 Turbo</option>
                                <option value="gpt-4">GPT-4</option>
                                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                                <option value="gpt-o1-preview">GPT-o1 Preview</option>
                                <option value="gpt-o1-mini-preview">GPT-o1 Mini Preview</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="api-settings" id="claude-settings" style="display: none;">
                        <p><strong>éªŒè¯ Claude API å¯†é’¥</strong></p>
                        <div class="model-select-container">
                            <label for="claude-model">é€‰æ‹©æ¨¡å‹:</label>
                            <select id="claude-model" class="model-select">
                                <option value="claude-opus-4-20250514">Claude 4 Opus</option>
                                <option value="claude-sonnet-4-20250514">Claude 4 Sonnet</option>
                                <option value="claude-3-7-sonnet-20250219">Claude 3.7 Sonnet</option>
                                <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                                <option value="claude-3-5-haiku-20241022">Claude 3.5 Haiku</option>
                                <option value="claude-3-opus-20240229">Claude 3 Opus</option>
                                <option value="claude-3-sonnet-20240229">Claude 3 Sonnet</option>
                                <option value="claude-3-haiku-20240307">Claude 3 Haiku</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="api-settings" id="gemini-settings" style="display: none;">
                        <p><strong>éªŒè¯ Gemini API å¯†é’¥</strong></p>
                        <div class="model-select-container">
                            <label for="gemini-model">é€‰æ‹©æ¨¡å‹:</label>
                            <select id="gemini-model" class="model-select">
                                <option value="gemini-2.5-pro-preview-05-06">Gemini 2.5 Pro</option>
                                <option value="gemini-2.5-flash-preview-05-20">Gemini 2.5 Flash</option>
                                <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                                <option value="gemini-2.0-flash-lite">Gemini 2.0 Flash-Lite</option>
                                <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                                <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="api-settings" id="deepseek-settings" style="display: none;">
                        <p><strong>éªŒè¯ Deepseek API å¯†é’¥</strong></p>
                        <div class="model-select-container">
                            <label for="deepseek-model">é€‰æ‹©æ¨¡å‹:</label>
                            <select id="deepseek-model" class="model-select">
                                <option value="deepseek-v3-0324">DeepSeek V3</option>
                                <option value="deepseek-v2.5-1210">DeepSeek V2.5</option>
                                <option value="deepseek-reasoner">DeepSeek Reasoner</option>
                                <option value="deepseek-chat">DeepSeek Chat</option>
                                <option value="deepseek-coder">DeepSeek Coder</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="api-settings" id="xai-settings" style="display: none;">
                        <p><strong>éªŒè¯ XAI (Grok) API å¯†é’¥</strong></p>
                        <div class="model-select-container">
                            <label for="xai-model">é€‰æ‹©æ¨¡å‹:</label>
                            <select id="xai-model" class="model-select">
                                <option value="grok-3">Grok-3</option>
                                <option value="grok-2">Grok-2</option>
                                <option value="grok-1.5">Grok-1.5</option>
                                <option value="grok-1">Grok-1</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="api-settings" id="openai_like-settings" style="display: none;">
                        <p><strong>éªŒè¯ç±» OpenAI API å¯†é’¥</strong> - å¦‚ç¡…åŸºæµåŠ¨ã€ç«å±±å¼•æ“ç­‰å…¼å®¹ OpenAI çš„å¹³å°</p>
                        <div class="custom-settings" style="display: block;">
                            <div class="input-group">
                                <label for="custom-api-url">API åŸºç¡€ URL (å¿…é¡»ä»¥ /v1 ç»“å°¾):</label>
                                <input type="text" id="custom-api-url" class="custom-input" placeholder="ä¾‹å¦‚: https://api.example.com/v1" />
                            </div>
                            <div class="input-group">
                                <label for="custom-model-name">æ¨¡å‹åç§°:</label>
                                <input type="text" id="custom-model-name" class="custom-input" placeholder="ä¾‹å¦‚: llama-7b" />
                            </div>
                        </div>
                    </div>
                    
                    <div class="tabs">
                        <div class="tab active" data-tab="text-input">æ–‡æœ¬è¾“å…¥</div>
                        <div class="tab" data-tab="file-input">æ–‡ä»¶è¾“å…¥</div>
                    </div>
                    
                    <div class="input-group" id="text-input-container">
                        <label for="keys-input">API å¯†é’¥ (æ¯è¡Œä¸€ä¸ª):</label>
                        <textarea id="keys-input" placeholder="åœ¨æ­¤è¾“å…¥æ‚¨çš„APIå¯†é’¥ï¼Œæ¯è¡Œä¸€ä¸ª..."></textarea>
                    </div>
                    
                    <div class="input-group" id="file-input-container" style="display: none;">
                        <label for="file-input">ä¸Šä¼  CSV æˆ–æ–‡æœ¬æ–‡ä»¶:</label>
                        <div class="file-input-container">
                            <label for="file-input" class="file-input-label">
                                é€‰æ‹©æ–‡ä»¶
                            </label>
                            <input type="file" id="file-input" class="file-input" accept=".csv,.txt">
                            <div class="file-name" id="file-name">æœªé€‰æ‹©æ–‡ä»¶</div>
                        </div>
                        <p class="help-text">æ–‡ä»¶ç¬¬ä¸€åˆ—åº”åŒ…å«APIå¯†é’¥</p>
                    </div>
                    
                    <div class="actions-container">
                        <button id="validate-btn" class="btn btn-primary">éªŒè¯å¯†é’¥</button>
                        <button id="clear-btn" class="btn btn-secondary">æ¸…é™¤</button>
                    </div>
                    
                    <div class="progress" id="progress-container">
                        <div class="progress-info">
                            <span id="progress-text">éªŒè¯ä¸­...</span>
                            <span id="progress-percentage">0%</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="progress-bar"></div>
                        </div>
                        <div class="progress-stats">
                            <span id="validated-count">å·²éªŒè¯: 0/0</span>
                            <span id="valid-progress">æœ‰æ•ˆ: 0</span>
                            <span id="invalid-progress">æ— æ•ˆ: 0</span>
                            <span id="error-progress">é”™è¯¯: 0</span>
                            <span id="time-remaining">é¢„è®¡å‰©ä½™æ—¶é—´: è®¡ç®—ä¸­...</span>
                        </div>
                        <div class="progress-control">
                            <button id="pause-btn" class="btn btn-pause">æš‚åœ</button>
                            <button id="cancel-btn" class="btn btn-secondary">å–æ¶ˆ</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="results-column">
                <div class="results-container" id="results-container">
                    <div class="results-heading">
                        <h2>éªŒè¯ç»“æœ</h2>
                        <div class="export-buttons">
                            <button id="export-valid-results-btn" class="btn btn-success">å¯¼å‡ºæœ‰æ•ˆå¯†é’¥</button>
                            <button id="export-all-results-btn" class="btn btn-secondary">å¯¼å‡ºæ‰€æœ‰ç»“æœ</button>
                        </div>
                    </div>
                    
                    <div class="results-summary">
                        <div class="summary-item summary-total">
                            <h3>æ€»è®¡</h3>
                            <p id="total-count">0</p>
                        </div>
                        <div class="summary-item summary-valid">
                            <h3>æœ‰æ•ˆ</h3>
                            <p id="valid-count">0</p>
                        </div>
                        <div class="summary-item summary-invalid">
                            <h3>æ— æ•ˆ</h3>
                            <p id="invalid-count">0</p>
                        </div>
                    </div>
                    
                    <div class="results-table-container">
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>å¯†é’¥</th>
                                    <th>çŠ¶æ€</th>
                                    <th>é”™è¯¯ä¿¡æ¯</th>
                                </tr>
                            </thead>
                            <tbody id="results-body">
                                <!-- ç»“æœä¼šè¢«åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // å…¨å±€å˜é‡
        let currentApiType = 'openai';
        let validationResults = [];
        let isClientSideValidation = true;
        let isValidating = false;
        let isPaused = false;
        let validationQueue = [];
        let currentBatchIndex = 0;
        let validationStats = {
            valid: 0,
            invalid: 0,
            error: 0
        };
        let startTime = null;
        let validationController = null; // AbortControllerç”¨äºå–æ¶ˆéªŒè¯
        let isDarkMode = false; // æš—è‰²æ¨¡å¼çŠ¶æ€
        let nodeInfoVisible = false; // èŠ‚ç‚¹ä¿¡æ¯æ˜¾ç¤ºçŠ¶æ€
        
        // APIéªŒè¯ç«¯ç‚¹é…ç½®
        const API_ENDPOINTS = {
            openai: {
                models: 'https://api.openai.com/v1/models',
                completions: 'https://api.openai.com/v1/chat/completions',
                payload: function(model) {
                    return {
                        model: model || 'gpt-3.5-turbo',
                        messages: [{ role: 'user', content: 'Hello' }],
                        max_tokens: 1
                    };
                }
            },
            claude: {
                models: 'https://api.anthropic.com/v1/models',
                completions: 'https://api.anthropic.com/v1/messages',
                payload: function(model) {
                    return {
                        model: model || 'claude-3-5-sonnet',
                        max_tokens: 1,
                        messages: [{ role: 'user', content: 'Hello' }]
                    };
                }
            },
            gemini: {
                models: 'https://generativelanguage.googleapis.com/v1beta/models',
                completions: 'https://generativelanguage.googleapis.com/v1beta/models/MODEL_NAME:generateContent',
                payload: function() {
                    return {
                        contents: [{ parts: [{ text: 'Hello' }] }]
                    };
                }
            },
            deepseek: {
                models: 'https://api.deepseek.com/v1/models',
                completions: 'https://api.deepseek.com/v1/chat/completions',
                payload: function(model) {
                    return {
                        model: model || 'deepseek-chat',
                        messages: [{ role: 'user', content: 'Hello' }],
                        max_tokens: 1
                    };
                }
            },
            xai: {
                models: 'https://api.xai.com/v1/models',
                completions: 'https://api.xai.com/v1/chat/completions',
                payload: function(model) {
                    return {
                        model: model || 'grok-1',
                        messages: [{ role: 'user', content: 'Hello' }],
                        max_tokens: 1
                    };
                }
            },
            // openai_like é…ç½®å°†åœ¨è¿è¡Œæ—¶åŠ¨æ€è®¾ç½®
            openai_like: {
                models: '', // ç”±ç”¨æˆ·æä¾›
                completions: '', // å°†åŸºäºmodels URLæ„å»º
                payload: function(model) {
                    return {
                        model: model || '', // ç”±ç”¨æˆ·æä¾›
                        messages: [{ role: 'user', content: 'Hello' }],
                        max_tokens: 1
                    };
                }
            }
        };
        
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½ä¸»é¢˜è®¾ç½®
            loadThemePreference();
            
            // åˆ‡æ¢APIç±»å‹
            document.querySelectorAll('.api-type-btn').forEach(button => {
                button.addEventListener('click', function() {
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    document.querySelectorAll('.api-type-btn').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // æ›´æ–°å½“å‰APIç±»å‹
                    currentApiType = this.dataset.apiType;
                    
                    // æ›´æ–°è®¾ç½®æ˜¾ç¤º
                    document.querySelectorAll('.api-settings').forEach(setting => setting.style.display = 'none');
                    document.getElementById(`${currentApiType}-settings`).style.display = 'block';
                });
            });
            
            // åˆ‡æ¢è¾“å…¥æ–¹å¼
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const tabName = this.dataset.tab;
                    document.getElementById('text-input-container').style.display = tabName === 'text-input' ? 'block' : 'none';
                    document.getElementById('file-input-container').style.display = tabName === 'file-input' ? 'block' : 'none';
                });
            });
            
            // æ–‡ä»¶é€‰æ‹©æ›´æ–°æ˜¾ç¤ºæ–‡ä»¶å
            document.getElementById('file-input').addEventListener('change', function(e) {
                const fileName = e.target.files.length > 0 ? e.target.files[0].name : 'æœªé€‰æ‹©æ–‡ä»¶';
                document.getElementById('file-name').textContent = fileName;
            });
            
            // éªŒè¯æŒ‰é’®
            document.getElementById('validate-btn').addEventListener('click', startValidation);
            
            // æ¸…é™¤æŒ‰é’®
            document.getElementById('clear-btn').addEventListener('click', function() {
                document.getElementById('keys-input').value = '';
                document.getElementById('file-input').value = '';
                document.getElementById('file-name').textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
                document.getElementById('results-container').style.display = 'none';
                document.getElementById('progress-container').style.display = 'none';
                validationResults = [];
                // ç¦ç”¨å¯¼å‡ºæŒ‰é’®
                document.getElementById('export-valid-results-btn').disabled = true;
                document.getElementById('export-all-results-btn').disabled = true;
            });
            
            // ç»“æœåŒºåŸŸå¯¼å‡ºæŒ‰é’®
            document.getElementById('export-valid-results-btn').addEventListener('click', function() {
                exportResults('valid');
            });
            
            document.getElementById('export-all-results-btn').addEventListener('click', function() {
                exportResults('all');
            });
            
            // å®¢æˆ·ç«¯éªŒè¯åˆ‡æ¢
            document.getElementById('client-side-toggle').addEventListener('change', function() {
                isClientSideValidation = this.checked;
            });
            
            // æš‚åœæŒ‰é’®
            document.getElementById('pause-btn').addEventListener('click', function() {
                if (isPaused) {
                    // ç»§ç»­éªŒè¯
                    isPaused = false;
                    this.textContent = 'æš‚åœ';
                    this.classList.remove('btn-primary');
                    this.classList.add('btn-pause');
                    continueValidation();
                } else {
                    // æš‚åœéªŒè¯
                    isPaused = true;
                    this.textContent = 'ç»§ç»­';
                    this.classList.remove('btn-pause');
                    this.classList.add('btn-primary');
                }
            });
            
            // å–æ¶ˆæŒ‰é’®
            document.getElementById('cancel-btn').addEventListener('click', function() {
                cancelValidation();
            });
            
            // æš—è‰²æ¨¡å¼åˆ‡æ¢ - å®Œå…¨é‡å†™ä»¥ä¿®å¤é—®é¢˜
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', function(event) {
                    event.preventDefault();
                    event.stopPropagation();
                    
                    // ç›´æ¥åŸºäºbodyç±»ååˆ‡æ¢æ¨¡å¼ï¼Œé¿å…ä¾èµ–isDarkModeå˜é‡
                    if (document.body.classList.contains('dark-mode')) {
                        // å½“å‰æ˜¯æš—è‰²æ¨¡å¼ï¼Œåˆ‡æ¢åˆ°äº®è‰²æ¨¡å¼
                        document.body.classList.remove('dark-mode');
                        this.querySelector('.theme-toggle-icon').textContent = 'ğŸŒ™';
                        localStorage.setItem('theme', 'light');
                        isDarkMode = false;
                        console.log("å·²åˆ‡æ¢åˆ°äº®è‰²æ¨¡å¼");
                    } else {
                        // å½“å‰æ˜¯äº®è‰²æ¨¡å¼ï¼Œåˆ‡æ¢åˆ°æš—è‰²æ¨¡å¼
                        document.body.classList.add('dark-mode');
                        this.querySelector('.theme-toggle-icon').textContent = 'â˜€ï¸';
                        localStorage.setItem('theme', 'dark');
                        isDarkMode = true;
                        console.log("å·²åˆ‡æ¢åˆ°æš—è‰²æ¨¡å¼");
                    }
                });
            }
            
            // åˆ·æ–°èŠ‚ç‚¹ä¿¡æ¯
            document.getElementById('refresh-node-info').addEventListener('click', fetchNodeInfo);
            
            // åˆå§‹è·å–èŠ‚ç‚¹ä¿¡æ¯
            fetchNodeInfo();
            
            // èŠ‚ç‚¹ä¿¡æ¯æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('node-toggle').addEventListener('click', toggleNodeInfo);
        });
        
        // åŠ è½½ä¸»é¢˜åå¥½
        function loadThemePreference() {
            // å°è¯•ä»localStorageè¯»å–ä¸»é¢˜è®¾ç½®
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                enableDarkMode();
            }
        }
        
        // åˆ‡æ¢æš—è‰²æ¨¡å¼
        function toggleDarkMode() {
            console.log("åˆ‡æ¢æš—è‰²æ¨¡å¼ï¼Œå½“å‰çŠ¶æ€:", isDarkMode);
            if (isDarkMode) {
                disableDarkMode();
            } else {
                enableDarkMode();
            }
        }
        
        // å¯ç”¨æš—è‰²æ¨¡å¼
        function enableDarkMode() {
            document.body.classList.add('dark-mode');
            document.getElementById('theme-toggle').querySelector('.theme-toggle-icon').textContent = 'â˜€ï¸';
            isDarkMode = true;
            localStorage.setItem('theme', 'dark');
        }
        
        // ç¦ç”¨æš—è‰²æ¨¡å¼
        function disableDarkMode() {
            document.body.classList.remove('dark-mode');
            document.getElementById('theme-toggle').querySelector('.theme-toggle-icon').textContent = 'ğŸŒ™';
            isDarkMode = false;
            localStorage.setItem('theme', 'light');
        }
        
        // åˆ‡æ¢èŠ‚ç‚¹ä¿¡æ¯æ˜¾ç¤º
        function toggleNodeInfo(event) {
            // é˜»æ­¢äº‹ä»¶å†’æ³¡
            event.stopPropagation();
            
            const nodeInfo = document.getElementById('node-info');
            if (nodeInfoVisible) {
                nodeInfo.classList.remove('visible');
                nodeInfoVisible = false;
            } else {
                nodeInfo.classList.add('visible');
                nodeInfoVisible = true;
                fetchNodeInfo(); // è·å–æœ€æ–°èŠ‚ç‚¹ä¿¡æ¯
            }
        }
        
        // ç‚¹å‡»å…¶ä»–åŒºåŸŸéšè—èŠ‚ç‚¹ä¿¡æ¯
        document.addEventListener('click', function(event) {
            const nodeInfo = document.getElementById('node-info');
            const nodeToggle = document.getElementById('node-toggle');
            
            // å¦‚æœç‚¹å‡»çš„ä¸æ˜¯èŠ‚ç‚¹ä¿¡æ¯åŒºåŸŸå’ŒèŠ‚ç‚¹ä¿¡æ¯æŒ‰é’®ï¼Œåˆ™éšè—èŠ‚ç‚¹ä¿¡æ¯
            if (nodeInfoVisible && 
                !nodeInfo.contains(event.target) && 
                !nodeToggle.contains(event.target)) {
                nodeInfo.classList.remove('visible');
                nodeInfoVisible = false;
            }
        });
        
        // é˜»æ­¢èŠ‚ç‚¹ä¿¡æ¯åŒºåŸŸå†…éƒ¨ç‚¹å‡»äº‹ä»¶å†’æ³¡
        document.getElementById('node-info').addEventListener('click', function(event) {
            event.stopPropagation();
        });
        
        // è·å–èŠ‚ç‚¹ä¿¡æ¯
        async function fetchNodeInfo() {
            const nodeInfoContent = document.getElementById('node-info-content');
            nodeInfoContent.innerHTML = '<div class="node-info-loading">æ­£åœ¨è·å–èŠ‚ç‚¹ä¿¡æ¯...</div>';
            
            try {
                // è·å–IPä¿¡æ¯
                const ipResponse = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipResponse.json();
                const ip = ipData.ip;
                
                // è·å–è¯¦ç»†IPæ•°æ®
                const geoResponse = await fetch(`https://ipapi.co/${ip}/json/`);
                const geoData = await geoResponse.json();
                
                // è·å–æµè§ˆå™¨ä¿¡æ¯
                const browserInfo = {
                    userAgent: navigator.userAgent,
                    language: navigator.language,
                    platform: navigator.platform,
                    vendor: navigator.vendor || 'Unknown',
                    cookiesEnabled: navigator.cookieEnabled,
                    doNotTrack: navigator.doNotTrack || 'Unknown',
                    connection: navigator.connection ? {
                        effectiveType: navigator.connection.effectiveType,
                        downlink: navigator.connection.downlink,
                        rtt: navigator.connection.rtt,
                        saveData: navigator.connection.saveData
                    } : 'Unavailable'
                };
                
                // æ„å»ºä¿¡æ¯HTML
                let infoHTML = `
                    <div class="node-info-item">
                        <span class="node-info-label">IP:</span>
                        <span class="node-info-value">${ip}</span>
                    </div>
                    <div class="node-info-item">
                        <span class="node-info-label">åœ°åŒº:</span>
                        <span class="node-info-value">${geoData.country_name || 'Unknown'} (${geoData.country_code || 'N/A'})</span>
                    </div>
                    <div class="node-info-item">
                        <span class="node-info-label">åŸå¸‚:</span>
                        <span class="node-info-value">${geoData.city || 'Unknown'}, ${geoData.region || 'Unknown'}</span>
                    </div>
                    <div class="node-info-item">
                        <span class="node-info-label">ISP:</span>
                        <span class="node-info-value">${geoData.org || 'Unknown'}</span>
                    </div>
                    <div class="node-info-item">
                        <span class="node-info-label">æ—¶åŒº:</span>
                        <span class="node-info-value">${geoData.timezone || 'Unknown'}</span>
                    </div>
                    <div class="node-info-item">
                        <span class="node-info-label">ASN:</span>
                        <span class="node-info-value">${geoData.asn || 'Unknown'}</span>
                    </div>
                    <div class="node-info-item">
                        <span class="node-info-label">IPç±»å‹:</span>
                        <span class="node-info-value">${getIpType(geoData)}</span>
                    </div>
                    <div class="node-info-item">
                        <span class="node-info-label">å¯ä¿¡åº¦:</span>
                        <span class="node-info-value">${getTrustLevel(geoData)} ${getTrustBadge(geoData)}</span>
                    </div>
                    <div class="node-info-item">
                        <span class="node-info-label">èŠ‚ç‚¹ç­‰çº§:</span>
                        <span class="node-info-value">${getNodeLevel(geoData)} ${getNodeBadge(geoData)}</span>
                    </div>
                    <div class="node-info-item">
                        <span class="node-info-label">æµè§ˆå™¨:</span>
                        <span class="node-info-value">${getBrowserName(browserInfo.userAgent)}</span>
                    </div>
                    <div class="node-info-item">
                        <span class="node-info-label">æ“ä½œç³»ç»Ÿ:</span>
                        <span class="node-info-value">${getOSName(browserInfo.userAgent)}</span>
                    </div>
                    <div class="node-info-item">
                        <span class="node-info-label">è¯­è¨€:</span>
                        <span class="node-info-value">${browserInfo.language}</span>
                    </div>
                    <div class="node-info-item">
                        <span class="node-info-label">æ›´æ–°æ—¶é—´:</span>
                        <span class="node-info-value">${new Date().toLocaleString()}</span>
                    </div>
                `;
                
                nodeInfoContent.innerHTML = infoHTML;
            } catch (error) {
                nodeInfoContent.innerHTML = `
                    <div class="node-info-item">
                        <span class="node-info-label">é”™è¯¯:</span>
                        <span class="node-info-value">è·å–èŠ‚ç‚¹ä¿¡æ¯å¤±è´¥: ${error.message}</span>
                    </div>
                    <button class="btn btn-secondary" style="width: 100%; margin-top: 10px;" onclick="fetchNodeInfo()">é‡è¯•</button>
                `;
            }
        }
        
        // è·å–IPç±»å‹
        function getIpType(geoData) {
            if (!geoData) return 'Unknown';
            
            if (geoData.country_code === 'US') return 'United States IP';
            if (geoData.country_code === 'CN') return 'ä¸­å›½ IP';
            
            return `${geoData.country_name || 'Unknown'} IP`;
        }
        
        // è·å–å¯ä¿¡åº¦è¯„çº§
        function getTrustLevel(geoData) {
            if (!geoData) return 'Unknown';
            
            // æ ¹æ®ä¸åŒå› ç´ ç¡®å®šå¯ä¿¡åº¦
            if (geoData.country_code === 'US' || geoData.country_code === 'CA' || 
                geoData.country_code === 'GB' || geoData.country_code === 'AU') {
                return 'é«˜åº¦å¯ä¿¡';
            }
            
            if (geoData.country_code === 'CN' || geoData.country_code === 'RU' ||
                geoData.country_code === 'IR' || geoData.country_code === 'KP') {
                return 'éœ€è°¨æ…éªŒè¯';
            }
            
            return 'ä¸€èˆ¬å¯ä¿¡';
        }
        
        // è·å–å¯ä¿¡åº¦æ ‡å¿—
        function getTrustBadge(geoData) {
            if (!geoData) return '';
            
            if (geoData.country_code === 'US' || geoData.country_code === 'CA' || 
                geoData.country_code === 'GB' || geoData.country_code === 'AU') {
                return '<span class="badge badge-info">ä¼˜è´¨</span>';
            }
            
            if (geoData.country_code === 'CN' || geoData.country_code === 'RU' ||
                geoData.country_code === 'IR' || geoData.country_code === 'KP') {
                return '<span class="badge badge-warning">æ³¨æ„</span>';
            }
            
            return '';
        }
        
        // è·å–èŠ‚ç‚¹ç­‰çº§
        function getNodeLevel(geoData) {
            if (!geoData) return 'Unknown';
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºæ•°æ®ä¸­å¿ƒæˆ–äº‘æœåŠ¡æä¾›å•†
            if (geoData.org && (
                geoData.org.includes('Amazon') || 
                geoData.org.includes('AWS') || 
                geoData.org.includes('Microsoft') || 
                geoData.org.includes('Azure') || 
                geoData.org.includes('Google') || 
                geoData.org.includes('Cloudflare') ||
                geoData.org.includes('Digital Ocean') ||
                geoData.org.includes('Linode')
            )) {
                return 'æ•°æ®ä¸­å¿ƒèŠ‚ç‚¹';
            }
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºç§»åŠ¨ç½‘ç»œ
            if (geoData.org && (
                geoData.org.includes('Mobile') || 
                geoData.org.includes('Wireless') || 
                geoData.org.includes('Cellular')
            )) {
                return 'ç§»åŠ¨ç½‘ç»œèŠ‚ç‚¹';
            }
            
            return 'æ™®é€šç½‘ç»œèŠ‚ç‚¹';
        }
        
        // è·å–èŠ‚ç‚¹æ ‡å¿—
        function getNodeBadge(geoData) {
            if (!geoData) return '';
            
            // ä¸ºæ•°æ®ä¸­å¿ƒèŠ‚ç‚¹æä¾›ç‰¹æ®Šæ ‡å¿—
            if (geoData.org && (
                geoData.org.includes('Amazon') || 
                geoData.org.includes('AWS') || 
                geoData.org.includes('Microsoft') || 
                geoData.org.includes('Azure') || 
                geoData.org.includes('Google') || 
                geoData.org.includes('Cloudflare')
            )) {
                return '<span class="badge badge-info">é«˜é€Ÿ</span>';
            }
            
            return '';
        }
        
        // å–æ¶ˆéªŒè¯
        function cancelValidation() {
            if (!isValidating) return;
            
            // ä¸­æ­¢å½“å‰æ‰€æœ‰è¯·æ±‚
            if (validationController) {
                validationController.abort();
            }
            
            isValidating = false;
            isPaused = false;
            
            // é‡ç½®UI
            document.getElementById('pause-btn').textContent = 'æš‚åœ';
            document.getElementById('pause-btn').classList.remove('btn-primary');
            document.getElementById('pause-btn').classList.add('btn-pause');
            document.getElementById('progress-container').style.display = 'none';
            document.getElementById('validate-btn').disabled = false;
            
            // å¦‚æœå·²æœ‰éƒ¨åˆ†ç»“æœï¼Œåˆ™æ˜¾ç¤º
            if (validationResults.length > 0) {
                displayResults();
                document.getElementById('export-valid-results-btn').disabled = false;
                document.getElementById('export-all-results-btn').disabled = false;
            }
        }
        
        // è§£æè¾“å…¥è·å–APIå¯†é’¥
        function getApiKeys() {
            const activeTab = document.querySelector('.tab.active').dataset.tab;
            
            if (activeTab === 'text-input') {
                const inputText = document.getElementById('keys-input').value.trim();
                if (!inputText) return [];
                
                // åˆ†è¡Œå¹¶è¿‡æ»¤ç©ºè¡Œ
                return inputText.split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 0);
            } else {
                const fileInput = document.getElementById('file-input');
                if (!fileInput.files || fileInput.files.length === 0) return [];
                
                // æ–‡ä»¶å¤„ç†åœ¨å•ç‹¬çš„å‡½æ•°ä¸­è¿›è¡Œ
                return []; // æš‚æ—¶è¿”å›ç©ºæ•°ç»„ï¼Œå®é™…ä¼šåœ¨parseFileå‡½æ•°ä¸­å¼‚æ­¥å¤„ç†
            }
        }
        
        // è·å–å½“å‰é€‰æ‹©çš„æ¨¡å‹
        function getSelectedModel() {
            switch (currentApiType) {
                case 'openai':
                    return document.getElementById('openai-model').value;
                case 'claude':
                    return document.getElementById('claude-model').value;
                case 'gemini':
                    return document.getElementById('gemini-model').value;
                case 'deepseek':
                    return document.getElementById('deepseek-model').value;
                case 'xai':
                    return document.getElementById('xai-model').value;
                case 'openai_like':
                    return document.getElementById('custom-model-name').value.trim();
                default:
                    return null;
            }
        }
        
        // è·å–è‡ªå®šä¹‰APIé…ç½®
        function getCustomApiConfig() {
            if (currentApiType !== 'openai_like') return null;
            
            const customApiUrl = document.getElementById('custom-api-url').value.trim();
            const customModelName = document.getElementById('custom-model-name').value.trim();
            
            if (!customApiUrl || !customModelName) {
                return null;
            }
            
            if (!customApiUrl.endsWith('/v1')) {
                alert('è‡ªå®šä¹‰API URLå¿…é¡»ä»¥ /v1 ç»“å°¾');
                return null;
            }
            
            // æ›´æ–°openai_likeé…ç½®
            API_ENDPOINTS.openai_like.models = customApiUrl + '/models';
            API_ENDPOINTS.openai_like.completions = customApiUrl + '/chat/completions';
            
            return {
                custom_api_url: customApiUrl,
                custom_model_name: customModelName
            };
        }
        
        // è§£ææ–‡ä»¶å†…å®¹
        function parseFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    const content = event.target.result;
                    let keys = [];
                    
                    if (file.name.toLowerCase().endsWith('.csv')) {
                        // è§£æCSV
                        const lines = content.split('\n');
                        keys = lines
                            .map(line => {
                                const columns = line.split(',');
                                return columns[0] ? columns[0].trim() : '';
                            })
                            .filter(key => key.length > 0);
                    } else {
                        // è§£ææ–‡æœ¬æ–‡ä»¶
                        keys = content.split('\n')
                            .map(line => line.trim())
                            .filter(line => line.length > 0);
                    }
                    
                    resolve(keys);
                };
                
                reader.onerror = function() {
                    reject(new Error('æ–‡ä»¶è¯»å–å¤±è´¥'));
                };
                
                reader.readAsText(file);
            });
        }
        
        // å¼€å§‹éªŒè¯è¿‡ç¨‹
        async function startValidation() {
            // å¦‚æœå½“å‰æ­£åœ¨éªŒè¯ï¼Œåˆ™ä¸æ‰§è¡Œ
            if (isValidating && !isPaused) return;
            
            // å¦‚æœæš‚åœçŠ¶æ€ï¼Œç»§ç»­éªŒè¯
            if (isValidating && isPaused) {
                continueValidation();
                return;
            }
            
            // é‡ç½®UIå’ŒçŠ¶æ€
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('results-body').innerHTML = '';
            validationResults = [];
            document.getElementById('export-valid-results-btn').disabled = true;
            document.getElementById('export-all-results-btn').disabled = true;
            
            validationStats = {
                valid: 0,
                invalid: 0,
                error: 0
            };
            
            isValidating = true;
            isPaused = false;
            currentBatchIndex = 0;
            startTime = Date.now();
            
            // ç¦ç”¨éªŒè¯æŒ‰é’®
            document.getElementById('validate-btn').disabled = true;
            
            // è·å–APIå¯†é’¥
            let keys = getApiKeys();
            
            // æ ¹æ®APIç±»å‹è®¾ç½®é…ç½®
            if (currentApiType === 'openai_like') {
                const customConfig = getCustomApiConfig();
                if (!customConfig) {
                    alert('è¯·æä¾›æœ‰æ•ˆçš„è‡ªå®šä¹‰API URLå’Œæ¨¡å‹åç§°');
                    document.getElementById('validate-btn').disabled = false;
                    isValidating = false;
                    return;
                }
            } else if (currentApiType === 'gemini') {
                // ä¸ºGeminiè®¾ç½®å¸¦æœ‰é€‰å®šæ¨¡å‹çš„completions URL
                const selectedModel = getSelectedModel();
                API_ENDPOINTS.gemini.completions = API_ENDPOINTS.gemini.completions.replace('MODEL_NAME', selectedModel);
            }
            
            // å¦‚æœæ˜¯æ–‡ä»¶è¾“å…¥ï¼Œå¤„ç†æ–‡ä»¶
            const activeTab = document.querySelector('.tab.active').dataset.tab;
            if (activeTab === 'file-input') {
                const fileInput = document.getElementById('file-input');
                if (!fileInput.files || fileInput.files.length === 0) {
                    alert('è¯·é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶');
                    document.getElementById('validate-btn').disabled = false;
                    isValidating = false;
                    return;
                }
                
                try {
                    keys = await parseFile(fileInput.files[0]);
                } catch (error) {
                    alert(`æ–‡ä»¶è§£æé”™è¯¯: ${error.message}`);
                    document.getElementById('validate-btn').disabled = false;
                    isValidating = false;
                    return;
                }
            }
            
            // éªŒè¯æ˜¯å¦æœ‰å¯†é’¥
            if (keys.length === 0) {
                alert('æœªæ‰¾åˆ°APIå¯†é’¥');
                document.getElementById('validate-btn').disabled = false;
                isValidating = false;
                return;
            }
            
            // æ£€æŸ¥é‡å¤é¡¹
            const { uniqueKeys, duplicateCount } = removeDuplicates(keys);
            keys = uniqueKeys;
            
            // å¦‚æœæœ‰é‡å¤é¡¹ï¼Œæç¤ºç”¨æˆ·
            if (duplicateCount > 0) {
                alert(`æ£€æµ‹åˆ°${duplicateCount}ä¸ªé‡å¤çš„APIå¯†é’¥ï¼Œå·²è‡ªåŠ¨ç§»é™¤ã€‚å°†ä½¿ç”¨${keys.length}ä¸ªå”¯ä¸€å¯†é’¥è¿›è¡ŒéªŒè¯ã€‚`);
            }
            
            // å¢åŠ æ‰¹é‡éªŒè¯ä¸Šé™åˆ°5000ä¸ª
            if (keys.length > 5000) {
                if (!confirm(`æ‚¨æ­£åœ¨å°è¯•éªŒè¯${keys.length}ä¸ªå¯†é’¥ï¼Œè¿™å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ`)) {
                    document.getElementById('validate-btn').disabled = false;
                    isValidating = false;
                    return;
                }
            }
            
            // å‡†å¤‡éªŒè¯é˜Ÿåˆ—
            validationQueue = [...keys];
            
            // æ˜¾ç¤ºè¿›åº¦æ¡
            const progressContainer = document.getElementById('progress-container');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const progressPercentage = document.getElementById('progress-percentage');
            
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            progressText.textContent = 'å‡†å¤‡éªŒè¯...';
            progressPercentage.textContent = '0%';
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateValidationStats(0, keys.length);
            
            // é€‰æ‹©éªŒè¯æ–¹å¼
            if (isClientSideValidation) {
                processValidationBatch();
            } else {
                await validateKeysServerSide(keys, updateProgress);
            }
        }
        
        // ç§»é™¤é‡å¤å¯†é’¥
        function removeDuplicates(keys) {
            const uniqueSet = new Set();
            const uniqueKeys = [];
            let duplicateCount = 0;
            
            keys.forEach(key => {
                if (!uniqueSet.has(key)) {
                    uniqueSet.add(key);
                    uniqueKeys.push(key);
                } else {
                    duplicateCount++;
                }
            });
            
            return { uniqueKeys, duplicateCount };
        }
        
        // ç»§ç»­éªŒè¯
        function continueValidation() {
            if (!isValidating || !isPaused) return;
            
            isPaused = false;
            processValidationBatch();
        }
        
        // å¤„ç†éªŒè¯æ‰¹æ¬¡
        async function processValidationBatch() {
            if (!isValidating || isPaused) return;
            
            // åˆ›å»ºæ–°çš„AbortControllerç”¨äºæœ¬æ‰¹æ¬¡è¯·æ±‚
            validationController = new AbortController();
            
            const batchSize = 10; // æ‰¹é‡å¤§å°
            const totalKeys = validationQueue.length;
            const processedCount = validationResults.length;
            
            // å¦‚æœæ‰€æœ‰æ‰¹æ¬¡å·²å¤„ç†å®Œæ¯•
            if (currentBatchIndex >= validationQueue.length) {
                finishValidation();
                return;
            }
            
            // è·å–å½“å‰æ‰¹æ¬¡
            const endIndex = Math.min(currentBatchIndex + batchSize, validationQueue.length);
            const currentBatch = validationQueue.slice(currentBatchIndex, endIndex);
            
            try {
                // é€‰æ‹©çš„æ¨¡å‹
                const selectedModel = getSelectedModel();
                
                // å¹¶è¡ŒéªŒè¯å½“å‰æ‰¹æ¬¡
                const batchPromises = currentBatch.map(key => 
                    validateSingleKeyClientSide(key, currentApiType, selectedModel, validationController.signal)
                );
                
                // ç­‰å¾…å½“å‰æ‰¹æ¬¡å®Œæˆ
                const batchResults = await Promise.all(batchPromises);
                
                // æ›´æ–°ç»“æœ
                validationResults.push(...batchResults);
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                batchResults.forEach(result => {
                    if (result.valid) validationStats.valid++;
                    else if (result.error_code === 'NETWORK_ERROR') validationStats.error++;
                    else validationStats.invalid++;
                });
                
                // æ›´æ–°è¿›åº¦
                const newProcessedCount = processedCount + currentBatch.length;
                const progress = (newProcessedCount / totalKeys) * 100;
                updateProgress(progress, `å·²éªŒè¯ ${newProcessedCount}/${totalKeys}`);
                updateValidationStats(newProcessedCount, totalKeys);
                
                // æ›´æ–°å½“å‰æ‰¹æ¬¡ç´¢å¼•
                currentBatchIndex = endIndex;
                
                // å¦‚æœæš‚åœï¼Œåˆ™ä¸ç»§ç»­å¤„ç†
                if (isPaused) return;
                
                // æ‰¹æ¬¡é—´å»¶è¿Ÿï¼Œé¿å…APIé™åˆ¶
                if (currentBatchIndex < validationQueue.length) {
                    setTimeout(processValidationBatch, 500);
                } else {
                    finishValidation();
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.log('éªŒè¯è¢«å–æ¶ˆ');
                } else {
                    console.error('æ‰¹æ¬¡å¤„ç†é”™è¯¯:', error);
                    
                    // å¦‚æœå‡ºé”™ä½†æœªè¢«å–æ¶ˆï¼Œå°è¯•ç»§ç»­å¤„ç†
                    if (isValidating && !isPaused) {
                        setTimeout(processValidationBatch, 2000); // å»¶è¿Ÿæ›´é•¿æ—¶é—´åé‡è¯•
                    }
                }
            }
        }
        
        // å®ŒæˆéªŒè¯
        function finishValidation() {
            isValidating = false;
            document.getElementById('validate-btn').disabled = false;
            
            // ç¡®ä¿è¿›åº¦æ¡æ˜¾ç¤º100%å®Œæˆ
            updateProgress(100, 'éªŒè¯å®Œæˆ');
            
            // æ˜¾ç¤ºç»“æœ
            displayResults();
            
            // å¯ç”¨å¯¼å‡ºæŒ‰é’®
            document.getElementById('export-valid-results-btn').disabled = false;
            document.getElementById('export-all-results-btn').disabled = false;
        }
        
        // æ›´æ–°éªŒè¯ç»Ÿè®¡ä¿¡æ¯
        function updateValidationStats(processedCount, totalCount) {
            document.getElementById('validated-count').textContent = `å·²éªŒè¯: ${processedCount}/${totalCount}`;
            document.getElementById('valid-progress').textContent = `æœ‰æ•ˆ: ${validationStats.valid}`;
            document.getElementById('invalid-progress').textContent = `æ— æ•ˆ: ${validationStats.invalid}`;
            document.getElementById('error-progress').textContent = `é”™è¯¯: ${validationStats.error}`;
            
            // è®¡ç®—é¢„è®¡å‰©ä½™æ—¶é—´
            if (processedCount > 0 && startTime) {
                const elapsedMs = Date.now() - startTime;
                const msPerKey = elapsedMs / processedCount;
                const remainingKeys = totalCount - processedCount;
                const remainingMs = remainingKeys * msPerKey;
                
                let timeRemainingText = 'é¢„è®¡å‰©ä½™æ—¶é—´: ';
                
                if (remainingMs < 60000) {
                    // å°‘äº1åˆ†é’Ÿ
                    timeRemainingText += `${Math.round(remainingMs / 1000)}ç§’`;
                } else if (remainingMs < 3600000) {
                    // å°‘äº1å°æ—¶
                    const minutes = Math.floor(remainingMs / 60000);
                    const seconds = Math.round((remainingMs % 60000) / 1000);
                    timeRemainingText += `${minutes}åˆ†${seconds}ç§’`;
                } else {
                    // è¶…è¿‡1å°æ—¶
                    const hours = Math.floor(remainingMs / 3600000);
                    const minutes = Math.floor((remainingMs % 3600000) / 60000);
                    timeRemainingText += `${hours}å°æ—¶${minutes}åˆ†é’Ÿ`;
                }
                
                document.getElementById('time-remaining').textContent = timeRemainingText;
            } else {
                document.getElementById('time-remaining').textContent = 'é¢„è®¡å‰©ä½™æ—¶é—´: è®¡ç®—ä¸­...';
            }
        }
        
        // å®¢æˆ·ç«¯éªŒè¯å¯†é’¥ï¼ˆæµè§ˆå™¨ç«¯éªŒè¯ï¼‰
        async function validateKeysClientSide(keys, progressCallback) {
            validationResults = [];
            const totalKeys = keys.length;
            
            // æ‰¹é‡å¤„ç†
            for (let i = 0; i < keys.length; i += 10) {
                if (isPaused) {
                    // å¦‚æœæš‚åœï¼Œç­‰å¾…ç»§ç»­
                    await new Promise(resolve => {
                        const checkPaused = () => {
                            if (!isPaused) resolve();
                            else setTimeout(checkPaused, 500);
                        };
                        checkPaused();
                    });
                }
                
                if (!isValidating) break; // å¦‚æœå–æ¶ˆäº†éªŒè¯
                
                const batch = keys.slice(i, i + 10);
                const model = getSelectedModel();
                const batchPromises = batch.map(key => validateSingleKeyClientSide(key, currentApiType, model, validationController.signal));
                
                // ç­‰å¾…å½“å‰æ‰¹æ¬¡å®Œæˆ
                const batchResults = await Promise.all(batchPromises);
                validationResults.push(...batchResults);
                
                // æ›´æ–°è¿›åº¦
                const completedCount = Math.min(i + 10, keys.length);
                const progress = (completedCount / totalKeys) * 100;
                progressCallback(progress, `å·²éªŒè¯ ${completedCount}/${totalKeys}`);
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                batchResults.forEach(result => {
                    if (result.valid) validationStats.valid++;
                    else if (result.error_code === 'NETWORK_ERROR') validationStats.error++;
                    else validationStats.invalid++;
                });
                
                updateValidationStats(completedCount, totalKeys);
                
                // æ·»åŠ çŸ­æš‚å»¶è¿Ÿé¿å…APIé™åˆ¶
                if (i + 10 < keys.length) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
            }
        }
        
        // éªŒè¯å•ä¸ªå¯†é’¥ï¼ˆå®¢æˆ·ç«¯ï¼‰
        async function validateSingleKeyClientSide(key, apiType, modelName, signal) {
            const result = {
                key: key,
                valid: false,
                error_code: null,
                error_message: null
            };
            
            // é€‰æ‹©ç«¯ç‚¹
            const config = API_ENDPOINTS[apiType];
            if (!config || !config.models) {
                result.error_code = "CONFIG_ERROR";
                result.error_message = "æ— æ•ˆçš„APIé…ç½®";
                return result;
            }
            
            const endpoint = config.models;
            let headers = {};
            
            // è®¾ç½®ä¸åŒAPIçš„å¤´ä¿¡æ¯
            switch (apiType) {
                case 'openai':
                case 'openai_like':
                    headers = {
                        'Authorization': `Bearer ${key}`,
                        'Content-Type': 'application/json'
                    };
                    break;
                case 'claude':
                    headers = {
                        'x-api-key': key,
                        'anthropic-version': '2023-06-01',
                        'Content-Type': 'application/json'
                    };
                    break;
                case 'gemini':
                    // Geminiä½¿ç”¨æŸ¥è¯¢å‚æ•°è€Œéå¤´éƒ¨
                    headers = {
                        'Content-Type': 'application/json'
                    };
                    break;
                case 'deepseek':
                    headers = {
                        'Authorization': `Bearer ${key}`,
                        'Content-Type': 'application/json'
                    };
                    break;
                case 'xai':
                    headers = {
                        'Authorization': `Bearer ${key}`,
                        'Content-Type': 'application/json'
                    };
                    break;
                default:
                    result.error_code = "UNSUPPORTED_API";
                    result.error_message = `ä¸æ”¯æŒçš„APIç±»å‹: ${apiType}`;
                    return result;
            }
            
            try {
                // ä½¿ç”¨fetchè¿›è¡ŒAPIè°ƒç”¨
                let url = endpoint;
                // å¯¹äºGeminiï¼Œå°†å¯†é’¥ä½œä¸ºURLå‚æ•°
                if (apiType === 'gemini') {
                    url = `${endpoint}?key=${key}`;
                }
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: headers,
                    signal: signal, // å…è®¸å–æ¶ˆè¯·æ±‚
                    // å¢åŠ è¶…æ—¶æ—¶é—´
                    signal: AbortSignal.timeout(20000) // 20ç§’è¶…æ—¶
                });
                
                // æ ¹æ®çŠ¶æ€ç ç¡®å®šæœ‰æ•ˆæ€§
                if (response.ok) {
                    result.valid = true;
                } else {
                    // å°è¯•è¯»å–é”™è¯¯ä¿¡æ¯
                    try {
                        const errorData = await response.json();
                        result.error_code = response.status.toString();
                        result.error_message = getErrorMessage(errorData, apiType);
                    } catch (e) {
                        result.error_code = response.status.toString();
                        result.error_message = `HTTPé”™è¯¯: ${response.status}`;
                    }
                }
            } catch (error) {
                // å¦‚æœä¸»ç«¯ç‚¹å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨å®Œæˆç«¯ç‚¹
                try {
                    const completionResult = await validateWithCompletionEndpoint(key, apiType, modelName, signal);
                    return completionResult;
                } catch (secondError) {
                    result.error_code = 'NETWORK_ERROR';
                    result.error_message = `ç½‘ç»œé”™è¯¯: ${error.message || error.name || 'æœªçŸ¥é”™è¯¯'}`;
                }
            }
            
            return result;
        }
        
        // ä½¿ç”¨å®Œæˆç«¯ç‚¹è¿›è¡ŒéªŒè¯ï¼ˆå¤‡ç”¨æ–¹æ³•ï¼‰
        async function validateWithCompletionEndpoint(key, apiType, modelName, signal) {
            const result = {
                key: key,
                valid: false,
                error_code: null,
                error_message: null
            };
            
            // è·å–é…ç½®
            const config = API_ENDPOINTS[apiType];
            if (!config || !config.completions) {
                result.error_code = "CONFIG_ERROR";
                result.error_message = "æ— æ•ˆçš„APIé…ç½®";
                return result;
            }
            
            let headers = {};
            
            // è®¾ç½®ä¸åŒAPIçš„å¤´ä¿¡æ¯
            switch (apiType) {
                case 'openai':
                case 'openai_like':
                case 'deepseek':
                case 'xai':
                    headers = {
                        'Authorization': `Bearer ${key}`,
                        'Content-Type': 'application/json'
                    };
                    break;
                case 'claude':
                    headers = {
                        'x-api-key': key,
                        'anthropic-version': '2023-06-01',
                        'Content-Type': 'application/json'
                    };
                    break;
                case 'gemini':
                    headers = {
                        'Content-Type': 'application/json'
                    };
                    break;
                default:
                    result.error_code = "UNSUPPORTED_API";
                    result.error_message = `ä¸æ”¯æŒçš„APIç±»å‹: ${apiType}`;
                    return result;
            }
            
            try {
                // ä½¿ç”¨fetchè¿›è¡ŒAPIè°ƒç”¨
                let url = config.completions;
                if (apiType === 'gemini') {
                    url = `${url}?key=${key}`;
                }
                
                const payload = config.payload(modelName);
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(payload),
                    signal: signal, // å…è®¸å–æ¶ˆè¯·æ±‚
                    // å¢åŠ è¶…æ—¶æ—¶é—´
                    signal: AbortSignal.timeout(30000) // 30ç§’è¶…æ—¶
                });
                
                // æ ¹æ®çŠ¶æ€ç ç¡®å®šæœ‰æ•ˆæ€§
                if (response.ok) {
                    result.valid = true;
                } else {
                    // å°è¯•è¯»å–é”™è¯¯ä¿¡æ¯
                    try {
                        const errorData = await response.json();
                        result.error_code = response.status.toString();
                        
                        // ç‰¹æ®Šæƒ…å†µï¼š401ä½†æ¶ˆæ¯æŒ‡æ˜æ— æ•ˆAPIå¯†é’¥
                        if (response.status === 401 || 
                            errorData.error?.message?.includes('key') || 
                            errorData.error?.includes('key') ||
                            errorData.error?.message?.includes('auth')) {
                            result.error_message = 'æ— æ•ˆçš„APIå¯†é’¥';
                        } else {
                            result.error_message = getErrorMessage(errorData, apiType);
                        }
                    } catch (e) {
                        result.error_code = response.status.toString();
                        result.error_message = `HTTPé”™è¯¯: ${response.status}`;
                    }
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    throw error; // é‡æ–°æŠ›å‡ºä¸­æ­¢é”™è¯¯ï¼Œè®©ä¸Šå±‚å¤„ç†
                }
                
                result.error_code = 'NETWORK_ERROR';
                result.error_message = `ç½‘ç»œé”™è¯¯: ${error.message || error.name || 'æœªçŸ¥é”™è¯¯'}`;
            }
            
            return result;
        }
        
        // ä»é”™è¯¯å“åº”ä¸­æå–æ¶ˆæ¯
        function getErrorMessage(errorData, apiType) {
            switch (apiType) {
                case 'openai':
                case 'openai_like':
                case 'deepseek':
                case 'xai':
                    return errorData.error?.message || 'æœªçŸ¥é”™è¯¯';
                case 'claude':
                    return errorData.error?.message || errorData.detail || 'æœªçŸ¥é”™è¯¯';
                case 'gemini':
                    return errorData.error?.message || errorData.error || 'æœªçŸ¥é”™è¯¯';
                default:
                    return 'æœªçŸ¥é”™è¯¯';
            }
        }
        
        // æœåŠ¡å™¨ç«¯éªŒè¯å¯†é’¥
        async function validateKeysServerSide(keys, progressCallback) {
            try {
                const formData = new FormData();
                formData.append('input_method', 'text');
                formData.append('keys', keys.join('\n'));
                formData.append('api_type', currentApiType);
                formData.append('model', getSelectedModel());
                
                // å¯¹äºopenai_likeï¼Œæ·»åŠ è‡ªå®šä¹‰é…ç½®
                if (currentApiType === 'openai_like') {
                    const customConfig = getCustomApiConfig();
                    if (!customConfig) {
                        throw new Error('è¯·æä¾›æœ‰æ•ˆçš„è‡ªå®šä¹‰API URLå’Œæ¨¡å‹åç§°');
                    }
                    
                    formData.append('custom_api_url', customConfig.custom_api_url);
                    formData.append('custom_model_name', customConfig.custom_model_name);
                }
                
                const response = await fetch('/validate', {
                    method: 'POST',
                    body: formData,
                    signal: validationController.signal
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'æœåŠ¡å™¨éªŒè¯å¤±è´¥');
                }
                
                const data = await response.json();
                validationResults = data.results;
                
                // ç»Ÿè®¡æœ‰æ•ˆ/æ— æ•ˆæ•°é‡
                validationStats.valid = validationResults.filter(r => r.valid).length;
                validationStats.invalid = validationResults.filter(r => !r.valid && r.error_code !== 'NETWORK_ERROR').length;
                validationStats.error = validationResults.filter(r => r.error_code === 'NETWORK_ERROR').length;
                
                // å®Œæˆè¿›åº¦
                progressCallback(100, 'éªŒè¯å®Œæˆ');
                updateValidationStats(keys.length, keys.length);
                
                // å®ŒæˆéªŒè¯
                finishValidation();
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.log('æœåŠ¡å™¨éªŒè¯è¢«å–æ¶ˆ');
                } else {
                    alert(`éªŒè¯å¤±è´¥: ${error.message}`);
                    document.getElementById('progress-container').style.display = 'none';
                    document.getElementById('validate-btn').disabled = false;
                    isValidating = false;
                }
            }
        }
        
        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(percentage, text) {
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const progressPercentage = document.getElementById('progress-percentage');
            
            progressBar.style.width = `${percentage}%`;
            progressText.textContent = text;
            progressPercentage.textContent = `${Math.round(percentage)}%`;
        }
        
        // æ˜¾ç¤ºéªŒè¯ç»“æœ
        function displayResults() {
            if (validationResults.length === 0) return;
            
            // ç»Ÿè®¡æ•°æ®
            const total = validationResults.length;
            const valid = validationResults.filter(r => r.valid).length;
            const invalid = total - valid;
            
            // æ›´æ–°æ‘˜è¦
            document.getElementById('total-count').textContent = total;
            document.getElementById('valid-count').textContent = valid;
            document.getElementById('invalid-count').textContent = invalid;
            
            // ç”Ÿæˆè¡¨æ ¼è¡Œ
            const tableBody = document.getElementById('results-body');
            tableBody.innerHTML = '';
            
            validationResults.forEach(result => {
                const row = document.createElement('tr');
                
                // å¯†é’¥å•å…ƒæ ¼ï¼ˆéšè—éƒ¨åˆ†å­—ç¬¦ï¼‰
                const keyCell = document.createElement('td');
                keyCell.textContent = maskApiKey(result.key);
                row.appendChild(keyCell);
                
                // çŠ¶æ€å•å…ƒæ ¼
                const statusCell = document.createElement('td');
                if (result.valid) {
                    statusCell.innerHTML = '<span class="valid-key">æœ‰æ•ˆ</span>';
                } else if (result.error_code === 'NETWORK_ERROR' || result.error_code === 'CONNECTION_ERROR' || result.error_code === 'TIMEOUT') {
                    statusCell.innerHTML = '<span class="network-error">ç½‘ç»œé”™è¯¯</span>';
                } else {
                    statusCell.innerHTML = '<span class="invalid-key">æ— æ•ˆ</span>';
                }
                row.appendChild(statusCell);
                
                // é”™è¯¯ä¿¡æ¯å•å…ƒæ ¼
                const errorCell = document.createElement('td');
                errorCell.textContent = result.error_message || '-';
                row.appendChild(errorCell);
                
                tableBody.appendChild(row);
            });
            
            // æ˜¾ç¤ºç»“æœå®¹å™¨
            document.getElementById('results-container').style.display = 'block';
        }
        
        // éšè—éƒ¨åˆ†APIå¯†é’¥å­—ç¬¦
        function maskApiKey(key) {
            if (!key || key.length < 8) return key;
            
            const firstFour = key.slice(0, 4);
            const lastFour = key.slice(-4);
            return `${firstFour}...${lastFour}`;
        }
        
        // å¯¼å‡ºç»“æœ (æ–°ç‰ˆæœ¬æ”¯æŒä¸¤ç§å¯¼å‡ºæ¨¡å¼)
        async function exportResults(exportType) {
            if (validationResults.length === 0) {
                alert('æ²¡æœ‰ç»“æœå¯å¯¼å‡º');
                return;
            }
            
            try {
                // é€šè¿‡APIå¯¼å‡º
                if (!isClientSideValidation) {
                    // åˆ›å»ºè¯·æ±‚æ•°æ®
                    const requestData = {
                        results: validationResults,
                        export_type: exportType, // 'all' æˆ– 'valid'
                        api_type: currentApiType
                    };
                    
                    // å‘é€è¯·æ±‚
                    const response = await fetch('/export', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestData)
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'å¯¼å‡ºå¤±è´¥');
                    }
                    
                    // è·å–æ–‡ä»¶å
                    const contentDisposition = response.headers.get('Content-Disposition');
                    let fileName = `${currentApiType}_keys_validation_${exportType}.csv`;
                    if (contentDisposition) {
                        const match = contentDisposition.match(/filename="?([^"]+)"?/);
                        if (match && match[1]) {
                            fileName = match[1];
                        }
                    }
                    
                    // ä¸‹è½½æ–‡ä»¶
                    const blob = await response.blob();
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = fileName;
                    link.click();
                    URL.revokeObjectURL(url);
                } else {
                    // å®¢æˆ·ç«¯ç”Ÿæˆå¹¶å¯¼å‡ºCSV
                    let csvContent = 'APIå¯†é’¥,çŠ¶æ€,é”™è¯¯ä»£ç ,é”™è¯¯ä¿¡æ¯\n';
                    
                    // æ ¹æ®å¯¼å‡ºç±»å‹è¿‡æ»¤ç»“æœ
                    const resultsToExport = exportType === 'valid' 
                        ? validationResults.filter(r => r.valid)
                        : validationResults;
                    
                    resultsToExport.forEach(result => {
                        const status = result.valid ? 'æœ‰æ•ˆ' : 'æ— æ•ˆ';
                        const errorCode = result.error_code || '';
                        const errorMessage = result.error_message || '';
                        
                        // æ­£ç¡®å¤„ç†CSVæ ¼å¼
                        const escapedKey = `"${result.key.replace(/"/g, '""')}"`;
                        const escapedMessage = `"${errorMessage.replace(/"/g, '""')}"`;
                        
                        csvContent += `${escapedKey},${status},${errorCode},${escapedMessage}\n`;
                    });
                    
                    // åˆ›å»ºå¹¶ä¸‹è½½æ–‡ä»¶
                    const blob = new Blob([new Uint8Array([0xEF, 0xBB, 0xBF]), csvContent], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `${currentApiType}_keys_validation_${exportType}_${getFormattedDate()}.csv`;
                    link.click();
                    URL.revokeObjectURL(url);
                }
            } catch (error) {
                alert(`å¯¼å‡ºå¤±è´¥: ${error.message}`);
            }
        }
        
        // è·å–æ ¼å¼åŒ–æ—¥æœŸ
        function getFormattedDate() {
            const date = new Date();
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}${month}${day}`;
        }
        
        // è·å–æµè§ˆå™¨åç§°
        function getBrowserName(userAgent) {
            if (userAgent.indexOf("Firefox") > -1) return "Firefox";
            if (userAgent.indexOf("Opera") > -1 || userAgent.indexOf("OPR") > -1) return "Opera";
            if (userAgent.indexOf("Trident") > -1) return "Internet Explorer";
            if (userAgent.indexOf("Edge") > -1) return "Edge";
            if (userAgent.indexOf("Chrome") > -1) return "Chrome";
            if (userAgent.indexOf("Safari") > -1) return "Safari";
            return "Unknown";
        }
        
        // è·å–æ“ä½œç³»ç»Ÿåç§°
        function getOSName(userAgent) {
            if (userAgent.indexOf("Win") > -1) return "Windows";
            if (userAgent.indexOf("Mac") > -1) return "MacOS";
            if (userAgent.indexOf("Linux") > -1) return "Linux";
            if (userAgent.indexOf("Android") > -1) return "Android";
            if (userAgent.indexOf("iOS") > -1 || userAgent.indexOf("iPhone") > -1 || userAgent.indexOf("iPad") > -1) return "iOS";
            return "Unknown";
        }
    </script>
</body>
</html>
