<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyAIcheck - AIæ¥å£å¯†é’¥éªŒè¯å·¥å…·</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ”‘</text></svg>" type="image/svg+xml">
    <style>
        :root {
            --primary-color: #D88CA0; /* é™ä½é¥±å’Œåº¦çš„ç²‰è‰² */
            --primary-light: #E8B0BD; /* æ›´æŸ”å’Œçš„æµ…ç²‰è‰² */
            --primary-dark: #B56B80; /* æ›´æŸ”å’Œçš„æ·±ç²‰è‰² */
            --secondary-color: #9D79AC; /* æ›´æŸ”å’Œçš„ç´«è‰²è¾…åŠ©è‰² */
            --accent-color: #74A4CD; /* æ›´æŸ”å’Œçš„è“è‰²å¼ºè°ƒè‰² */
            --success-color: #7BAE80; /* æ›´æŸ”å’Œçš„ç»¿è‰² */
            --error-color: #D77A77; /* æ›´æŸ”å’Œçš„çº¢è‰² */
            --warning-color: #E0B883; /* æ›´æŸ”å’Œçš„é»„è‰² */
            --bg-color: #F6E9EE; /* æ›´æµ…çš„èƒŒæ™¯è‰² */
            --bg-gradient: linear-gradient(135deg, #F6E9EE 0%, #F0DCE4 100%); /* æ›´æŸ”å’Œçš„æ¸å˜èƒŒæ™¯ */
            --card-bg: #FFF5F8; /* å¾®æµ…ç²‰è‰²å¡ç‰‡èƒŒæ™¯ï¼Œä¸å†æ˜¯çº¯ç™½è‰² */
            --text-color: #5B5B5B; /* æ›´æŸ”å’Œçš„æ–‡æœ¬é¢œè‰² */
            --text-light: #8A8A8A; /* æ›´æŸ”å’Œçš„æµ…è‰²æ–‡æœ¬ */
            --border-color: #E8D0D8; /* æ›´æŸ”å’Œçš„è¾¹æ¡†é¢œè‰² */
            --border-radius: 12px; /* åœ†è§’åŠå¾„ */
            --box-shadow: 0 4px 20px rgba(216, 140, 160, 0.08); /* æ›´æŸ”å’Œçš„é˜´å½±æ•ˆæœ */
            --font-family: 'Helvetica Neue', Arial, sans-serif;
            --transition: all 0.3s ease;
        }
        
        /* æš—è‰²æ¨¡å¼å˜é‡ */
        .dark-mode {
            --primary-color: #88C0D0; /* Nordè“è‰²è°ƒ */
            --primary-light: #8FBCBB; /* Nordæµ…è“ */
            --primary-dark: #5E81AC; /* Nordæ·±è“ */
            --secondary-color: #B48EAD; /* Nordç´«è‰² */
            --accent-color: #81A1C1; /* Nordäº®è“ */
            --success-color: #A3BE8C; /* Nordç»¿è‰² */
            --error-color: #BF616A; /* Nordçº¢è‰² */
            --warning-color: #EBCB8B; /* Nordé»„è‰² */
            --bg-color: #2E3440; /* Nordæœ€æ·±èƒŒæ™¯ */
            --bg-gradient: linear-gradient(135deg, #2E3440 0%, #3B4252 100%); /* Nordæ¸å˜èƒŒæ™¯ */
            --card-bg: #3B4252; /* Nordæ¬¡æ·±èƒŒæ™¯ */
            --text-color: #ECEFF4; /* Nordé›ªç™½ */
            --text-light: #E5E9F0; /* Nordæµ…é›ªç™½ */
            --border-color: #4C566A; /* Nordæµ…ç°è‰² */
            --box-shadow: 0 4px 20px rgba(46, 52, 64, 0.5); /* é˜´å½±æ•ˆæœ */
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: var(--font-family);
            line-height: 1.5; /* å‡å°è¡Œé«˜ */
            color: var(--text-color);
            background: var(--bg-gradient);
            min-height: 100vh;
            padding: 10px 0; /* è¿›ä¸€æ­¥å‡å°ä¸Šä¸‹å†…è¾¹è· */
        }
        
        .container {
            max-width: 1400px; /* å¢åŠ å®½åº¦ */
            margin: 0 auto;
            padding: 0 10px; /* å‡å°å·¦å³å†…è¾¹è· */
        }
        
        header {
            text-align: center;
            margin-bottom: 1rem; /* å‡å°ä¸‹è¾¹è· */
            animation: fadeIn 1s ease;
        }
        
        h1 {
            font-size: 2.2rem; /* å‡å°å­—ä½“å¤§å° */
            margin-bottom: 0.5rem; /* å‡å°ä¸‹è¾¹è· */
            color: var(--primary-dark);
            font-weight: 600;
            letter-spacing: -0.5px;
        }
        
        .description {
            color: var(--text-light);
            margin-bottom: 0.8rem; /* å‡å°ä¸‹è¾¹è· */
            font-size: 1rem; /* å‡å°å­—ä½“å¤§å° */
        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 15px; /* å‡å°å†…è¾¹è· */
            margin-bottom: 1rem; /* å‡å°ä¸‹è¾¹è· */
            animation: slideUp 0.5s ease;
            border: 1px solid var(--border-color);
        }
        
        .api-type-selector {
            display: flex;
            flex-wrap: nowrap; /* ç¡®ä¿åœ¨ä¸€è¡Œæ˜¾ç¤º */
            gap: 8px; /* å‡å°é—´è· */
            margin-bottom: 15px;
            justify-content: center;
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: var(--card-bg);
            padding: 15px 0 5px;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
        }
        
        .api-type-btn {
            padding: 10px 15px; /* å‡å°å†…è¾¹è· */
            border: 2px solid var(--primary-light);
            background-color: white;
            color: var(--primary-dark);
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            font-size: 0.95rem; /* å‡å°å­—ä½“å¤§å° */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
            white-space: nowrap; /* é˜²æ­¢æ–‡æœ¬æ¢è¡Œ */
        }
        
        .api-type-btn::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: linear-gradient(rgba(255,255,255,0.2), transparent);
            pointer-events: none;
        }
        
        .api-type-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(240, 98, 146, 0.2);
        }
        
        .api-type-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 5px 15px rgba(240, 98, 146, 0.3);
        }
        
        .api-settings {
            margin: 15px 0; /* å‡å°ä¸Šä¸‹è¾¹è· */
            padding: 12px; /* å‡å°å†…è¾¹è· */
            border-radius: 10px;
            background-color: #F0E3E9; /* æ›´æŸ”å’Œçš„èƒŒæ™¯è‰² */
            border: 1px dashed var(--primary-light);
            animation: fadeIn 0.5s ease;
        }
        
        /* APIè®¾ç½®å®¹å™¨æ ·å¼ */
        .api-settings-container {
            margin: 15px 0;
            padding: 10px;
            border-radius: var(--border-radius);
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            animation: fadeIn 0.5s ease;
        }
        
        .dark-mode .api-settings-container {
            background-color: #3B4252;
            border-color: #4C566A;
        }
        
        .custom-settings {
            display: none;
            background-color: #EEE5F0; /* æ›´æŸ”å’Œçš„èƒŒæ™¯è‰² */
            border-color: #D4BCD9; /* æ›´æŸ”å’Œçš„è¾¹æ¡†è‰² */
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .model-select-container {
            margin-top: 10px; /* å‡å°ä¸Šè¾¹è· */
        }
        
        .model-select {
            width: 100%;
            padding: 10px; /* å‡å°å†…è¾¹è· */
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95rem; /* å‡å°å­—ä½“å¤§å° */
            color: var(--text-color);
            transition: var(--transition);
            background-color: white;
            margin-top: 5px; /* å‡å°ä¸Šè¾¹è· */
        }
        
        .model-select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(240, 98, 146, 0.2);
        }
        
        .input-group {
            margin-bottom: 1rem; /* å‡å°ä¸‹è¾¹è· */
        }
        
        .custom-input {
            width: 100%;
            padding: 10px; /* å‡å°å†…è¾¹è· */
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            color: var(--text-color);
            transition: var(--transition);
            background-color: white;
        }
        
        .custom-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(240, 98, 146, 0.2);
        }
        
        .custom-input::placeholder {
            color: #bdbdbd;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--primary-dark);
        }
        
        .toggle-container {
            display: flex;
            justify-content: space-between; /* ä¸¤ç«¯å¯¹é½ */
            align-items: center;
            margin-bottom: 15px;
            background-color: #F0E3E9;
            padding: 10px 15px;
            border-radius: 8px;
        }
        
        .toggle-label {
            margin-right: 15px;
            font-weight: 500;
            color: var(--primary-dark);
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 54px;
            height: 28px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f8bbd0;
            transition: var(--transition);
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        .help-text {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-left: 10px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-color);
        }
        
        .tab {
            padding: 12px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            transition: var(--transition);
            color: var(--text-light);
            position: relative;
        }
        
        .tab::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 3px;
            background-color: var(--primary-color);
            transition: var(--transition);
        }
        
        .tab.active {
            color: var(--primary-color);
        }
        
        .tab.active::after {
            width: 100%;
        }
        
        .tab:hover:not(.active) {
            color: var(--primary-dark);
        }
        
        textarea {
            width: 100%;
            min-height: 100px; /* å‡å°æ–‡æœ¬æ¡†é«˜åº¦ */
            padding: 10px; /* å‡å°å†…è¾¹è· */
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95rem; /* å‡å°å­—ä½“å¤§å° */
            resize: vertical;
            transition: var(--transition);
        }
        
        textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(240, 98, 146, 0.2);
        }
        
        .file-input-container {
            position: relative;
            margin-top: 10px;
        }
        
        .file-input-label {
            display: inline-block;
            padding: 12px 20px;
            background-color: #f8bbd0;
            color: var(--primary-dark);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }
        
        .file-input-label:hover {
            background-color: var(--primary-light);
        }
        
        .file-input-label i {
            margin-right: 8px;
        }
        
        .file-input {
            position: absolute;
            left: -9999px;
        }
        
        .file-name {
            margin-top: 8px;
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .actions-container {
            display: flex;
            gap: 8px; /* å‡å°æŒ‰é’®é—´éš” */
            margin-top: 1rem; /* å‡å°ä¸Šè¾¹è· */
            flex-wrap: wrap;
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px; /* å‡å°å†…è¾¹è· */
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.95rem; /* å‡å°å­—ä½“å¤§å° */
            font-weight: 500;
            text-align: center;
            transition: var(--transition);
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: linear-gradient(rgba(255,255,255,0.2), transparent);
            pointer-events: none;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(240, 98, 146, 0.3);
        }
        
        .btn-secondary {
            background-color: #f8bbd0;
            color: var(--primary-dark);
        }
        
        .btn-secondary:hover {
            background-color: var(--primary-light);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(240, 98, 146, 0.2);
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #43a047;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(102, 187, 106, 0.3);
        }
        
        .btn-pause {
            background-color: var(--warning-color);
            color: #5d4037;
        }
        
        .btn-pause:hover {
            background-color: #ffb300;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.3);
        }
        
        .progress {
            margin-top: 1rem; /* å‡å°ä¸Šè¾¹è· */
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--primary-dark);
            font-weight: 500;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 12px;
            background-color: #f8bbd0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-light), var(--primary-color));
            transition: width 0.3s ease;
            width: 0%;
            border-radius: 6px;
        }
        
        .dark-mode .progress-bar-container {
            background-color: #4C566A;
        }
        
        .dark-mode .progress-bar {
            background: linear-gradient(90deg, #81A1C1, #5E81AC);
        }
        
        .dark-mode .progress-info,
        .dark-mode .progress-stats {
            color: #E5E9F0;
        }
        
        .progress-stats {
            margin-top: 12px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .progress-control {
            margin-top: 12px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .results-container {
            margin-top: 0;
            display: block; /* é»˜è®¤æ˜¾ç¤º */
            animation: fadeIn 0.5s ease;
            height: 100%;
            overflow-y: auto;
            border-radius: var(--border-radius);
            background-color: var(--card-bg);
            box-shadow: var(--box-shadow);
            border: 1px solid var(--border-color);
            flex: 1;
        }
        
        /* ç»“æœè¡¨ä¸ºç©ºæ—¶æ˜¾ç¤ºæç¤ºä¿¡æ¯ */
        .results-empty {
            padding: 30px;
            text-align: center;
            color: var(--text-light);
            font-style: italic;
        }
        
        .results-heading {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .results-summary {
            padding: 0 15px;
        }
        
        .results-table-container {
            padding: 0 15px 15px;
            overflow-x: auto;
        }
        
        .results-heading h2 {
            color: var(--primary-dark);
            font-size: 1.6rem;
            margin: 0;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
        }
        
        .results-summary {
            display: flex;
            gap: 20px;
            margin-bottom: 2rem;
        }
        
        .summary-item {
            flex: 1;
            padding: 18px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.07);
            transition: var(--transition);
            border: none; /* ç§»é™¤è¾¹æ¡† */
        }
        
        .summary-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .summary-total {
            background-color: #E3EEF6; /* æ›´æŸ”å’Œçš„è“è‰² */
            border: none; /* ç§»é™¤è¾¹æ¡† */
        }
        
        .summary-valid {
            background-color: #E4F1E5; /* æ›´æŸ”å’Œçš„ç»¿è‰² */
            border: none; /* ç§»é™¤è¾¹æ¡† */
            color: var(--success-color);
        }
        
        .summary-invalid {
            background-color: #F2E5E5; /* æ›´æŸ”å’Œçš„çº¢è‰² */
            border: none; /* ç§»é™¤è¾¹æ¡† */
            color: var(--error-color);
        }
        
        .summary-item h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .summary-item p {
            font-size: 2.5rem;
            margin: 15px 0 0;
            font-weight: 600;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            table-layout: fixed; /* ä¸ºå®½å±ä¼˜åŒ–è¡¨æ ¼å¸ƒå±€ */
        }
        
        .results-table th, .results-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #f8bbd0;
        }
        
        .results-table th {
            background-color: #F0E3E9; /* æ›´æŸ”å’Œçš„è¡¨å¤´èƒŒæ™¯ */
            color: var(--primary-dark);
            font-weight: 600;
        }
        
        .results-table tr:nth-child(even) {
            background-color: #FAF2F5; /* æ›´æŸ”å’Œçš„æ–‘é©¬çº¹ */
        }
        
        .results-table tr:hover {
            background-color: #F0E3E9; /* æ›´æŸ”å’Œçš„hoverèƒŒæ™¯ */
        }
        
        .results-table th:nth-child(1),
        .results-table td:nth-child(1) {
            width: 30%; /* å¯†é’¥åˆ—å®½åº¦ */
            word-break: break-all;
        }
        
        .results-table th:nth-child(2),
        .results-table td:nth-child(2) {
            width: 15%; /* çŠ¶æ€åˆ—å®½åº¦ */
        }
        
        .results-table th:nth-child(3),
        .results-table td:nth-child(3) {
            width: 55%; /* é”™è¯¯ä¿¡æ¯åˆ—å®½åº¦ */
            word-break: break-word;
        }
        
        .valid-key {
            color: var(--success-color);
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        .valid-key::before {
            content: 'âœ“';
            margin-right: 5px;
        }
        
        .invalid-key {
            color: var(--error-color);
            font-weight: 500;
            display: flex;
            align-items: center;
        }
        
        .invalid-key::before {
            content: 'âœ—';
            margin-right: 5px;
        }
        
        .network-error {
            color: var(--warning-color);
            font-weight: 500;
            display: flex;
            align-items: center;
        }
        
        .network-error::before {
            content: '!';
            margin-right: 5px;
        }
        
        /* å®½å±é€‚é…çš„ä¸¤åˆ—å¸ƒå±€ */
        @media (min-width: 1200px) {
            .two-column-layout {
                display: flex;
                gap: 20px; /* å‡å°ä¸¤åˆ—é—´éš” */
                align-items: stretch; /* ç¡®ä¿ç­‰é«˜ */
                height: calc(100vh - 150px); /* å‡å»å¤´éƒ¨å’Œè¾¹è· */
                min-height: 500px; /* è®¾ç½®æœ€å°é«˜åº¦ */
            }
            
            .input-column, .results-column {
                flex: 1; /* å‡ç­‰åˆ†é…ç©ºé—´ */
                display: flex;
                flex-direction: column;
                justify-content: space-between; /* ç¡®ä¿å†…å®¹åˆ†å¸ƒå‡åŒ€ */
            }
            
            .card, .results-container {
                flex: 1; /* å æ»¡å¯ç”¨ç©ºé—´ */
                overflow-y: auto; /* å…è®¸å†…å®¹æ»šåŠ¨ */
                display: flex;
                flex-direction: column;
                margin-bottom: 0; /* ç§»é™¤åº•éƒ¨è¾¹è· */
            }
            
            /* æ·»åŠ åº•éƒ¨è‡ªåŠ¨å¯¹é½ */
            .input-column > .card, .results-column > .results-container {
                min-height: 100%; /* ç¡®ä¿å†…å®¹åŒºåŸŸè‡³å°‘å æ®æ•´ä¸ªé«˜åº¦ */
                height: 100%; /* å›ºå®šé«˜åº¦ */
                overflow-y: auto; /* å…è®¸å†…å®¹æ»šåŠ¨ */
            }
            
            .results-container {
                margin-top: 0;
                padding: 0; /* ç§»é™¤å†…è¾¹è·ï¼Œç”±å†…éƒ¨å…ƒç´ æ§åˆ¶ */
            }
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        @keyframes slideUp {
            0% { 
                opacity: 0; 
                transform: translateY(20px);
            }
            100% { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @media (max-width: 768px) {
            .results-summary {
                flex-direction: column;
                gap: 15px;
            }
            
            .api-type-selector {
                flex-direction: column;
                align-items: stretch;
            }
            
            .actions-container {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .results-heading {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .export-buttons {
                width: 100%;
                justify-content: space-between;
            }
        }
        
        .results-table tr:hover {
            background-color: #F0E3E9; /* æ›´æŸ”å’Œçš„hoverèƒŒæ™¯ */
        }
        
        .dark-mode .results-table th {
            background-color: #434C5E;
            color: #ECEFF4;
        }
        
        .dark-mode .results-table {
            border-color: #4C566A;
        }
        
        .dark-mode .results-table td {
            border-bottom-color: #4C566A;
        }
        
        .dark-mode .results-table tr:nth-child(even) {
            background-color: #3B4252;
        }
        
        .dark-mode .results-table tr:hover {
            background-color: #4C566A;
        }
        
        /* æš—è‰²æ¨¡å¼ä¸‹çš„æŒ‰é’®æ ·å¼ä¼˜åŒ– */
        .dark-mode .btn-primary {
            background-color: #5E81AC;
            color: #ECEFF4;
        }
        
        .dark-mode .btn-primary:hover {
            background-color: #81A1C1;
        }
        
        .dark-mode .btn-secondary {
            background-color: #4C566A;
            color: #E5E9F0;
        }
        
        .dark-mode .btn-secondary:hover {
            background-color: #5E81AC;
        }
        
        .dark-mode .btn-success {
            background-color: #A3BE8C;
            color: #2E3440;
        }
        
        .dark-mode .btn-success:hover {
            background-color: #8FBCBB;
        }
        
        .dark-mode .btn-pause {
            background-color: #EBCB8B;
            color: #2E3440;
        }
        
        .dark-mode .btn-pause:hover {
            background-color: #D08770;
        }
        
        .dark-mode .api-type-btn {
            border-color: #4C566A;
            background-color: #3B4252;
            color: #E5E9F0;
        }
        
        .dark-mode .api-type-btn.active {
            background-color: #5E81AC;
            color: #ECEFF4;
            border-color: #5E81AC;
        }
        
        .dark-mode .api-type-btn:hover {
            box-shadow: 0 5px 15px rgba(136, 192, 208, 0.3);
        }
        
        .results-table th:nth-child(1),
        .results-table td:nth-child(1) {
            width: 30%; /* å¯†é’¥åˆ—å®½åº¦ */
            word-break: break-all;
        }
        
        /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’®æ ·å¼ */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: transparent;
            border-radius: 50%;
            box-shadow: none;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .theme-toggle:hover {
            transform: translateY(-2px) rotate(15deg);
            box-shadow: 0 6px 15px rgba(236, 64, 122, 0.2);
            background-color: var(--primary-light);
        }
        
        .theme-toggle-icon {
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        /* èŠ‚ç‚¹ä¿¡æ¯æŒ‰é’®æ ·å¼ */
        .node-toggle {
            position: fixed;
            top: 20px;
            right: 70px;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: transparent;
            border-radius: 50%;
            box-shadow: none;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .node-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(236, 64, 122, 0.2);
            background-color: var(--primary-light);
        }
        
        .node-toggle-icon {
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        /* èŠ‚ç‚¹ä¿¡æ¯åŒºåŸŸæ ·å¼ */
        .node-info {
            position: fixed;
            top: 70px;
            right: 20px;
            width: 300px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 15px;
            z-index: 1000;
            border: 1px solid var(--border-color);
            max-height: 500px;
            overflow-y: auto;
            display: none;
        }
        
        .node-info.visible {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .node-info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .node-info-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin: 0;
        }
        
        .node-info-refresh {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-light);
            color: var(--card-bg);
            cursor: pointer;
            border: none;
            font-size: 1.2rem;
            transition: var(--transition);
        }
        
        .node-info-refresh:hover {
            transform: rotate(180deg);
            background-color: var(--primary-color);
        }
        
        .node-info-item {
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .node-info-label {
            font-weight: 500;
            color: var(--primary-color);
            margin-right: 5px;
        }
        
        .node-info-value {
            color: var(--text-color);
            word-break: break-all;
        }
        
        .node-info-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            color: var(--text-light);
        }
        
        /* æŒ‰é’®æ ‡å¿— */
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-left: 5px;
            vertical-align: middle;
        }
        
        .badge-warning {
            background-color: var(--warning-color);
            color: #5d4037;
        }
        
        .badge-info {
            background-color: var(--accent-color);
            color: white;
        }
        
        /* æš—è‰²æ¨¡å¼ä¸‹çš„æ–‡æœ¬è¾“å…¥å’Œé€‰æ‹©æ¡†æ ·å¼ */
        .dark-mode .custom-input,
        .dark-mode .model-select,
        .dark-mode textarea {
            background-color: #434C5E;
            color: #E5E9F0;
            border-color: #4C566A;
        }
        
        .dark-mode .custom-input::placeholder,
        .dark-mode textarea::placeholder {
            color: #D8DEE9;
        }
        
        .dark-mode .toggle-label,
        .dark-mode .input-group label,
        .dark-mode .tab,
        .dark-mode .toggle-container {
            color: #E5E9F0;
        }
        
        .dark-mode .toggle-container {
            background-color: #3B4252;
        }
        
        .dark-mode .tab.active {
            color: #88C0D0;
        }
        
        .dark-mode .tab::after {
            background-color: #88C0D0;
        }
        
        .dark-mode .api-settings {
            background-color: #3B4252;
            border-color: #4C566A;
        }
        
        .dark-mode .custom-settings {
            background-color: #2E3440;
            border-color: #4C566A;
        }
        
        .dark-mode .file-input-label {
            background-color: #4C566A;
            color: #E5E9F0;
        }
        
        .dark-mode .file-input-label:hover {
            background-color: #5E81AC;
        }
        
        .dark-mode .file-name {
            color: #D8DEE9;
        }
        
        /* æš—è‰²æ¨¡å¼ä¸‹çš„èŠ‚ç‚¹ä¿¡æ¯æ ·å¼ */
        .dark-mode .node-info {
            background-color: #3B4252;
            border-color: #4C566A;
        }
        
        .dark-mode .node-info-title {
            color: #88C0D0;
        }
        
        .dark-mode .node-info-refresh {
            background-color: #5E81AC;
            color: #ECEFF4;
        }
        
        .dark-mode .node-info-refresh:hover {
            background-color: #81A1C1;
        }
        
        .dark-mode .node-info-label {
            color: #88C0D0;
        }
        
        .dark-mode .node-info-value {
            color: #E5E9F0;
        }
        
        .dark-mode .node-toggle-icon,
        .dark-mode .theme-toggle-icon {
            color: #88C0D0;
        }
        
        .dark-mode .node-toggle,
        .dark-mode .theme-toggle {
            background-color: transparent;
            border-color: #4C566A;
        }
        
        .results-heading {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--card-bg);
            position: sticky;
            top: 0;
            z-index: 5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .results-heading h2 {
            margin: 0;
            font-size: 1.4rem;
            color: var(--primary-dark);
        }
        
        /* ç»“æœè¡¨ä¸ºç©ºæ—¶çš„æç¤ºæ ·å¼ */
        .results-empty {
            padding: 40px 20px;
            text-align: center;
            color: var(--text-light);
            font-style: italic;
            border-top: 1px solid var(--border-color);
            margin-top: 15px;
        }
        
        /* æ‰¹é‡å¤§å°è®¾ç½® */
        .batch-size-container {
            margin: 15px 0;
            padding: 10px 15px;
            background-color: #F0E3E9; /* æ›´æŸ”å’Œçš„èƒŒæ™¯è‰² */
            border-radius: 8px;
            border: 1px dashed var(--primary-light);
            animation: fadeIn 0.5s ease;
        }
        
        .dark-mode .batch-size-container {
            background-color: #3B4252;
            border-color: #4C566A;
        }
        
        .batch-size-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .batch-size-label {
            font-weight: 500;
            color: var(--primary-dark);
        }
        
        .dark-mode .batch-size-label {
            color: #88C0D0;
        }
        
        .batch-size-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .batch-size-input {
            width: 50px;
            padding: 5px;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            font-size: 0.9rem;
            color: var(--text-color);
            transition: var(--transition);
        }
        
        .dark-mode .batch-size-input {
            background-color: #434C5E;
            color: #E5E9F0;
            border-color: #4C566A;
        }
        
        .batch-size-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(240, 98, 146, 0.2);
        }
        
        .batch-size-slider {
            flex: 1;
            height: 10px;
            border-radius: 5px;
            background: linear-gradient(to right, var(--primary-light), var(--primary-dark));
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .batch-size-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .batch-size-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .dark-mode .batch-size-slider {
            background: linear-gradient(to right, #4C566A, #5E81AC);
        }
        
        .dark-mode .batch-size-slider::-webkit-slider-thumb {
            background: #88C0D0;
            border-color: #2E3440;
        }
        
        .dark-mode .batch-size-slider::-moz-range-thumb {
            background: #88C0D0;
            border-color: #2E3440;
        }
        
        .batch-size-marks {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.8rem;
            color: var(--text-light);
        }
        
        .dark-mode .batch-size-marks {
            color: #D8DEE9;
        }
        
        /* å¤œé—´æ¨¡å¼ä¸‹çš„ç»“æœæ‘˜è¦æ ·å¼ */
        .dark-mode .summary-total {
            background-color: #3B4252;
            border: none;
            color: #E5E9F0;
        }
        
        .dark-mode .summary-valid {
            background-color: #3B4252;
            border: none;
            color: #A3BE8C;
        }
        
        .dark-mode .summary-invalid {
            background-color: #3B4252;
            border: none;
            color: #BF616A;
        }
        
        .dark-mode .summary-item h3 {
            color: #88C0D0;
        }
        
        .dark-mode .summary-item p {
            color: #ECEFF4;
        }
        
        /* å¹¶å‘éªŒè¯è®¾ç½® */
        .concurrency-container {
            margin: 15px 0;
            padding: 10px 15px;
            background-color: #F0E3E9; /* æ›´æŸ”å’Œçš„èƒŒæ™¯è‰² */
            border-radius: 8px;
            border: 1px dashed var(--primary-light);
            animation: fadeIn 0.5s ease;
        }
        
        .dark-mode .concurrency-container {
            background-color: #3B4252;
            border-color: #4C566A;
        }
        
        .concurrency-header {
            display: flex;
            justify-content: space-between; /* ä¸¤ç«¯å¯¹é½ */
            align-items: center;
            margin-bottom: 10px;
        }
        
        .concurrency-label {
            font-weight: 500;
            color: var(--primary-dark);
        }
        
        .dark-mode .concurrency-label {
            color: #88C0D0;
        }
        
        .concurrency-info {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: var(--primary-light);
            color: white;
            border: none;
            font-size: 12px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .dark-mode .concurrency-info {
            background-color: #5E81AC;
        }
        
        .concurrency-toggle {
            position: relative;
            display: inline-block;
            width: 54px;
            height: 28px;
        }
        
        .concurrency-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .concurrency-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f8bbd0;
            transition: var(--transition);
            border-radius: 34px;
        }
        
        .concurrency-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }
        
        .concurrency-toggle input:checked + .concurrency-slider {
            background-color: var(--primary-color);
        }
        
        .concurrency-toggle input:checked + .concurrency-slider:before {
            transform: translateX(26px);
        }
        
        .concurrency-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .concurrency-value-label {
            font-weight: 500;
            color: var(--primary-dark);
        }
        
        .dark-mode .concurrency-value-label {
            color: #88C0D0;
        }
        
        .concurrency-input {
            width: 50px;
            padding: 5px;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            font-size: 0.9rem;
            color: var(--text-color);
            transition: var(--transition);
        }
        
        .dark-mode .concurrency-input {
            background-color: #434C5E;
            color: #E5E9F0;
        }
        
        .concurrency-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(240, 98, 146, 0.2);
        }
        
        .concurrency-input::placeholder {
            color: #bdbdbd;
        }
        
        .concurrency-help-text {
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .batch-size-info {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: var(--primary-light);
            color: white;
            border: none;
            font-size: 12px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .dark-mode .batch-size-info {
            background-color: #5E81AC;
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
        /* Webkitæµè§ˆå™¨ (Chrome, Safari, Edge) */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
            background-color: transparent;
        }
        
        ::-webkit-scrollbar-track {
            background-color: transparent;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background-color: rgba(240, 98, 146, 0.3);
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: padding-box;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background-color: rgba(240, 98, 146, 0.5);
        }
        
        /* Firefox */
        * {
            scrollbar-width: thin;
            scrollbar-color: rgba(240, 98, 146, 0.3) transparent;
        }
        
        /* æš—è‰²æ¨¡å¼æ»šåŠ¨æ¡ */
        .dark-mode::-webkit-scrollbar-thumb {
            background-color: rgba(136, 192, 208, 0.3);
        }
        
        .dark-mode::-webkit-scrollbar-thumb:hover {
            background-color: rgba(136, 192, 208, 0.5);
        }
        
        .dark-mode * {
            scrollbar-color: rgba(136, 192, 208, 0.3) transparent;
        }
        
        /* è®¾ç½®é¢æ¿æ ·å¼ */
        .settings-panel {
            margin: 15px 0;
            border-radius: 10px;
            background-color: var(--card-bg);
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background-color: #F0E3E9;
            cursor: pointer;
            transition: var(--transition);
            border-radius: 8px;
        }
        
        .dark-mode .settings-header {
            background-color: #3B4252;
        }
        
        .settings-header:hover {
            background-color: #E8D0D8;
        }
        
        .dark-mode .settings-header:hover {
            background-color: #4C566A;
        }
        
        .settings-title {
            font-weight: 500;
            color: var(--primary-dark);
        }
        
        .dark-mode .settings-title {
            color: #88C0D0;
        }
        
        .settings-arrow {
            transition: transform 0.3s ease;
        }
        
        .settings-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }
        
        .settings-content.expanded {
            padding: 15px;
            max-height: 400px;  /* å¢åŠ æœ€å¤§é«˜åº¦ */
            overflow-y: auto;   /* æ·»åŠ å‚ç›´æ»šåŠ¨æ¡ */
            scrollbar-width: thin;  /* Firefoxæ»šåŠ¨æ¡æ ·å¼ */
            scrollbar-color: var(--primary-light) transparent;  /* Firefoxæ»šåŠ¨æ¡é¢œè‰² */
        }
        
        .settings-content.expanded::-webkit-scrollbar {
            width: 8px;
        }
        
        .settings-content.expanded::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .settings-content.expanded::-webkit-scrollbar-thumb {
            background-color: var(--primary-light);
            border-radius: 4px;
        }
        
        .settings-section {
            margin-bottom: 15px;
        }
        
        .settings-section:last-child {
            margin-bottom: 0;
        }
        
        .settings-help {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }
        
        /* ä¾§è¾¹æ æ ·å¼ */
        .settings-sidebar {
            position: fixed;
            left: -400px;
            width: 400px;
            height: 100%;
            background-color: white;
            z-index: 1000;
            transition: left 0.3s ease;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.15);
            overflow-y: auto;
            padding: 15px 20px;
            border-radius: 0 16px 16px 0;
            background-image: linear-gradient(to bottom, rgba(255,255,255,0.05) 0%, rgba(0,0,0,0.02) 100%);
        }
        
        .dark-mode .settings-sidebar {
            background-color: #3B4252;
            background-image: linear-gradient(to bottom, rgba(255,255,255,0.03) 0%, rgba(0,0,0,0.1) 100%);
        }
        
        .settings-sidebar.open {
            left: 0;
        }
        
        .settings-sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 5px 0 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .settings-sidebar-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .settings-close-btn {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.8rem;  /* å¢å¤§å…³é—­æŒ‰é’®å­—ä½“ */
            cursor: pointer;
            padding: 0;
            width: 32px;        /* è®¾ç½®å›ºå®šå®½åº¦ */
            height: 32px;       /* è®¾ç½®å›ºå®šé«˜åº¦ */
            display: flex;      /* ä½¿ç”¨flexå¸ƒå±€ */
            align-items: center;
            justify-content: center;
            border-radius: 50%; /* åœ†å½¢æŒ‰é’® */
        }
        
        .settings-close-btn:hover {
            color: var(--primary-color);
            background-color: rgba(0, 0, 0, 0.05); /* æ·»åŠ æ‚¬åœèƒŒæ™¯è‰² */
        }
        
        /* ä¾§è¾¹æ å†…å®¹åŒºåŸŸæ·»åŠ å†…è¾¹è· */
        .settings-sidebar .settings-section {
            padding: 0 5px;
            margin-bottom: 18px;
        }
        
        /* ä¾§è¾¹æ åº•éƒ¨è¯´æ˜åŒºåŸŸæ·»åŠ å†…è¾¹è· */
        .settings-sidebar .settings-help,
        .settings-sidebar .settings-info {
            padding: 0 5px 15px;
        }
        
        /* å¼€å…³å’Œè¾“å…¥æ¡†é å³å¯¹é½ */
        .toggle-container {
            display: flex;
            justify-content: space-between; /* ä¸¤ç«¯å¯¹é½ */
            align-items: center;
            margin-bottom: 15px;
            background-color: #F0E3E9;
            padding: 10px 15px;
            border-radius: 8px;
        }
        
        .concurrency-header {
            display: flex;
            justify-content: space-between; /* ä¸¤ç«¯å¯¹é½ */
            align-items: center;
            margin-bottom: 10px;
        }
        
        .concurrency-controls {
            display: flex;
            justify-content: space-between; /* ä¸¤ç«¯å¯¹é½ */
            align-items: center;
            gap: 10px;
        }
        
        /* é½¿è½®æŒ‰é’® */
        .settings-gear-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background-color: var(--card-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            z-index: 999;
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease;
        }
        
        .settings-gear-btn:hover {
            transform: rotate(30deg);
        }
        
        /* æš—è‰²æ¨¡å¼ä¸‹çš„ä¾§è¾¹æ æ ·å¼ */
        .dark-mode .settings-sidebar {
            background-color: #3B4252;
            border-color: #4C566A;
        }
        
        .dark-mode .settings-sidebar-title {
            color: #88C0D0;
        }
        
        .dark-mode .settings-gear-btn {
            background-color: #3B4252;
            border-color: #4C566A;
        }
        
        .dark-mode .settings-close-btn {
            color: #E5E9F0;
        }
        
        .dark-mode .settings-close-btn:hover {
            color: #88C0D0;
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        /* æš—è‰²æ¨¡å¼ä¸‹çš„å‚æ•°è¯´æ˜åŒºåŸŸ */
        .dark-mode .settings-info h4,
        .dark-mode .settings-info h5 {
            color: #88C0D0 !important;
        }
        
        .dark-mode .settings-info div {
            background-color: rgba(136, 192, 208, 0.1) !important;
        }
        
        /* å¼¹å¹•æç¤ºæ ·å¼ */
        .toast-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            opacity: 0;
            transition: all 0.5s ease-out;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
        }
        
        .toast-notification.show {
            opacity: 1;
        }
        
        .toast-notification.hide {
            opacity: 0;
        }
        
        .toast-notification::before {
            content: "âœ“";
            margin-right: 8px;
            font-weight: bold;
            color: white;
            background-color: rgba(255, 255, 255, 0.2);
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }
        
        .dark-mode .toast-notification {
            background-color: #5E81AC;
        }
        
        /* èƒŒæ™¯é®ç½© */
        .settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
            opacity: 0.6; /* é™ä½ä¸é€æ˜åº¦ */
            transition: opacity 0.3s ease;
            backdrop-filter: blur(2px); /* æ·»åŠ æ¨¡ç³Šæ•ˆæœ */
        }
        
        /* é€šç”¨APIè®¾ç½® - å‡å°é—´è·ï¼Œæ›´ç´§å‡‘å¸ƒå±€ */
        #openai_like-settings .input-group {
            margin-bottom: 0.7rem; /* å‡å°ä¸‹è¾¹è· */
        }
        
        #openai_like-settings .model-select-container {
            margin-top: 0.5rem; /* å‡å°ä¸Šè¾¹è· */
        }
        
        #openai_like-settings .custom-input,
        #openai_like-settings .model-select {
            padding: 8px; /* å‡å°å†…è¾¹è· */
        }
        
        #custom-model-container .input-group {
            margin-bottom: 0.5rem; /* å‡å°ä¸‹è¾¹è· */
        }
        
        /* è°ƒæ•´éªŒè¯å¯†é’¥å’Œæ¸…é™¤æŒ‰é’®ä½ç½® */
        .actions-container {
            margin-top: 0.7rem; /* å‡å°ä¸Šè¾¹è· */
        }
        
        /* è°ƒæ•´é€šç”¨APIç•Œé¢çš„æ–‡æœ¬æ¡†é«˜åº¦ */
        #openai_like-settings + .tabs + #text-input-container textarea {
            min-height: 80px; /* å‡å°æ–‡æœ¬æ¡†é«˜åº¦ */
        }
        
        /* ç¡®ä¿é€šç”¨APIç±»å‹ä¸‹æ–‡æœ¬åŒºåŸŸè¶³å¤Ÿç´§å‡‘ */
        .api-type-btn[data-api-type="openai_like"].active ~ .api-settings-container + .tabs + #text-input-container textarea {
            min-height: 80px;
        }
        
        /* æ‰€æœ‰APIç±»å‹ä¸‹æ–‡æœ¬åŒºåŸŸè°ƒæ•´ */
        #text-input-container textarea {
            min-height: 80px; /* å…¨å±€å‡å°æ–‡æœ¬æ¡†é«˜åº¦ */
        }
        
        /* æ‰€æœ‰è¾“å…¥åŒºåŸŸè°ƒæ•´ */
        .input-group {
            margin-bottom: 0.8rem;
        }

        /* é€šç”¨APIç±»å‹ä¸‹çš„æ¨¡å‹å®¹å™¨ */
        #openai_like-settings .model-select-container {
            margin-bottom: 0.5rem;
        }
        
        /* å‡å°æ–‡ä»¶è¾“å…¥åŒºåŸŸé—´è· */
        #file-input-container {
            margin-top: 0.5rem;
        }
        
        /* å‡å°æ“ä½œæŒ‰é’®ä¸Šä¸‹é—´è· */
        .btn {
            padding: 8px 18px;
        }
        
        /* å³ä¸Šè§’æŒ‰é’®é€æ˜åŒ– */
        .dark-mode .node-toggle,
        .dark-mode .theme-toggle {
            background-color: transparent;
            border-color: rgba(255, 255, 255, 0.1);
            box-shadow: none;
        }
        
        /* å³ä¸Šè§’æŒ‰é’®é€æ˜åŒ– */
        .node-toggle,
        .theme-toggle,
        .settings-btn {
            background-color: transparent !important;
            border-color: rgba(255, 255, 255, 0.2) !important;
            box-shadow: none !important;
            opacity: 0.8;
            transition: var(--transition);
        }
        
        .node-toggle:hover,
        .theme-toggle:hover,
        .settings-btn:hover {
            opacity: 1;
            transform: translateY(-2px);
        }
        
        .dark-mode .node-toggle,
        .dark-mode .theme-toggle,
        .dark-mode .settings-btn {
            background-color: transparent !important;
            border-color: rgba(255, 255, 255, 0.1) !important;
            box-shadow: none !important;
        }
        
        /* è®¾ç½®æŒ‰é’®æ ·å¼ */
        .settings-btn {
            position: fixed;
            top: 20px;
            right: 120px;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: transparent;
            border-radius: 50%;
            box-shadow: none;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* è®¾ç½®ä¾§è¾¹æ æ ·å¼ä¼˜åŒ– */
        #settings-sidebar {
            position: fixed;
            top: 0;
            left: -400px; /* å¢åŠ å®½åº¦ */
            width: 400px; /* å¢åŠ å®½åº¦ï¼Œæ›´å¥½åœ°å®¹çº³å†…å®¹ */
            height: 100vh;
            background-color: var(--card-bg);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: var(--transition);
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid var(--border-color);
        }
    </style>
</head>
<body>
    <!-- æ·»åŠ ä¾§è¾¹æ  -->
    <div class="settings-overlay" id="settings-overlay"></div>
    
    <div class="settings-sidebar" id="settings-sidebar">
        <div class="settings-sidebar-header">
            <h3 class="settings-sidebar-title">éªŒè¯è®¾ç½®</h3>
            <button class="settings-close-btn" id="settings-close-btn">Ã—</button>
        </div>
        
        <!-- éªŒè¯æ–¹å¼è®¾ç½® -->
        <div class="settings-section">
            <div class="toggle-container">
                <span class="toggle-label">ä½¿ç”¨æµè§ˆå™¨ç«¯éªŒè¯:</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="client-side-toggle" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <div class="toggle-container auto-detect-container">
                <span class="toggle-label">è‡ªåŠ¨æ£€æµ‹å¯ç”¨æ¨¡å‹:</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="auto-detect-toggle" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
        
        <!-- å¹¶å‘è®¾ç½® -->
        <div class="settings-section">
            <div class="concurrency-container">
                <div class="concurrency-header">
                    <span class="concurrency-label">å¹¶å‘éªŒè¯:</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="concurrency-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="concurrency-controls" id="concurrency-controls">
                    <span class="concurrency-value-label">å¹¶å‘æ•°é‡:</span>
                    <input 
                        type="number" 
                        id="concurrency-input" 
                        min="1" 
                        max="10" 
                        value="3" 
                        class="concurrency-input"
                    >
                </div>
            </div>
            
            <div class="batch-size-container">
                <div class="batch-size-header">
                    <span class="batch-size-label">æ¯æ‰¹éªŒè¯æ•°é‡:</span>
                </div>
                <div class="batch-size-controls">
                    <input 
                        type="range" 
                        id="batch-size-slider" 
                        min="1" 
                        max="50" 
                        value="10" 
                        class="batch-size-slider"
                    >
                    <input 
                        type="number" 
                        id="batch-size-input" 
                        min="1" 
                        max="50" 
                        value="10" 
                        class="batch-size-input"
                    >
                </div>
                <div class="batch-size-marks">
                    <span>æ…¢(1)</span>
                    <span>å¹³è¡¡(10)</span>
                    <span>å¿«(50)</span>
                </div>
            </div>
        </div>
        
        <!-- ç§»é™¤å‚æ•°è¯´æ˜æŒ‰é’® -->
        
        <!-- å¼¹å¹•é€šçŸ¥å…ƒç´  -->
        <div id="toast-notification" class="toast-notification">è®¾ç½®å·²è‡ªåŠ¨ä¿å­˜</div>
        
        <!-- å‚æ•°è¯´æ˜ - å‡å°è¡Œè·å’Œå­—å·ï¼Œæ•´ä½“ä¸Šç§» -->
        <div class="settings-info">
            <h4 style="margin-top: 0; margin-bottom: 8px; color: var(--primary-dark); font-size: 1rem;">éªŒè¯å‚æ•°è¯´æ˜</h4>
            
            <div style="background-color: rgba(240, 98, 146, 0.1); padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                <h5 style="margin-top: 0; margin-bottom: 4px; color: var(--primary-dark); font-size: 0.95rem;">ã€æ‰¹é‡å¤§å°ã€‘</h5>
                <p style="margin: 0; font-size: 0.85rem; line-height: 1.3;">æ˜¯æŒ‡ä¸€æ¬¡æ€§å‘é€å¤šå°‘ä¸ªå¯†é’¥è¯·æ±‚:</p>
                <ul style="margin-top: 3px; padding-left: 16px; font-size: 0.85rem; line-height: 1.3;">
                    <li>å°æ‰¹é‡(1-10): é€Ÿåº¦è¾ƒæ…¢ä½†æ›´ç¨³å®šï¼Œé€‚åˆç½‘ç»œä¸ç¨³å®šæƒ…å†µ</li>
                    <li>ä¸­ç­‰å€¼(10-25): å¹³è¡¡çš„é€Ÿåº¦å’Œç¨³å®šæ€§ï¼Œé€‚åˆå¤§å¤šæ•°æƒ…å†µ</li>
                    <li>å¤§æ‰¹é‡(25-50): é€Ÿåº¦å¿«ä½†å¯èƒ½è§¦å‘APIé™åˆ¶</li>
                </ul>
            </div>
            
            <div style="background-color: rgba(240, 98, 146, 0.1); padding: 10px; border-radius: 8px;">
                <h5 style="margin-top: 0; margin-bottom: 4px; color: var(--primary-dark); font-size: 0.95rem;">ã€å¹¶å‘éªŒè¯ã€‘</h5>
                <p style="margin: 0; font-size: 0.85rem; line-height: 1.3;">åŒæ—¶å¤„ç†å¤šä¸ªæ‰¹æ¬¡:</p>
                <ul style="margin-top: 3px; padding-left: 16px; font-size: 0.85rem; line-height: 1.3;">
                    <li>å¯ç”¨åå¯å¤§å¹…æé«˜éªŒè¯é€Ÿåº¦</li>
                    <li>å¹¶å‘æ•°å»ºè®®3-5ä¸ªï¼Œå¤ªå¤šå¯èƒ½å¯¼è‡´APIé™åˆ¶</li>
                    <li>ç½‘ç»œä¸ç¨³å®šæ—¶å»ºè®®å…³é—­å¹¶å‘</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- æ·»åŠ é½¿è½®æŒ‰é’® -->
    <div class="settings-gear-btn" id="settings-gear-btn">âš™ï¸</div>
    
    <div class="container">
        <header>
            <h1>MyAIcheck</h1>
            <p class="description">ä¸€ç«™å¼AIæ¥å£å¯†é’¥éªŒè¯å·¥å…· | æ”¯æŒOpenAIã€Claudeã€Geminiç­‰å¤šå¹³å°</p>
        </header>
        
        <!-- æš—è‰²æ¨¡å¼åˆ‡æ¢æŒ‰é’® -->
        <div class="theme-toggle" id="theme-toggle">
            <span class="theme-toggle-icon">ğŸŒ™</span>
        </div>
        
        <!-- èŠ‚ç‚¹ä¿¡æ¯æŒ‰é’® -->
        <div class="node-toggle" id="node-toggle">
            <span class="node-toggle-icon">ğŸ“¶</span>
        </div>
        
        <!-- èŠ‚ç‚¹ä¿¡æ¯åŒºåŸŸ -->
        <div class="node-info" id="node-info">
            <div class="node-info-header">
                <h3 class="node-info-title">èŠ‚ç‚¹ä¿¡æ¯</h3>
                <button class="node-info-refresh" id="refresh-node-info">
                    â†»
                </button>
            </div>
            <div id="node-info-content">
                <div class="node-info-loading">æ­£åœ¨è·å–èŠ‚ç‚¹ä¿¡æ¯...</div>
            </div>
        </div>
        
        <div class="two-column-layout">
            <div class="input-column">
                <div class="card">
                    <div class="api-type-selector">
                        <button class="api-type-btn active" data-api-type="openai">OpenAI</button>
                        <button class="api-type-btn" data-api-type="claude">Claude</button>
                        <button class="api-type-btn" data-api-type="gemini">Gemini</button>
                        <button class="api-type-btn" data-api-type="deepseek">Deepseek</button>
                        <button class="api-type-btn" data-api-type="xai">XAI (Grok)</button>
                        <button class="api-type-btn" data-api-type="openai_like">é€šç”¨API</button>
                    </div>
                    
                    <!-- APIé…ç½®è®¾ç½® - ä»è®¾ç½®èœå•ç§»åˆ°å¤–éƒ¨ -->
                    <div class="api-settings-container">
                        <!-- OpenAIè®¾ç½® -->
                        <div id="openai-settings" class="api-settings">
                            <div class="model-select-container">
                                <label for="openai-model">é€‰æ‹©æ¨¡å‹:</label>
                                <select id="openai-model" class="model-select">
                                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                                    <option value="gpt-4">GPT-4</option>
                                    <option value="gpt-4-turbo">GPT-4 Turbo</option>
                                    <option value="gpt-4o">GPT-4o</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Claudeè®¾ç½® -->
                        <div id="claude-settings" class="api-settings" style="display: none;">
                            <div class="model-select-container">
                                <label for="claude-model">é€‰æ‹©æ¨¡å‹:</label>
                                <select id="claude-model" class="model-select">
                                    <option value="claude-3-opus-20240229">Claude 3 Opus</option>
                                    <option value="claude-3-sonnet-20240229">Claude 3 Sonnet</option>
                                    <option value="claude-3-haiku-20240307">Claude 3 Haiku</option>
                                    <option value="claude-3-5-sonnet-20240620">Claude 3.5 Sonnet</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Geminiè®¾ç½® -->
                        <div id="gemini-settings" class="api-settings" style="display: none;">
                            <div class="model-select-container">
                                <label for="gemini-model">é€‰æ‹©æ¨¡å‹:</label>
                                <select id="gemini-model" class="model-select">
                                    <option value="gemini-pro">Gemini Pro</option>
                                    <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                                    <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Deepseekè®¾ç½® -->
                        <div id="deepseek-settings" class="api-settings" style="display: none;">
                            <div class="model-select-container">
                                <label for="deepseek-model">é€‰æ‹©æ¨¡å‹:</label>
                                <select id="deepseek-model" class="model-select">
                                    <option value="deepseek-chat">Deepseek Chat</option>
                                    <option value="deepseek-coder">Deepseek Coder</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- XAI (Grok)è®¾ç½® -->
                        <div id="xai-settings" class="api-settings" style="display: none;">
                            <div class="model-select-container">
                                <label for="xai-model">é€‰æ‹©æ¨¡å‹:</label>
                                <select id="xai-model" class="model-select">
                                    <option value="grok-1">Grok-1</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- é€šç”¨APIè®¾ç½® -->
                        <div id="openai_like-settings" class="api-settings" style="display: none;">
                            <div class="input-group">
                                <label for="custom-api-url">APIç«¯ç‚¹ (å¿…é¡»ä»¥/v1ç»“å°¾):</label>
                                <input type="text" id="custom-api-url" class="custom-input" placeholder="ä¾‹å¦‚: https://api.example.com/v1">
                            </div>
                            
                            <div class="model-select-container">
                                <label for="openai_like-model">æ¨¡å‹åç§°:</label>
                                <select id="openai_like-model" class="model-select">
                                    <option value="loading" disabled style="display: none;">æ­£åœ¨è·å–å¯ç”¨æ¨¡å‹...</option>
                                    <option value="failed" disabled style="display: none;">æ— æ³•è·å–æ¨¡å‹åˆ—è¡¨</option>
                                    <option value="custom">è‡ªå®šä¹‰æ¨¡å‹åç§°</option>
                                </select>
                            </div>
                            
                            <div id="custom-model-container" style="display: none;">
                                <div class="input-group">
                                    <label for="custom-model-name">è‡ªå®šä¹‰æ¨¡å‹åç§°:</label>
                                    <input type="text" id="custom-model-name" class="custom-input" placeholder="ä¾‹å¦‚: gpt-3.5-turbo">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tabs">
                        <div class="tab active" data-tab="text-input">æ–‡æœ¬è¾“å…¥</div>
                        <div class="tab" data-tab="file-input">æ–‡ä»¶è¾“å…¥</div>
                    </div>
                    
                    <div class="input-group" id="text-input-container">
                        <label for="keys-input">API å¯†é’¥ (æ¯è¡Œä¸€ä¸ª):</label>
                        <textarea id="keys-input" placeholder="åœ¨æ­¤è¾“å…¥æ‚¨çš„APIå¯†é’¥ï¼Œæ¯è¡Œä¸€ä¸ª..."></textarea>
                    </div>
                    
                    <div class="input-group" id="file-input-container" style="display: none;">
                        <label for="file-input">ä¸Šä¼  CSV æˆ–æ–‡æœ¬æ–‡ä»¶:</label>
                        <div class="file-input-container">
                            <label for="file-input" class="file-input-label">
                                é€‰æ‹©æ–‡ä»¶
                            </label>
                            <input type="file" id="file-input" class="file-input" accept=".csv,.txt">
                            <div class="file-name" id="file-name">æœªé€‰æ‹©æ–‡ä»¶</div>
                        </div>
                        <p class="help-text">æ–‡ä»¶ç¬¬ä¸€åˆ—åº”åŒ…å«APIå¯†é’¥</p>
                    </div>
                    
                    <div class="actions-container">
                        <button id="validate-btn" class="btn btn-primary">éªŒè¯å¯†é’¥</button>
                        <button id="clear-btn" class="btn btn-secondary">æ¸…é™¤</button>
                    </div>
                    
                    <div class="progress" id="progress-container">
                        <div class="progress-info">
                            <span id="progress-text">éªŒè¯ä¸­...</span>
                            <span id="progress-percentage">0%</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="progress-bar"></div>
                        </div>
                        <div class="progress-stats">
                            <span id="validated-count">å·²éªŒè¯: 0/0</span>
                            <span id="valid-progress">æœ‰æ•ˆ: 0</span>
                            <span id="invalid-progress">æ— æ•ˆ: 0</span>
                            <span id="error-progress">é”™è¯¯: 0</span>
                            <span id="time-remaining">é¢„è®¡å‰©ä½™æ—¶é—´: è®¡ç®—ä¸­...</span>
                        </div>
                        <div class="progress-control">
                            <button id="pause-btn" class="btn btn-pause">æš‚åœ</button>
                            <button id="cancel-btn" class="btn btn-secondary">å–æ¶ˆ</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="results-column">
                <div class="results-container" id="results-container">
                    <div class="results-heading">
                        <h2>éªŒè¯ç»“æœ</h2>
                        <div class="export-buttons">
                            <button id="export-valid-results-btn" class="btn btn-success">å¯¼å‡ºæœ‰æ•ˆå¯†é’¥</button>
                            <button id="export-all-results-btn" class="btn btn-secondary">å¯¼å‡ºæ‰€æœ‰ç»“æœ</button>
                        </div>
                    </div>
                    
                    <div class="results-summary">
                        <div class="summary-item summary-total">
                            <h3>æ€»è®¡</h3>
                            <p id="total-count">0</p>
                        </div>
                        <div class="summary-item summary-valid">
                            <h3>æœ‰æ•ˆ</h3>
                            <p id="valid-count">0</p>
                        </div>
                        <div class="summary-item summary-invalid">
                            <h3>æ— æ•ˆ</h3>
                            <p id="invalid-count">0</p>
                        </div>
                    </div>
                    
                    <div class="results-table-container">
                        <table class="results-table" id="results-table">
                            <thead>
                                <tr>
                                    <th>å¯†é’¥</th>
                                    <th>çŠ¶æ€</th>
                                    <th>é”™è¯¯ä¿¡æ¯</th>
                                </tr>
                            </thead>
                            <tbody id="results-body">
                                <!-- ç»“æœä¼šè¢«åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                            </tbody>
                        </table>
                        <div class="results-empty" id="results-empty">
                            æš‚æ— éªŒè¯ç»“æœï¼Œè¯·åœ¨å·¦ä¾§è¾“å…¥APIå¯†é’¥å¹¶ç‚¹å‡»"éªŒè¯å¯†é’¥"æŒ‰é’®
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // å…¨å±€å˜é‡
        let currentApiType = 'openai';
        let validationResults = [];
        let isClientSideValidation = true;
        let isValidating = false;
        let isPaused = false;
        let validationQueue = [];
        let currentBatchIndex = 0;
        let validationStats = {
            valid: 0,
            invalid: 0,
            error: 0
        };
        let startTime = null;
        let validationController = null; // AbortControllerç”¨äºå–æ¶ˆéªŒè¯
        let isDarkMode = false; // æš—è‰²æ¨¡å¼çŠ¶æ€
        let nodeInfoVisible = false; // èŠ‚ç‚¹ä¿¡æ¯æ˜¾ç¤ºçŠ¶æ€
        let batchSize = 10; // æ‰¹é‡å¤§å°ï¼Œç°åœ¨å¯è‡ªå®šä¹‰
        let concurrencyEnabled = true; // æ˜¯å¦å¯ç”¨å¹¶å‘éªŒè¯
        let concurrencyCount = 3; // å¹¶å‘æ•°é‡
        let activeBatches = 0; // å½“å‰æ´»è·ƒçš„æ‰¹æ¬¡æ•°é‡
        let pendingQueue = []; // ç­‰å¾…å¤„ç†çš„å¹¶å‘é˜Ÿåˆ—
        let autoDetectModels = true; // æ˜¯å¦è‡ªåŠ¨æ£€æµ‹æ¨¡å‹
        let availableModels = {}; // æ¯ç§APIç±»å‹çš„å¯ç”¨æ¨¡å‹åˆ—è¡¨
        let modelDetectionInProgress = false; // æ¨¡å‹æ£€æµ‹æ˜¯å¦æ­£åœ¨è¿›è¡Œä¸­
        // ipdata APIå¯†é’¥ - åœ¨Vercelç¯å¢ƒå˜é‡ä¸­é…ç½®
        let ipdataApiKey = ''; // Vercelç¯å¢ƒå˜é‡ä¸­é…ç½®ï¼Œä¼šåœ¨åç«¯æ¥å£ä¸­æ³¨å…¥
        
        // APIéªŒè¯ç«¯ç‚¹é…ç½®
        const API_ENDPOINTS = {
            openai: {
                models: 'https://api.openai.com/v1/models',
                completions: 'https://api.openai.com/v1/chat/completions',
                payload: function(model) {
                    return {
                        model: model || 'gpt-3.5-turbo',
                        messages: [{ role: 'user', content: 'Hello' }],
                        max_tokens: 1
                    };
                }
            },
            claude: {
                models: 'https://api.anthropic.com/v1/models',
                completions: 'https://api.anthropic.com/v1/messages',
                payload: function(model) {
                    return {
                        model: model || 'claude-3-5-sonnet',
                        max_tokens: 1,
                        messages: [{ role: 'user', content: 'Hello' }]
                    };
                }
            },
            gemini: {
                models: 'https://generativelanguage.googleapis.com/v1beta/models',
                completions: 'https://generativelanguage.googleapis.com/v1beta/models/MODEL_NAME:generateContent',
                payload: function() {
                    return {
                        contents: [{ parts: [{ text: 'Hello' }] }]
                    };
                }
            },
            deepseek: {
                models: 'https://api.deepseek.com/v1/models',
                completions: 'https://api.deepseek.com/v1/chat/completions',
                payload: function(model) {
                    return {
                        model: model || 'deepseek-chat',
                        messages: [{ role: 'user', content: 'Hello' }],
                        max_tokens: 1
                    };
                }
            },
            xai: {
                models: 'https://api.xai.com/v1/models',
                completions: 'https://api.xai.com/v1/chat/completions',
                payload: function(model) {
                    return {
                        model: model || 'grok-1',
                        messages: [{ role: 'user', content: 'Hello' }],
                        max_tokens: 1
                    };
                }
            },
            // openai_like é…ç½®å°†åœ¨è¿è¡Œæ—¶åŠ¨æ€è®¾ç½®
            openai_like: {
                models: '', // ç”±ç”¨æˆ·æä¾›
                completions: '', // å°†åŸºäºmodels URLæ„å»º
                payload: function(model) {
                    return {
                        model: model || '', // ç”±ç”¨æˆ·æä¾›
                        messages: [{ role: 'user', content: 'Hello' }],
                        max_tokens: 1
                    };
                }
            }
        };
        
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½ä¸»é¢˜è®¾ç½®
            loadThemePreference();
            
            // åˆå§‹åŒ–ç»“æœåŒºåŸŸä¸ºç©ºçŠ¶æ€
            initializeEmptyResults();
            
            // åˆ‡æ¢APIç±»å‹
            document.querySelectorAll('.api-type-btn').forEach(button => {
                button.addEventListener('click', function() {
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    document.querySelectorAll('.api-type-btn').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // æ›´æ–°å½“å‰APIç±»å‹
                    currentApiType = this.dataset.apiType;
                    
                    // æ›´æ–°è®¾ç½®æ˜¾ç¤º
                    document.querySelectorAll('.api-settings').forEach(setting => setting.style.display = 'none');
                    document.getElementById(`${currentApiType}-settings`).style.display = 'block';
                    
                    // å°è¯•æ›´æ–°æ¨¡å‹é€‰æ‹©å™¨
                    if (autoDetectModels) {
                        // è·å–å½“å‰çš„APIå¯†é’¥
                        const keys = getApiKeys();
                        if (keys.length > 0) {
                            // å°è¯•æ£€æµ‹å½“å‰APIç±»å‹çš„å¯ç”¨æ¨¡å‹
                            detectAvailableModels(keys, currentApiType);
                        }
                    }
                    
                    // ä¿å­˜ç”¨æˆ·è®¾ç½®
                    saveUserSettings();
                });
            });
            
            // åˆ‡æ¢è¾“å…¥æ–¹å¼
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const tabName = this.dataset.tab;
                    document.getElementById('text-input-container').style.display = tabName === 'text-input' ? 'block' : 'none';
                    document.getElementById('file-input-container').style.display = tabName === 'file-input' ? 'block' : 'none';
                });
            });
            
            // æ–‡ä»¶é€‰æ‹©æ›´æ–°æ˜¾ç¤ºæ–‡ä»¶å
            document.getElementById('file-input').addEventListener('change', function(e) {
                const fileName = e.target.files.length > 0 ? e.target.files[0].name : 'æœªé€‰æ‹©æ–‡ä»¶';
                document.getElementById('file-name').textContent = fileName;
            });
            
            // éªŒè¯æŒ‰é’®
            document.getElementById('validate-btn').addEventListener('click', startValidation);
            
            // æ¸…é™¤æŒ‰é’®
            document.getElementById('clear-btn').addEventListener('click', function() {
                document.getElementById('keys-input').value = '';
                document.getElementById('file-input').value = '';
                document.getElementById('file-name').textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
                // document.getElementById('results-container').style.display = 'none'; // ç§»é™¤è¿™ä¸€è¡Œ
                document.getElementById('progress-container').style.display = 'none';
                validationResults = [];
                
                // é‡ç½®ä¸ºç©ºç»“æœçŠ¶æ€
                initializeEmptyResults();
            });
            
            // ç»“æœåŒºåŸŸå¯¼å‡ºæŒ‰é’®
            document.getElementById('export-valid-results-btn').addEventListener('click', function() {
                exportResults('valid');
            });
            
            document.getElementById('export-all-results-btn').addEventListener('click', function() {
                exportResults('all');
            });
            
            // å®¢æˆ·ç«¯éªŒè¯åˆ‡æ¢
            document.getElementById('client-side-toggle').addEventListener('change', function() {
                isClientSideValidation = this.checked;
            });
            
            // æš‚åœæŒ‰é’®
            document.getElementById('pause-btn').addEventListener('click', function() {
                if (isPaused) {
                    // ç»§ç»­éªŒè¯
                    isPaused = false;
                    this.textContent = 'æš‚åœ';
                    this.classList.remove('btn-primary');
                    this.classList.add('btn-pause');
                    continueValidation();
                } else {
                    // æš‚åœéªŒè¯
                    isPaused = true;
                    this.textContent = 'ç»§ç»­';
                    this.classList.remove('btn-pause');
                    this.classList.add('btn-primary');
                }
            });
            
            // å–æ¶ˆæŒ‰é’®
            document.getElementById('cancel-btn').addEventListener('click', function() {
                cancelValidation();
            });
            
            // æš—è‰²æ¨¡å¼åˆ‡æ¢ - å®Œå…¨é‡å†™ä»¥ä¿®å¤é—®é¢˜
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', function(event) {
                    event.preventDefault();
                    event.stopPropagation();
                    
                    // ç›´æ¥åŸºäºbodyç±»ååˆ‡æ¢æ¨¡å¼ï¼Œé¿å…ä¾èµ–isDarkModeå˜é‡
                    if (document.body.classList.contains('dark-mode')) {
                        // å½“å‰æ˜¯æš—è‰²æ¨¡å¼ï¼Œåˆ‡æ¢åˆ°äº®è‰²æ¨¡å¼
                        document.body.classList.remove('dark-mode');
                        this.querySelector('.theme-toggle-icon').textContent = 'ğŸŒ™';
                        localStorage.setItem('theme', 'light');
                        isDarkMode = false;
                        console.log("å·²åˆ‡æ¢åˆ°äº®è‰²æ¨¡å¼");
                    } else {
                        // å½“å‰æ˜¯äº®è‰²æ¨¡å¼ï¼Œåˆ‡æ¢åˆ°æš—è‰²æ¨¡å¼
                        document.body.classList.add('dark-mode');
                        this.querySelector('.theme-toggle-icon').textContent = 'â˜€ï¸';
                        localStorage.setItem('theme', 'dark');
                        isDarkMode = true;
                        console.log("å·²åˆ‡æ¢åˆ°æš—è‰²æ¨¡å¼");
                    }
                });
            }
            
            // åˆ·æ–°èŠ‚ç‚¹ä¿¡æ¯
            document.getElementById('refresh-node-info').addEventListener('click', fetchNodeInfo);
            
            // åˆå§‹è·å–èŠ‚ç‚¹ä¿¡æ¯
            fetchNodeInfo();
            
            // èŠ‚ç‚¹ä¿¡æ¯æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('node-toggle').addEventListener('click', toggleNodeInfo);
            
            // æ‰¹é‡å¤§å°æ»‘å—äº‹ä»¶
            const batchSizeSlider = document.getElementById('batch-size-slider');
            const batchSizeInput = document.getElementById('batch-size-input');
            
            // æ»‘å—æ”¹å˜æ—¶æ›´æ–°è¾“å…¥æ¡†
            batchSizeSlider.addEventListener('input', function() {
                batchSize = parseInt(this.value);
                batchSizeInput.value = batchSize;
            });
            
            // è¾“å…¥æ¡†æ”¹å˜æ—¶æ›´æ–°æ»‘å—
            batchSizeInput.addEventListener('change', function() {
                let value = parseInt(this.value);
                // é™åˆ¶åœ¨åˆæ³•èŒƒå›´å†…
                value = Math.max(1, Math.min(50, value));
                this.value = value;
                batchSize = value;
                batchSizeSlider.value = value;
            });
            
            // å¹¶å‘åˆ‡æ¢
            const concurrencyToggle = document.getElementById('concurrency-toggle');
            const concurrencyControls = document.getElementById('concurrency-controls');
            const concurrencyInput = document.getElementById('concurrency-input');
            
            // æ›´æ–°å¹¶å‘è®¾ç½®
            concurrencyToggle.addEventListener('change', function() {
                concurrencyEnabled = this.checked;
                concurrencyControls.style.display = concurrencyEnabled ? 'flex' : 'none';
            });
            
            concurrencyInput.addEventListener('change', function() {
                let value = parseInt(this.value);
                // é™åˆ¶åœ¨åˆæ³•èŒƒå›´å†…
                value = Math.max(1, Math.min(10, value));
                this.value = value;
                concurrencyCount = value;
            });
            
            // è‡ªåŠ¨æ£€æµ‹æ¨¡å‹åˆ‡æ¢
            document.getElementById('auto-detect-toggle').addEventListener('change', function() {
                autoDetectModels = this.checked;
            });
            
            
            // ä¿®æ”¹å„APIç±»å‹æ¨¡å‹é€‰æ‹©å™¨
            document.querySelectorAll('.model-select').forEach(select => {
                // æ·»åŠ åŠ è½½çŠ¶æ€é€‰é¡¹
                const loadingOption = document.createElement('option');
                loadingOption.value = 'loading';
                loadingOption.textContent = 'æ­£åœ¨åŠ è½½å¯ç”¨æ¨¡å‹...';
                loadingOption.disabled = true;
                loadingOption.style.display = 'none';
                select.appendChild(loadingOption);
                
                // æ·»åŠ æ£€æµ‹å¤±è´¥é€‰é¡¹
                const failedOption = document.createElement('option');
                failedOption.value = 'failed';
                failedOption.textContent = 'æ— æ³•è·å–æ¨¡å‹åˆ—è¡¨ (ä½¿ç”¨é¢„è®¾å€¼)';
                failedOption.disabled = true;
                failedOption.style.display = 'none';
                select.appendChild(failedOption);
            });
            
            // åˆå§‹åŒ–èŠ‚ç‚¹ä¿¡æ¯æ˜¾ç¤ºçŠ¶æ€
            concurrencyControls.style.display = concurrencyEnabled ? 'flex' : 'none';
            
            // åŠ è½½ç”¨æˆ·ä¹‹å‰çš„è®¾ç½®
            loadUserSettings();
            
            // è®¾ç½®ä¿å­˜ç”¨æˆ·è®¾ç½®çš„äº‹ä»¶ç›‘å¬å™¨
            setupSettingsSaving();
            
            // è®¾ç½®è‡ªå®šä¹‰APIæ¨¡å‹é€‰æ‹©å™¨é€»è¾‘
            const openaiLikeModelSelect = document.getElementById('openai_like-model');
            const customModelContainer = document.getElementById('custom-model-container');
            const customApiUrl = document.getElementById('custom-api-url');
            const customApiLoadingOption = openaiLikeModelSelect.querySelector('option[value="loading"]');
            
            // ç¡®ä¿å…¶ä»–APIç±»å‹çš„åŠ è½½çŠ¶æ€å¯è§æ€§ä¸€è‡´
            document.querySelectorAll('.api-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // å¦‚æœç‚¹å‡»çš„æ˜¯é€šç”¨APIæŒ‰é’®ï¼Œç¡®ä¿åŠ è½½é€‰é¡¹å¯è§
                    if (this.dataset.apiType === 'openai_like') {
                        // é‡ç½®é€šç”¨APIçš„æ¨¡å‹é€‰æ‹©å™¨çŠ¶æ€
                        const options = Array.from(openaiLikeModelSelect.options);
                        options.forEach(option => {
                            if (option.value === 'loading') {
                                option.style.display = 'block';
                            } else if (option.value === 'failed') {
                                option.style.display = 'none';
                            }
                        });
                        openaiLikeModelSelect.value = 'loading';
                    }
                });
            });
            
            openaiLikeModelSelect.addEventListener('change', function() {
                // å¦‚æœé€‰æ‹©çš„æ˜¯è‡ªå®šä¹‰é€‰é¡¹ï¼Œæ˜¾ç¤ºè¾“å…¥æ¡†
                if (this.value === 'custom') {
                    customModelContainer.style.display = 'block';
                } else {
                    customModelContainer.style.display = 'none';
                }
            });
            
            // ä¸ºkeys-inputæ·»åŠ äº‹ä»¶ï¼Œå½“è¾“å…¥å¯†é’¥æ—¶å°è¯•è·å–æ¨¡å‹åˆ—è¡¨
            document.getElementById('keys-input').addEventListener('input', function() {
                const currentApiType = document.querySelector('.api-type-btn.active').dataset.apiType;
                if (currentApiType === 'openai_like' && customApiUrl.value.trim() && customApiUrl.value.endsWith('/v1')) {
                    const keys = getApiKeys();
                    if (keys.length > 0 && autoDetectModels) {
                        // è®¾ç½®ä¸ºåŠ è½½çŠ¶æ€
                        customApiLoadingOption.style.display = 'block';
                        openaiLikeModelSelect.value = 'loading';
                        
                        // æ›´æ–°openai_likeé…ç½®
                        API_ENDPOINTS.openai_like.models = customApiUrl.value + '/models';
                        API_ENDPOINTS.openai_like.completions = customApiUrl.value + '/chat/completions';
                        detectAvailableModels(keys, 'openai_like');
                    }
                }
            });
            
            // ä¸ºcustom-api-urlæ·»åŠ inputäº‹ä»¶ï¼Œå½“URLè¾“å…¥å®Œæˆæ—¶æ£€æŸ¥æ˜¯å¦æœ‰key
            customApiUrl.addEventListener('input', function() {
                if (this.value.trim() && this.value.endsWith('/v1')) {
                    const keys = getApiKeys();
                    if (keys.length > 0 && autoDetectModels) {
                        // è®¾ç½®ä¸ºåŠ è½½çŠ¶æ€
                        customApiLoadingOption.style.display = 'block';
                        openaiLikeModelSelect.value = 'loading';
                        
                        // æ›´æ–°openai_likeé…ç½®å¹¶å°è¯•è·å–æ¨¡å‹
                        API_ENDPOINTS.openai_like.models = this.value + '/models';
                        API_ENDPOINTS.openai_like.completions = this.value + '/chat/completions';
                        detectAvailableModels(keys, 'openai_like');
                    }
                }
            });
            
            // ä¿ç•™ä¹‹å‰æ·»åŠ çš„blurå’Œkeyupäº‹ä»¶
            customApiUrl.addEventListener('blur', function() {
                if (this.value.trim() && this.value.endsWith('/v1')) {
                    const keys = getApiKeys();
                    if (keys.length > 0 && autoDetectModels) {
                        // è®¾ç½®ä¸ºåŠ è½½çŠ¶æ€
                        customApiLoadingOption.style.display = 'block';
                        openaiLikeModelSelect.value = 'loading';
                        
                        // æ›´æ–°openai_likeé…ç½®
                        API_ENDPOINTS.openai_like.models = this.value + '/models';
                        API_ENDPOINTS.openai_like.completions = this.value + '/chat/completions';
                        detectAvailableModels(keys, 'openai_like');
                    }
                }
            });
            
            // åˆå§‹è·å–èŠ‚ç‚¹ä¿¡æ¯
            fetchNodeInfo();
            
            // ä¾§è¾¹æ æ§åˆ¶é€»è¾‘
            const settingsGearBtn = document.getElementById('settings-gear-btn');
            const settingsSidebar = document.getElementById('settings-sidebar');
            const settingsOverlay = document.getElementById('settings-overlay');
            const settingsCloseBtn = document.getElementById('settings-close-btn');
            
            // åŠ è½½ä¾§è¾¹æ çŠ¶æ€
            const sidebarOpen = localStorage.getItem('settingsSidebarOpen') === 'true';
            if (sidebarOpen) {
                settingsSidebar.style.left = '0';
                settingsOverlay.style.display = 'block';
                
                // æ ¹æ®å±å¹•é«˜åº¦è°ƒæ•´ä¾§è¾¹æ é«˜åº¦ï¼Œé¿å…å‡ºç°æ»šåŠ¨æ¡
                adjustSidebarHeight();
            }
            
            // æ‰“å¼€ä¾§è¾¹æ 
            settingsGearBtn.addEventListener('click', function() {
                settingsSidebar.style.left = '0';
                settingsOverlay.style.display = 'block';
                localStorage.setItem('settingsSidebarOpen', 'true');
                
                // æ ¹æ®å±å¹•é«˜åº¦è°ƒæ•´ä¾§è¾¹æ é«˜åº¦ï¼Œé¿å…å‡ºç°æ»šåŠ¨æ¡
                adjustSidebarHeight();
            });
            
            // å…³é—­ä¾§è¾¹æ  - ç‚¹å‡»å…³é—­æŒ‰é’®
            settingsCloseBtn.addEventListener('click', closeSidebar);
            
            // å…³é—­ä¾§è¾¹æ  - ç‚¹å‡»é®ç½©å±‚
            settingsOverlay.addEventListener('click', closeSidebar);
        });
        
        // åˆå§‹åŒ–ç©ºç»“æœçŠ¶æ€
        function initializeEmptyResults() {
            // æ›´æ–°ç»Ÿè®¡æ•°æ®æ˜¾ç¤ºä¸º0
            document.getElementById('total-count').textContent = '0';
            document.getElementById('valid-count').textContent = '0';
            document.getElementById('invalid-count').textContent = '0';
            
            // æ¸…ç©ºç»“æœè¡¨æ ¼
            document.getElementById('results-body').innerHTML = '';
            
            // æ˜¾ç¤ºç©ºç»“æœæç¤º
            document.getElementById('results-empty').style.display = 'block';
            document.getElementById('results-table').style.display = 'none';
            
            // ç¦ç”¨å¯¼å‡ºæŒ‰é’®
            document.getElementById('export-valid-results-btn').disabled = true;
            document.getElementById('export-all-results-btn').disabled = true;
        }
        
        // åŠ è½½ä¸»é¢˜åå¥½
        function loadThemePreference() {
            // å°è¯•ä»localStorageè¯»å–ä¸»é¢˜è®¾ç½®
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                enableDarkMode();
            }
        }
        
        // åˆ‡æ¢æš—è‰²æ¨¡å¼
        function toggleDarkMode() {
            console.log("åˆ‡æ¢æš—è‰²æ¨¡å¼ï¼Œå½“å‰çŠ¶æ€:", isDarkMode);
            if (isDarkMode) {
                disableDarkMode();
            } else {
                enableDarkMode();
            }
        }
        
        // å¯ç”¨æš—è‰²æ¨¡å¼
        function enableDarkMode() {
            document.body.classList.add('dark-mode');
            document.getElementById('theme-toggle').querySelector('.theme-toggle-icon').textContent = 'â˜€ï¸';
            isDarkMode = true;
            localStorage.setItem('theme', 'dark');
        }
        
        // ç¦ç”¨æš—è‰²æ¨¡å¼
        function disableDarkMode() {
            document.body.classList.remove('dark-mode');
            document.getElementById('theme-toggle').querySelector('.theme-toggle-icon').textContent = 'ğŸŒ™';
            isDarkMode = false;
            localStorage.setItem('theme', 'light');
        }
        
        // åˆ‡æ¢èŠ‚ç‚¹ä¿¡æ¯æ˜¾ç¤º
        function toggleNodeInfo(event) {
            // é˜»æ­¢äº‹ä»¶å†’æ³¡
            event.stopPropagation();
            
            const nodeInfo = document.getElementById('node-info');
            if (nodeInfoVisible) {
                nodeInfo.classList.remove('visible');
                nodeInfoVisible = false;
            } else {
                nodeInfo.classList.add('visible');
                nodeInfoVisible = true;
                fetchNodeInfo(); // è·å–æœ€æ–°èŠ‚ç‚¹ä¿¡æ¯
            }
        }
        
        // ç‚¹å‡»å…¶ä»–åŒºåŸŸéšè—èŠ‚ç‚¹ä¿¡æ¯
        document.addEventListener('click', function(event) {
            const nodeInfo = document.getElementById('node-info');
            const nodeToggle = document.getElementById('node-toggle');
            
            // å¦‚æœç‚¹å‡»çš„ä¸æ˜¯èŠ‚ç‚¹ä¿¡æ¯åŒºåŸŸå’ŒèŠ‚ç‚¹ä¿¡æ¯æŒ‰é’®ï¼Œåˆ™éšè—èŠ‚ç‚¹ä¿¡æ¯
            if (nodeInfoVisible && 
                !nodeInfo.contains(event.target) && 
                !nodeToggle.contains(event.target)) {
                nodeInfo.classList.remove('visible');
                nodeInfoVisible = false;
            }
        });
        
        // é˜»æ­¢èŠ‚ç‚¹ä¿¡æ¯åŒºåŸŸå†…éƒ¨ç‚¹å‡»äº‹ä»¶å†’æ³¡
        document.getElementById('node-info').addEventListener('click', function(event) {
            event.stopPropagation();
        });
        
        // è·å–èŠ‚ç‚¹ä¿¡æ¯
        async function fetchNodeInfo() {
            const nodeInfoContent = document.getElementById('node-info-content');
            nodeInfoContent.innerHTML = '<div class="node-info-loading">æ­£åœ¨è·å–èŠ‚ç‚¹ä¿¡æ¯...</div>';
            
            try {
                // å…ˆè·å–IPåœ°å€
                fetch('https://api.ipify.org?format=json')
                    .then(response => response.json())
                    .then(data => {
                        const ip = data.ip;
                        document.getElementById('node-ip').textContent = ip;
                        
                        // ä½¿ç”¨ipdata APIè·å–æ›´å¤šä¿¡æ¯
                        // ä¼˜å…ˆä½¿ç”¨Vercelç¯å¢ƒå˜é‡ä¸­çš„APIå¯†é’¥ï¼Œå¦‚æœæœªé…ç½®åˆ™ä»localStorageè·å–
                        let apiKey = localStorage.getItem('ipdata_api_key') || ipdataApiKey;
                        
                        // å¦‚æœæ²¡æœ‰APIå¯†é’¥ï¼Œæç¤ºç”¨æˆ·è¾“å…¥
                        if (!apiKey) {
                            // å°†æç¤ºä¿®æ”¹ä¸ºå»ºè®®ç”¨æˆ·é…ç½®Vercelç¯å¢ƒå˜é‡
                            showToast('è¦è·å–åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œè¯·åœ¨Vercelä¸­é…ç½®IPDATA_API_KEYç¯å¢ƒå˜é‡', 'info', 5000);
                            document.getElementById('node-region').textContent = 'æœªçŸ¥ (éœ€è¦é…ç½®ipdata APIå¯†é’¥)';
                            document.getElementById('node-country').textContent = 'æœªçŸ¥';
                            document.getElementById('node-isp').textContent = 'æœªçŸ¥';
                            return;
                        }
                        
                        // ä½¿ç”¨APIå¯†é’¥è·å–åœ°ç†ä½ç½®ä¿¡æ¯
                        const ipDataUrl = `https://api.ipdata.co/${ip}?api-key=${apiKey}`;
                        
                        fetch(ipDataUrl)
                            .then(response => response.json())
                            .then(data => {
                                const countryName = data.country_name || 'Unknown';
                                const region = data.region || 'Unknown';
                                const city = data.city || 'Unknown';
                                const postalCode = data.postal || 'N/A';
                                const timezone = data.timezone || 'Unknown';
                                const isp = data.asn?.name || data.carrier?.name || 'Unknown';
                                
                                nodeInfoContent.innerHTML = `
                                    <div class="node-info-item">
                                        <span class="node-info-label">IP:</span>
                                        <span class="node-info-value">${ip}</span>
                                    </div>
                                    <div class="node-info-item">
                                        <span class="node-info-label">åœ°åŒº:</span>
                                        <span class="node-info-value">${countryName} (${postalCode})</span>
                                    </div>
                                    <div class="node-info-item">
                                        <span class="node-info-label">åŸå¸‚:</span>
                                        <span class="node-info-value">${city}</span>
                                    </div>
                                    <div class="node-info-item">
                                        <span class="node-info-label">ISP:</span>
                                        <span class="node-info-value">${isp}</span>
                                    </div>
                                    <div class="node-info-item">
                                        <span class="node-info-label">æ—¶åŒº:</span>
                                        <span class="node-info-value">${timezone}</span>
                                    </div>
                                    <div class="node-info-item">
                                        <span class="node-info-label">ASN:</span>
                                        <span class="node-info-value">${data.asn?.asn || 'Unknown'}</span>
                                    </div>
                                    <div class="node-info-item">
                                        <span class="node-info-label">IPç±»å‹:</span>
                                        <span class="node-info-value">${getIpType(data)}</span>
                                    </div>
                                    <div class="node-info-item">
                                        <span class="node-info-label">å¯ä¿¡åº¦åˆ†æ•°:</span>
                                        <span class="node-info-value" style="color: #66BB6A; font-weight: bold;">
                                            100 ${ipTrustScore < 30 ? '<span class="badge badge-warning">å±é™©</span>' : ''}
                                        </span>
                                    </div>
                                    <div class="node-info-item">
                                        <span class="node-info-label">èŠ‚ç‚¹ç±»å‹:</span>
                                        <span class="node-info-value">${getNodeType(data)}</span>
                                    </div>
                                    <div class="node-info-item">
                                        <span class="node-info-label">æµè§ˆå™¨:</span>
                                        <span class="node-info-value">${getBrowserName(navigator.userAgent)}</span>
                                    </div>
                                    <div class="node-info-item">
                                        <span class="node-info-label">æ“ä½œç³»ç»Ÿ:</span>
                                        <span class="node-info-value">${getOSName(navigator.userAgent)}</span>
                                    </div>
                                    <div class="node-info-item">
                                        <span class="node-info-label">è¯­è¨€:</span>
                                        <span class="node-info-value">${navigator.language}</span>
                                    </div>
                                    <div class="node-info-item">
                                        <span class="node-info-label">æ›´æ–°æ—¶é—´:</span>
                                        <span class="node-info-value">${new Date().toLocaleString()}</span>
                                    </div>
                                `;
                            })
                            .catch(error => {
                                console.error('è·å–èŠ‚ç‚¹ä¿¡æ¯å¤±è´¥:', error);
                                nodeInfoContent.innerHTML = `
                                    <div class="node-info-item">
                                        <span class="node-info-label">é”™è¯¯:</span>
                                        <span class="node-info-value">è·å–èŠ‚ç‚¹ä¿¡æ¯å¤±è´¥: ${error.message}</span>
                                    </div>
                                    <button class="btn btn-secondary" style="width: 100%; margin-top: 10px;" onclick="fetchNodeInfo()">é‡è¯•</button>
                                `;
                            });
                    })
                    .catch(error => {
                        console.error('è·å–IPåœ°å€å¤±è´¥:', error);
                        nodeInfoContent.innerHTML = `
                            <div class="node-info-item">
                                <span class="node-info-label">é”™è¯¯:</span>
                                <span class="node-info-value">è·å–IPåœ°å€å¤±è´¥: ${error.message}</span>
                            </div>
                            <button class="btn btn-secondary" style="width: 100%; margin-top: 10px;" onclick="fetchNodeInfo()">é‡è¯•</button>
                        `;
                    });
            } catch (error) {
                console.error('è·å–èŠ‚ç‚¹ä¿¡æ¯å¤±è´¥:', error);
                nodeInfoContent.innerHTML = `
                    <div class="node-info-item">
                        <span class="node-info-label">é”™è¯¯:</span>
                        <span class="node-info-value">è·å–èŠ‚ç‚¹ä¿¡æ¯å¤±è´¥: ${error.message}</span>
                    </div>
                    <button class="btn btn-secondary" style="width: 100%; margin-top: 10px;" onclick="fetchNodeInfo()">é‡è¯•</button>
                `;
            }
        }
        
        // è·å–IPç±»å‹ - åŒæ—¶æ”¯æŒipdataå’Œipapiæ ¼å¼
        function getIpType(data) {
            if (!data) return 'Unknown';
            
            const countryCode = data.country_code || data.country?.code;
            const countryName = data.country_name || data.country?.name;
            
            if (countryCode === 'US') return 'United States IP';
            if (countryCode === 'CN') return 'ä¸­å›½ IP';
            
            return `${countryName || 'Unknown'} IP`;
        }
        
        // è·å–èŠ‚ç‚¹ç±»å‹ - åŒæ—¶æ”¯æŒipdataå’Œipapiæ ¼å¼
        function getNodeType(data) {
            if (!data) return 'Unknown';
            
            const org = (data.org || data.asn?.name || data.carrier?.name || '').toLowerCase();
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºæ•°æ®ä¸­å¿ƒæˆ–äº‘æœåŠ¡æä¾›å•†
            if (org.includes('amazon') || 
                org.includes('aws') || 
                org.includes('microsoft') || 
                org.includes('azure') || 
                org.includes('google') || 
                org.includes('cloudflare') ||
                org.includes('digital ocean') ||
                org.includes('linode')) {
                return 'æ•°æ®ä¸­å¿ƒèŠ‚ç‚¹ <span class="badge badge-info">é«˜é€Ÿ</span>';
            }
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºç§»åŠ¨ç½‘ç»œ
            if (org.includes('mobile') || 
                org.includes('wireless') || 
                org.includes('cellular') ||
                (data.carrier && data.carrier.name)) {
                return 'ç§»åŠ¨ç½‘ç»œèŠ‚ç‚¹';
            }
            
            return 'æ™®é€šç½‘ç»œèŠ‚ç‚¹';
        }
        
        // å–æ¶ˆéªŒè¯
        function cancelValidation() {
            if (!isValidating) return;
            
            // ä¸­æ­¢å½“å‰æ‰€æœ‰è¯·æ±‚
            if (validationController) {
                validationController.abort();
            }
            
            isValidating = false;
            isPaused = false;
            activeBatches = 0;
            pendingQueue = [];
            
            // é‡ç½®UI
            document.getElementById('pause-btn').textContent = 'æš‚åœ';
            document.getElementById('pause-btn').classList.remove('btn-primary');
            document.getElementById('pause-btn').classList.add('btn-pause');
            document.getElementById('progress-container').style.display = 'none';
            document.getElementById('validate-btn').disabled = false;
            
            // å¦‚æœå·²æœ‰éƒ¨åˆ†ç»“æœï¼Œåˆ™æ˜¾ç¤º
            if (validationResults.length > 0) {
                displayResults();
                document.getElementById('export-valid-results-btn').disabled = false;
                document.getElementById('export-all-results-btn').disabled = false;
            } else {
                // æ²¡æœ‰ç»“æœï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
                initializeEmptyResults();
            }
        }
        
        // è§£æè¾“å…¥è·å–APIå¯†é’¥
        function getApiKeys() {
            const activeTab = document.querySelector('.tab.active').dataset.tab;
            
            if (activeTab === 'text-input') {
                const inputText = document.getElementById('keys-input').value.trim();
                if (!inputText) return [];
                
                // åˆ†è¡Œå¹¶è¿‡æ»¤ç©ºè¡Œï¼ŒåŒæ—¶æ”¯æŒé€—å·åˆ†éš”
                const keys = [];
                const lines = inputText.split('\n');
                
                lines.forEach(line => {
                    if (line.trim()) {
                        // å¦‚æœè¡Œä¸­åŒ…å«é€—å·ï¼Œåˆ™æŒ‰é€—å·åˆ†å‰²
                        if (line.includes(',')) {
                            const commaKeys = line.split(',').map(k => k.trim()).filter(k => k.length > 0);
                            keys.push(...commaKeys);
                        } else {
                            keys.push(line.trim());
                        }
                    }
                });
                
                return keys;
            } else {
                const fileInput = document.getElementById('file-input');
                if (!fileInput.files || fileInput.files.length === 0) return [];
                
                // æ–‡ä»¶å¤„ç†åœ¨å•ç‹¬çš„å‡½æ•°ä¸­è¿›è¡Œ
                return []; // æš‚æ—¶è¿”å›ç©ºæ•°ç»„ï¼Œå®é™…ä¼šåœ¨parseFileå‡½æ•°ä¸­å¼‚æ­¥å¤„ç†
            }
        }
        
        // è·å–å½“å‰é€‰æ‹©çš„æ¨¡å‹
        function getSelectedModel() {
            switch (currentApiType) {
                case 'openai':
                    return document.getElementById('openai-model').value;
                case 'claude':
                    return document.getElementById('claude-model').value;
                case 'gemini':
                    return document.getElementById('gemini-model').value;
                case 'deepseek':
                    return document.getElementById('deepseek-model').value;
                case 'xai':
                    return document.getElementById('xai-model').value;
                case 'openai_like':
                    return document.getElementById('custom-model-name').value.trim();
                default:
                    return null;
            }
        }
        
        // è·å–è‡ªå®šä¹‰APIé…ç½®
        function getCustomApiConfig() {
            if (currentApiType !== 'openai_like') return null;
            
            const customApiUrl = document.getElementById('custom-api-url').value.trim();
            let customModelName = '';
            
            // è·å–æ¨¡å‹åç§° - ä»é€‰æ‹©å™¨æˆ–è¾“å…¥æ¡†
            const modelSelect = document.getElementById('openai_like-model');
            if (modelSelect.value === 'custom') {
                // å¦‚æœé€‰æ‹©çš„æ˜¯è‡ªå®šä¹‰é€‰é¡¹ï¼Œåˆ™ä»è¾“å…¥æ¡†è·å–
                customModelName = document.getElementById('custom-model-name').value.trim();
            } else if (modelSelect.value !== 'loading' && modelSelect.value !== 'failed') {
                // å¦‚æœé€‰æ‹©çš„æ˜¯é¢„è®¾æˆ–è‡ªåŠ¨æ£€æµ‹çš„æ¨¡å‹
                customModelName = modelSelect.value;
            } else {
                // é»˜è®¤ä»è¾“å…¥æ¡†è·å–
                customModelName = document.getElementById('custom-model-name').value.trim();
            }
            
            if (!customApiUrl || !customModelName) {
                return null;
            }
            
            if (!customApiUrl.endsWith('/v1')) {
                alert('è‡ªå®šä¹‰API URLå¿…é¡»ä»¥ /v1 ç»“å°¾');
                return null;
            }
            
            // æ›´æ–°openai_likeé…ç½®
            API_ENDPOINTS.openai_like.models = customApiUrl + '/models';
            API_ENDPOINTS.openai_like.completions = customApiUrl + '/chat/completions';
            
            return {
                custom_api_url: customApiUrl,
                custom_model_name: customModelName
            };
        }
        
        // è§£ææ–‡ä»¶å†…å®¹
        function parseFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    const content = event.target.result;
                    let keys = [];
                    
                    if (file.name.toLowerCase().endsWith('.csv')) {
                        // è§£æCSV
                        const lines = content.split('\n');
                        keys = lines
                            .map(line => {
                                const columns = line.split(',');
                                return columns[0] ? columns[0].trim() : '';
                            })
                            .filter(key => key.length > 0);
                    } else {
                        // è§£ææ–‡æœ¬æ–‡ä»¶
                        keys = content.split('\n')
                            .map(line => line.trim())
                            .filter(line => line.length > 0);
                    }
                    
                    resolve(keys);
                };
                
                reader.onerror = function() {
                    reject(new Error('æ–‡ä»¶è¯»å–å¤±è´¥'));
                };
                
                reader.readAsText(file);
            });
        }
        
        // å¼€å§‹éªŒè¯è¿‡ç¨‹
        async function startValidation() {
            // å¦‚æœå½“å‰æ­£åœ¨éªŒè¯ï¼Œåˆ™ä¸æ‰§è¡Œ
            if (isValidating && !isPaused) return;
            
            // å¦‚æœæš‚åœçŠ¶æ€ï¼Œç»§ç»­éªŒè¯
            if (isValidating && isPaused) {
                continueValidation();
                return;
            }
            
            // é‡ç½®UIå’ŒçŠ¶æ€
            document.getElementById('results-body').innerHTML = '';
            validationResults = [];
            document.getElementById('export-valid-results-btn').disabled = true;
            document.getElementById('export-all-results-btn').disabled = true;
            
            // æ˜¾ç¤ºç©ºç»“æœçŠ¶æ€
            document.getElementById('results-empty').style.display = 'block';
            document.getElementById('results-table').style.display = 'none';
            
            validationStats = {
                valid: 0,
                invalid: 0,
                error: 0
            };
            
            isValidating = true;
            isPaused = false;
            currentBatchIndex = 0;
            activeBatches = 0;
            pendingQueue = [];
            startTime = Date.now();
            
            // ç¦ç”¨éªŒè¯æŒ‰é’®
            document.getElementById('validate-btn').disabled = true;
            
            // è·å–APIå¯†é’¥
            let keys = getApiKeys();
            
            // æ ¹æ®APIç±»å‹è®¾ç½®é…ç½®
            if (currentApiType === 'openai_like') {
                const customConfig = getCustomApiConfig();
                if (!customConfig) {
                    alert('è¯·æä¾›æœ‰æ•ˆçš„è‡ªå®šä¹‰API URLå’Œæ¨¡å‹åç§°');
                    document.getElementById('validate-btn').disabled = false;
                    isValidating = false;
                    return;
                }
            }
            
            // ä¸ºGeminiè®¾ç½®å¸¦æœ‰é€‰å®šæ¨¡å‹çš„completions URL
            if (currentApiType === 'gemini') {
                const selectedModel = getSelectedModel();
                API_ENDPOINTS.gemini.completions = API_ENDPOINTS.gemini.completions.replace('MODEL_NAME', selectedModel);
            }
            
            // å¦‚æœæ˜¯æ–‡ä»¶è¾“å…¥ï¼Œå¤„ç†æ–‡ä»¶
            const activeTab = document.querySelector('.tab.active').dataset.tab;
            if (activeTab === 'file-input') {
                const fileInput = document.getElementById('file-input');
                if (!fileInput.files || fileInput.files.length === 0) {
                    alert('è¯·é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶');
                    document.getElementById('validate-btn').disabled = false;
                    isValidating = false;
                    return;
                }
                
                try {
                    keys = await parseFile(fileInput.files[0]);
                } catch (error) {
                    alert(`æ–‡ä»¶è§£æé”™è¯¯: ${error.message}`);
                    document.getElementById('validate-btn').disabled = false;
                    isValidating = false;
                    return;
                }
            }
            
            // éªŒè¯æ˜¯å¦æœ‰å¯†é’¥
            if (keys.length === 0) {
                alert('æœªæ‰¾åˆ°APIå¯†é’¥');
                document.getElementById('validate-btn').disabled = false;
                isValidating = false;
                return;
            }
            
            // æ£€æŸ¥é‡å¤é¡¹
            const { uniqueKeys, duplicateCount } = removeDuplicates(keys);
            keys = uniqueKeys;
            
            // å¦‚æœæœ‰é‡å¤é¡¹ï¼Œæç¤ºç”¨æˆ·
            if (duplicateCount > 0) {
                alert(`æ£€æµ‹åˆ°${duplicateCount}ä¸ªé‡å¤çš„APIå¯†é’¥ï¼Œå·²è‡ªåŠ¨ç§»é™¤ã€‚å°†ä½¿ç”¨${keys.length}ä¸ªå”¯ä¸€å¯†é’¥è¿›è¡ŒéªŒè¯ã€‚`);
            }
            
            // å¢åŠ æ‰¹é‡éªŒè¯ä¸Šé™åˆ°5000ä¸ª
            if (keys.length > 5000) {
                if (!confirm(`æ‚¨æ­£åœ¨å°è¯•éªŒè¯${keys.length}ä¸ªå¯†é’¥ï¼Œè¿™å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ`)) {
                    document.getElementById('validate-btn').disabled = false;
                    isValidating = false;
                    return;
                }
            }
            
            // å‡†å¤‡éªŒè¯é˜Ÿåˆ—
            validationQueue = [...keys];
            
            // æ˜¾ç¤ºè¿›åº¦æ¡
            const progressContainer = document.getElementById('progress-container');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const progressPercentage = document.getElementById('progress-percentage');
            
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            progressText.textContent = 'å‡†å¤‡éªŒè¯...';
            progressPercentage.textContent = '0%';
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateValidationStats(0, keys.length);
            
            // é€‰æ‹©éªŒè¯æ–¹å¼
            if (isClientSideValidation) {
                // åˆ›å»ºæ–°çš„AbortControllerç”¨äºå–æ¶ˆéªŒè¯
                validationController = new AbortController();
                
                // å¯åŠ¨éªŒè¯å¤„ç† - ä½¿ç”¨å¹¶å‘å¤„ç†
                if (concurrencyEnabled) {
                    // åˆå§‹å¯åŠ¨å¤šä¸ªå¹¶å‘æ‰¹æ¬¡
                    const initialBatchCount = Math.min(concurrencyCount, Math.ceil(validationQueue.length / batchSize));
                    for (let i = 0; i < initialBatchCount; i++) {
                        processConcurrentBatch();
                    }
                } else {
                    // é¡ºåºå¤„ç†
                    processValidationBatch();
                }
            } else {
                await validateKeysServerSide(keys, updateProgress);
            }
        }
        
        // ç§»é™¤é‡å¤å¯†é’¥
        function removeDuplicates(keys) {
            const uniqueSet = new Set();
            const uniqueKeys = [];
            let duplicateCount = 0;
            
            keys.forEach(key => {
                if (!uniqueSet.has(key)) {
                    uniqueSet.add(key);
                    uniqueKeys.push(key);
                } else {
                    duplicateCount++;
                }
            });
            
            return { uniqueKeys, duplicateCount };
        }
        
        // ç»§ç»­éªŒè¯
        function continueValidation() {
            if (!isValidating || !isPaused) return;
            
            isPaused = false;
            processValidationBatch();
        }
        
        // å¤„ç†éªŒè¯æ‰¹æ¬¡ (é¡ºåºæ‰§è¡Œç‰ˆæœ¬)
        async function processValidationBatch() {
            if (!isValidating || isPaused) return;
            
            // åˆ›å»ºæ–°çš„AbortControllerç”¨äºæœ¬æ‰¹æ¬¡è¯·æ±‚
            validationController = new AbortController();
            
            const totalKeys = validationQueue.length;
            const processedCount = validationResults.length;
            
            // å¦‚æœæ‰€æœ‰æ‰¹æ¬¡å·²å¤„ç†å®Œæ¯•
            if (currentBatchIndex >= validationQueue.length) {
                finishValidation();
                return;
            }
            
            // è·å–å½“å‰æ‰¹æ¬¡
            const endIndex = Math.min(currentBatchIndex + batchSize, validationQueue.length);
            const currentBatch = validationQueue.slice(currentBatchIndex, endIndex);
            
            try {
                // é€‰æ‹©çš„æ¨¡å‹
                const selectedModel = getSelectedModel();
                
                // å¹¶è¡ŒéªŒè¯å½“å‰æ‰¹æ¬¡
                const batchPromises = currentBatch.map(key => 
                    validateSingleKeyClientSide(key, currentApiType, selectedModel, validationController.signal)
                );
                
                // ç­‰å¾…å½“å‰æ‰¹æ¬¡å®Œæˆ
                const batchResults = await Promise.all(batchPromises);
                
                // æ›´æ–°ç»“æœ
                validationResults.push(...batchResults);
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                batchResults.forEach(result => {
                    if (result.valid) validationStats.valid++;
                    else if (result.error_code === 'NETWORK_ERROR') validationStats.error++;
                    else validationStats.invalid++;
                });
                
                // æ›´æ–°è¿›åº¦
                const newProcessedCount = processedCount + currentBatch.length;
                const progress = (newProcessedCount / totalKeys) * 100;
                updateProgress(progress, `å·²éªŒè¯ ${newProcessedCount}/${totalKeys}`);
                updateValidationStats(newProcessedCount, totalKeys);
                
                // æ›´æ–°å½“å‰æ‰¹æ¬¡ç´¢å¼•
                currentBatchIndex = endIndex;
                
                // å¦‚æœæš‚åœï¼Œåˆ™ä¸ç»§ç»­å¤„ç†
                if (isPaused) return;
                
                // æ‰¹æ¬¡é—´å»¶è¿Ÿï¼Œé¿å…APIé™åˆ¶
                if (currentBatchIndex < validationQueue.length) {
                    // æ ¹æ®æ‰¹æ¬¡å¤§å°è°ƒæ•´å»¶è¿Ÿæ—¶é—´ï¼šæ‰¹æ¬¡è¶Šå¤§ï¼Œå»¶è¿Ÿè¶Šé•¿
                    const delay = Math.min(100 + (batchSize * 50), 2000); // æœ€å°å»¶è¿Ÿ500msï¼Œæœ€å¤§å»¶è¿Ÿ2000ms
                    setTimeout(processValidationBatch, delay);
                } else {
                    finishValidation();
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.log('éªŒè¯è¢«å–æ¶ˆ');
                } else {
                    console.error('æ‰¹æ¬¡å¤„ç†é”™è¯¯:', error);
                    
                    // å¦‚æœå‡ºé”™ä½†æœªè¢«å–æ¶ˆï¼Œå°è¯•ç»§ç»­å¤„ç†
                    if (isValidating && !isPaused) {
                        setTimeout(processValidationBatch, 2000); // å»¶è¿Ÿæ›´é•¿æ—¶é—´åé‡è¯•
                    }
                }
            }
        }
        
        // å¤„ç†å¹¶å‘éªŒè¯æ‰¹æ¬¡ (å¹¶å‘æ‰§è¡Œç‰ˆæœ¬)
        async function processConcurrentBatch() {
            if (!isValidating || isPaused) return;
            
            // å¦‚æœå·²ç»è¾¾åˆ°æœ€å¤§å¹¶å‘æ•°ï¼Œåˆ™ä¸ç»§ç»­æ·»åŠ æ–°ä»»åŠ¡
            if (activeBatches >= concurrencyCount) return;
            
            // å¢åŠ æ´»è·ƒæ‰¹æ¬¡è®¡æ•°
            activeBatches++;
            
            try {
                const totalKeys = validationQueue.length;
                
                // å¦‚æœæ‰€æœ‰æ‰¹æ¬¡å·²å¤„ç†å®Œæ¯•
                if (currentBatchIndex >= validationQueue.length) {
                    // å‡å°‘æ´»è·ƒæ‰¹æ¬¡è®¡æ•°
                    activeBatches--;
                    
                    // å¦‚æœæ²¡æœ‰æ›´å¤šæ´»è·ƒæ‰¹æ¬¡ï¼Œå®ŒæˆéªŒè¯
                    if (activeBatches === 0 && pendingQueue.length === 0) {
                        finishValidation();
                    }
                    return;
                }
                
                // è·å–å½“å‰æ‰¹æ¬¡
                const endIndex = Math.min(currentBatchIndex + batchSize, validationQueue.length);
                const currentBatch = validationQueue.slice(currentBatchIndex, endIndex);
                
                // ç§»åŠ¨æŒ‡é’ˆåˆ°ä¸‹ä¸€æ‰¹
                currentBatchIndex = endIndex;
                
                // é€‰æ‹©çš„æ¨¡å‹
                const selectedModel = getSelectedModel();
                
                // è·å–å½“å‰å·²å¤„ç†çš„æ•°é‡
                const processedCountBefore = validationResults.length;
                
                // å¹¶è¡ŒéªŒè¯å½“å‰æ‰¹æ¬¡
                const batchPromises = currentBatch.map(key => 
                    validateSingleKeyClientSide(key, currentApiType, selectedModel, validationController.signal)
                );
                
                // ç­‰å¾…å½“å‰æ‰¹æ¬¡å®Œæˆ
                const batchResults = await Promise.all(batchPromises);
                
                // ç¡®ä¿æˆ‘ä»¬ä»åœ¨éªŒè¯ä¸­ï¼ˆå¯èƒ½åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­è¢«å–æ¶ˆï¼‰
                if (!isValidating) {
                    activeBatches--;
                    return;
                }
                
                // æ›´æ–°ç»“æœ
                validationResults.push(...batchResults);
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                batchResults.forEach(result => {
                    if (result.valid) validationStats.valid++;
                    else if (result.error_code === 'NETWORK_ERROR') validationStats.error++;
                    else validationStats.invalid++;
                });
                
                // æ›´æ–°è¿›åº¦
                const newProcessedCount = validationResults.length;
                const progress = (newProcessedCount / totalKeys) * 100;
                updateProgress(progress, `å·²éªŒè¯ ${newProcessedCount}/${totalKeys}`);
                updateValidationStats(newProcessedCount, totalKeys);
                
                // å‡å°‘æ´»è·ƒæ‰¹æ¬¡è®¡æ•°
                activeBatches--;
                
                // å¦‚æœæš‚åœï¼Œåˆ™ä¸ç»§ç»­å¤„ç†
                if (isPaused) return;
                
                // å¦‚æœè¿˜æœ‰æ›´å¤šè¦å¤„ç†ï¼Œå»¶è¿Ÿä¸€ä¸‹å†å¯åŠ¨ä¸‹ä¸€ä¸ªæ‰¹æ¬¡
                if (currentBatchIndex < validationQueue.length) {
                    // æ ¹æ®æ‰¹æ¬¡å¤§å°è°ƒæ•´å»¶è¿Ÿæ—¶é—´
                    const delay = Math.min(50 + (batchSize * 20), 1000); // å¹¶å‘æ¨¡å¼ä¸‹ä½¿ç”¨æ›´çŸ­çš„å»¶è¿Ÿ
                    setTimeout(processConcurrentBatch, delay);
                } else if (activeBatches === 0) {
                    // æ²¡æœ‰æ›´å¤šè¦å¤„ç†ï¼Œä¸”æ‰€æœ‰æ´»è·ƒæ‰¹æ¬¡å·²å®Œæˆ
                    finishValidation();
                }
            } catch (error) {
                // å‡å°‘æ´»è·ƒæ‰¹æ¬¡è®¡æ•°
                activeBatches--;
                
                if (error.name === 'AbortError') {
                    console.log('å¹¶å‘éªŒè¯è¢«å–æ¶ˆ');
                } else {
                    console.error('å¹¶å‘æ‰¹æ¬¡å¤„ç†é”™è¯¯:', error);
                    
                    // å¦‚æœå‡ºé”™ä½†æœªè¢«å–æ¶ˆï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€æ‰¹
                    if (isValidating && !isPaused && currentBatchIndex < validationQueue.length) {
                        setTimeout(processConcurrentBatch, 2000); // å»¶è¿Ÿæ›´é•¿æ—¶é—´åé‡è¯•
                    } else if (activeBatches === 0) {
                        // å¦‚æœæ²¡æœ‰æ›´å¤šæ´»è·ƒæ‰¹æ¬¡ï¼Œä¸”å·²ç»å¤„ç†å®Œæ‰€æœ‰æ‰¹æ¬¡
                        finishValidation();
                    }
                }
            }
            
            // å°è¯•å¯åŠ¨æ›´å¤šæ‰¹æ¬¡ï¼Œä¿æŒå¹¶å‘åº¦
            if (isValidating && !isPaused && activeBatches < concurrencyCount && currentBatchIndex < validationQueue.length) {
                setTimeout(processConcurrentBatch, 100);
            }
        }
        
        // å®ŒæˆéªŒè¯
        function finishValidation() {
            isValidating = false;
            document.getElementById('validate-btn').disabled = false;
            
            // ç¡®ä¿è¿›åº¦æ¡æ˜¾ç¤º100%å®Œæˆ
            updateProgress(100, 'éªŒè¯å®Œæˆ');
            
            // æ˜¾ç¤ºç»“æœ
            displayResults();
            
            // å¯ç”¨å¯¼å‡ºæŒ‰é’®
            document.getElementById('export-valid-results-btn').disabled = false;
            document.getElementById('export-all-results-btn').disabled = false;
        }
        
        // æ›´æ–°éªŒè¯ç»Ÿè®¡ä¿¡æ¯
        function updateValidationStats(processedCount, totalCount) {
            document.getElementById('validated-count').textContent = `å·²éªŒè¯: ${processedCount}/${totalCount}`;
            document.getElementById('valid-progress').textContent = `æœ‰æ•ˆ: ${validationStats.valid}`;
            document.getElementById('invalid-progress').textContent = `æ— æ•ˆ: ${validationStats.invalid}`;
            document.getElementById('error-progress').textContent = `é”™è¯¯: ${validationStats.error}`;
            
            // è®¡ç®—é¢„è®¡å‰©ä½™æ—¶é—´
            if (processedCount > 0 && startTime) {
                const elapsedMs = Date.now() - startTime;
                const msPerKey = elapsedMs / processedCount;
                const remainingKeys = totalCount - processedCount;
                const remainingMs = remainingKeys * msPerKey;
                
                let timeRemainingText = 'é¢„è®¡å‰©ä½™æ—¶é—´: ';
                
                if (remainingMs < 60000) {
                    // å°‘äº1åˆ†é’Ÿ
                    timeRemainingText += `${Math.round(remainingMs / 1000)}ç§’`;
                } else if (remainingMs < 3600000) {
                    // å°‘äº1å°æ—¶
                    const minutes = Math.floor(remainingMs / 60000);
                    const seconds = Math.round((remainingMs % 60000) / 1000);
                    timeRemainingText += `${minutes}åˆ†${seconds}ç§’`;
                } else {
                    // è¶…è¿‡1å°æ—¶
                    const hours = Math.floor(remainingMs / 3600000);
                    const minutes = Math.floor((remainingMs % 3600000) / 60000);
                    timeRemainingText += `${hours}å°æ—¶${minutes}åˆ†é’Ÿ`;
                }
                
                document.getElementById('time-remaining').textContent = timeRemainingText;
            } else {
                document.getElementById('time-remaining').textContent = 'é¢„è®¡å‰©ä½™æ—¶é—´: è®¡ç®—ä¸­...';
            }
        }
        
        // å®¢æˆ·ç«¯éªŒè¯å¯†é’¥ï¼ˆæµè§ˆå™¨ç«¯éªŒè¯ï¼‰
        async function validateKeysClientSide(keys, progressCallback) {
            validationResults = [];
            const totalKeys = keys.length;
            
            // æ‰¹é‡å¤„ç†
            for (let i = 0; i < keys.length; i += batchSize) {
                if (isPaused) {
                    // å¦‚æœæš‚åœï¼Œç­‰å¾…ç»§ç»­
                    await new Promise(resolve => {
                        const checkPaused = () => {
                            if (!isPaused) resolve();
                            else setTimeout(checkPaused, 500);
                        };
                        checkPaused();
                    });
                }
                
                if (!isValidating) break; // å¦‚æœå–æ¶ˆäº†éªŒè¯
                
                const batch = keys.slice(i, i + batchSize);
                const model = getSelectedModel();
                const batchPromises = batch.map(key => validateSingleKeyClientSide(key, currentApiType, model, validationController.signal));
                
                // ç­‰å¾…å½“å‰æ‰¹æ¬¡å®Œæˆ
                const batchResults = await Promise.all(batchPromises);
                validationResults.push(...batchResults);
                
                // æ›´æ–°è¿›åº¦
                const completedCount = Math.min(i + batchSize, keys.length);
                const progress = (completedCount / totalKeys) * 100;
                progressCallback(progress, `å·²éªŒè¯ ${completedCount}/${totalKeys}`);
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                batchResults.forEach(result => {
                    if (result.valid) validationStats.valid++;
                    else if (result.error_code === 'NETWORK_ERROR') validationStats.error++;
                    else validationStats.invalid++;
                });
                
                updateValidationStats(completedCount, totalKeys);
                
                // æ·»åŠ çŸ­æš‚å»¶è¿Ÿé¿å…APIé™åˆ¶
                if (i + batchSize < keys.length) {
                    // æ ¹æ®æ‰¹æ¬¡å¤§å°è°ƒæ•´å»¶è¿Ÿæ—¶é—´
                    const delay = Math.min(100 + (batchSize * 50), 2000);
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }
        
        // éªŒè¯å•ä¸ªå¯†é’¥ï¼ˆå®¢æˆ·ç«¯ï¼‰
        async function validateSingleKeyClientSide(key, apiType, modelName, signal) {
            const result = {
                key: key,
                valid: false,
                error_code: null,
                error_message: null
            };
            
            // é€‰æ‹©ç«¯ç‚¹
            const config = API_ENDPOINTS[apiType];
            if (!config || !config.models) {
                result.error_code = "CONFIG_ERROR";
                result.error_message = "æ— æ•ˆçš„APIé…ç½®";
                return result;
            }
            
            const endpoint = config.models;
            let headers = {};
            
            // è®¾ç½®ä¸åŒAPIçš„å¤´ä¿¡æ¯
            switch (apiType) {
                case 'openai':
                case 'openai_like':
                    headers = {
                        'Authorization': `Bearer ${key}`,
                        'Content-Type': 'application/json'
                    };
                    break;
                case 'claude':
                    headers = {
                        'x-api-key': key,
                        'anthropic-version': '2023-06-01',
                        'Content-Type': 'application/json'
                    };
                    break;
                case 'gemini':
                    // Geminiä½¿ç”¨æŸ¥è¯¢å‚æ•°è€Œéå¤´éƒ¨
                    headers = {
                        'Content-Type': 'application/json'
                    };
                    break;
                case 'deepseek':
                    headers = {
                        'Authorization': `Bearer ${key}`,
                        'Content-Type': 'application/json'
                    };
                    break;
                case 'xai':
                    headers = {
                        'Authorization': `Bearer ${key}`,
                        'Content-Type': 'application/json'
                    };
                    break;
                default:
                    result.error_code = "UNSUPPORTED_API";
                    result.error_message = `ä¸æ”¯æŒçš„APIç±»å‹: ${apiType}`;
                    return result;
            }
            
            try {
                // ä½¿ç”¨fetchè¿›è¡ŒAPIè°ƒç”¨
                let url = endpoint;
                // å¯¹äºGeminiï¼Œå°†å¯†é’¥ä½œä¸ºURLå‚æ•°
                if (apiType === 'gemini') {
                    url = `${endpoint}?key=${key}`;
                }
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: headers,
                    // ä½¿ç”¨ä¼ å…¥çš„signalï¼Œå¹¶è®¾ç½®20ç§’è¶…æ—¶
                    signal: signal ? signal : AbortSignal.timeout(20000) // 20ç§’è¶…æ—¶
                });
                
                // æ ¹æ®çŠ¶æ€ç ç¡®å®šæœ‰æ•ˆæ€§
                if (response.ok) {
                    result.valid = true;
                } else {
                    // å°è¯•è¯»å–é”™è¯¯ä¿¡æ¯
                    try {
                        const errorData = await response.json();
                        result.error_code = response.status.toString();
                        result.error_message = getErrorMessage(errorData, apiType);
                    } catch (e) {
                        result.error_code = response.status.toString();
                        result.error_message = `HTTPé”™è¯¯: ${response.status}`;
                    }
                }
            } catch (error) {
                // å¦‚æœä¸»ç«¯ç‚¹å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨å®Œæˆç«¯ç‚¹
                try {
                    const completionResult = await validateWithCompletionEndpoint(key, apiType, modelName, signal);
                    return completionResult;
                } catch (secondError) {
                    result.error_code = 'NETWORK_ERROR';
                    result.error_message = `ç½‘ç»œé”™è¯¯: ${error.message || error.name || 'æœªçŸ¥é”™è¯¯'}`;
                }
            }
            
            return result;
        }
        
        // ä½¿ç”¨å®Œæˆç«¯ç‚¹è¿›è¡ŒéªŒè¯ï¼ˆå¤‡ç”¨æ–¹æ³•ï¼‰
        async function validateWithCompletionEndpoint(key, apiType, modelName, signal) {
            const result = {
                key: key,
                valid: false,
                error_code: null,
                error_message: null
            };
            
            // è·å–é…ç½®
            const config = API_ENDPOINTS[apiType];
            if (!config || !config.completions) {
                result.error_code = "CONFIG_ERROR";
                result.error_message = "æ— æ•ˆçš„APIé…ç½®";
                return result;
            }
            
            let headers = {};
            
            // è®¾ç½®ä¸åŒAPIçš„å¤´ä¿¡æ¯
            switch (apiType) {
                case 'openai':
                case 'openai_like':
                case 'deepseek':
                case 'xai':
                    headers = {
                        'Authorization': `Bearer ${key}`,
                        'Content-Type': 'application/json'
                    };
                    break;
                case 'claude':
                    headers = {
                        'x-api-key': key,
                        'anthropic-version': '2023-06-01',
                        'Content-Type': 'application/json'
                    };
                    break;
                case 'gemini':
                    headers = {
                        'Content-Type': 'application/json'
                    };
                    break;
                default:
                    result.error_code = "UNSUPPORTED_API";
                    result.error_message = `ä¸æ”¯æŒçš„APIç±»å‹: ${apiType}`;
                    return result;
            }
            
            try {
                // ä½¿ç”¨fetchè¿›è¡ŒAPIè°ƒç”¨
                let url = config.completions;
                if (apiType === 'gemini') {
                    url = `${url}?key=${key}`;
                }
                
                const payload = config.payload(modelName);
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(payload),
                    // ä½¿ç”¨ä¼ å…¥çš„signalï¼Œå¹¶è®¾ç½®30ç§’è¶…æ—¶
                    signal: signal ? signal : AbortSignal.timeout(30000) // 30ç§’è¶…æ—¶
                });
                
                // æ ¹æ®çŠ¶æ€ç ç¡®å®šæœ‰æ•ˆæ€§
                if (response.ok) {
                    result.valid = true;
                } else {
                    // å°è¯•è¯»å–é”™è¯¯ä¿¡æ¯
                    try {
                        const errorData = await response.json();
                        result.error_code = response.status.toString();
                        
                        // ç‰¹æ®Šæƒ…å†µï¼š401ä½†æ¶ˆæ¯æŒ‡æ˜æ— æ•ˆAPIå¯†é’¥
                        if (response.status === 401 || 
                            errorData.error?.message?.includes('key') || 
                            errorData.error?.includes('key') ||
                            errorData.error?.message?.includes('auth')) {
                            result.error_message = 'æ— æ•ˆçš„APIå¯†é’¥';
                        } else {
                            result.error_message = getErrorMessage(errorData, apiType);
                        }
                    } catch (e) {
                        result.error_code = response.status.toString();
                        result.error_message = `HTTPé”™è¯¯: ${response.status}`;
                    }
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    throw error; // é‡æ–°æŠ›å‡ºä¸­æ­¢é”™è¯¯ï¼Œè®©ä¸Šå±‚å¤„ç†
                }
                
                result.error_code = 'NETWORK_ERROR';
                result.error_message = `ç½‘ç»œé”™è¯¯: ${error.message || error.name || 'æœªçŸ¥é”™è¯¯'}`;
            }
            
            return result;
        }
        
        // ä»é”™è¯¯å“åº”ä¸­æå–æ¶ˆæ¯
        function getErrorMessage(errorData, apiType) {
            switch (apiType) {
                case 'openai':
                case 'openai_like':
                case 'deepseek':
                case 'xai':
                    return errorData.error?.message || 'æœªçŸ¥é”™è¯¯';
                case 'claude':
                    return errorData.error?.message || errorData.detail || 'æœªçŸ¥é”™è¯¯';
                case 'gemini':
                    return errorData.error?.message || errorData.error || 'æœªçŸ¥é”™è¯¯';
                default:
                    return 'æœªçŸ¥é”™è¯¯';
            }
        }
        
        // æœåŠ¡å™¨ç«¯éªŒè¯å¯†é’¥
        async function validateKeysServerSide(keys, progressCallback) {
            try {
                const formData = new FormData();
                formData.append('input_method', 'text');
                formData.append('keys', keys.join('\n'));
                formData.append('api_type', currentApiType);
                formData.append('model', getSelectedModel());
                
                // å¯¹äºopenai_likeï¼Œæ·»åŠ è‡ªå®šä¹‰é…ç½®
                if (currentApiType === 'openai_like') {
                    const customConfig = getCustomApiConfig();
                    if (!customConfig) {
                        throw new Error('è¯·æä¾›æœ‰æ•ˆçš„è‡ªå®šä¹‰API URLå’Œæ¨¡å‹åç§°');
                    }
                    
                    formData.append('custom_api_url', customConfig.custom_api_url);
                    formData.append('custom_model_name', customConfig.custom_model_name);
                }
                
                const response = await fetch('/validate', {
                    method: 'POST',
                    body: formData,
                    signal: validationController.signal
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'æœåŠ¡å™¨éªŒè¯å¤±è´¥');
                }
                
                const data = await response.json();
                validationResults = data.results;
                
                // ç»Ÿè®¡æœ‰æ•ˆ/æ— æ•ˆæ•°é‡
                validationStats.valid = validationResults.filter(r => r.valid).length;
                validationStats.invalid = validationResults.filter(r => !r.valid && r.error_code !== 'NETWORK_ERROR').length;
                validationStats.error = validationResults.filter(r => r.error_code === 'NETWORK_ERROR').length;
                
                // å®Œæˆè¿›åº¦
                progressCallback(100, 'éªŒè¯å®Œæˆ');
                updateValidationStats(keys.length, keys.length);
                
                // å®ŒæˆéªŒè¯
                finishValidation();
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.log('æœåŠ¡å™¨éªŒè¯è¢«å–æ¶ˆ');
                } else {
                    alert(`éªŒè¯å¤±è´¥: ${error.message}`);
                    document.getElementById('progress-container').style.display = 'none';
                    document.getElementById('validate-btn').disabled = false;
                    isValidating = false;
                }
            }
        }
        
        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(percentage, text) {
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const progressPercentage = document.getElementById('progress-percentage');
            
            progressBar.style.width = `${percentage}%`;
            progressText.textContent = text;
            progressPercentage.textContent = `${Math.round(percentage)}%`;
        }
        
        // æ˜¾ç¤ºéªŒè¯ç»“æœ
        function displayResults() {
            if (validationResults.length === 0) {
                initializeEmptyResults();
                return;
            }
            
            // éšè—ç©ºç»“æœæç¤ºï¼Œæ˜¾ç¤ºç»“æœè¡¨æ ¼
            document.getElementById('results-empty').style.display = 'none';
            document.getElementById('results-table').style.display = 'table';
            
            // ç»Ÿè®¡æ•°æ®
            const total = validationResults.length;
            const valid = validationResults.filter(r => r.valid).length;
            const invalid = total - valid;
            
            // æ›´æ–°æ‘˜è¦
            document.getElementById('total-count').textContent = total;
            document.getElementById('valid-count').textContent = valid;
            document.getElementById('invalid-count').textContent = invalid;
            
            // ç”Ÿæˆè¡¨æ ¼è¡Œ
            const tableBody = document.getElementById('results-body');
            tableBody.innerHTML = '';
            
            validationResults.forEach(result => {
                const row = document.createElement('tr');
                
                // å¯†é’¥å•å…ƒæ ¼ï¼ˆéšè—éƒ¨åˆ†å­—ç¬¦ï¼‰
                const keyCell = document.createElement('td');
                keyCell.textContent = maskApiKey(result.key);
                row.appendChild(keyCell);
                
                // çŠ¶æ€å•å…ƒæ ¼
                const statusCell = document.createElement('td');
                if (result.valid) {
                    statusCell.innerHTML = '<span class="valid-key">æœ‰æ•ˆ</span>';
                } else if (result.error_code === 'NETWORK_ERROR' || result.error_code === 'CONNECTION_ERROR' || result.error_code === 'TIMEOUT') {
                    statusCell.innerHTML = '<span class="network-error">ç½‘ç»œé”™è¯¯</span>';
                } else {
                    statusCell.innerHTML = '<span class="invalid-key">æ— æ•ˆ</span>';
                }
                row.appendChild(statusCell);
                
                // é”™è¯¯ä¿¡æ¯å•å…ƒæ ¼
                const errorCell = document.createElement('td');
                errorCell.textContent = result.error_message || '-';
                row.appendChild(errorCell);
                
                tableBody.appendChild(row);
            });
        }
        
        // éšè—éƒ¨åˆ†APIå¯†é’¥å­—ç¬¦
        function maskApiKey(key) {
            if (!key || key.length < 8) return key;
            
            const firstFour = key.slice(0, 4);
            const lastFour = key.slice(-4);
            return `${firstFour}...${lastFour}`;
        }
        
        // å¯¼å‡ºç»“æœ (æ–°ç‰ˆæœ¬æ”¯æŒä¸¤ç§å¯¼å‡ºæ¨¡å¼)
        async function exportResults(exportType) {
            if (validationResults.length === 0) {
                alert('æ²¡æœ‰ç»“æœå¯å¯¼å‡º');
                return;
            }
            
            try {
                // é€šè¿‡APIå¯¼å‡º
                if (!isClientSideValidation) {
                    // åˆ›å»ºè¯·æ±‚æ•°æ®
                    const requestData = {
                        results: validationResults,
                        export_type: exportType, // 'all' æˆ– 'valid'
                        api_type: currentApiType
                    };
                    
                    // å‘é€è¯·æ±‚
                    const response = await fetch('/export', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestData)
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'å¯¼å‡ºå¤±è´¥');
                    }
                    
                    // è·å–æ–‡ä»¶å
                    const contentDisposition = response.headers.get('Content-Disposition');
                    let fileName = `${currentApiType}_keys_validation_${exportType}.csv`;
                    if (contentDisposition) {
                        const match = contentDisposition.match(/filename="?([^"]+)"?/);
                        if (match && match[1]) {
                            fileName = match[1];
                        }
                    }
                    
                    // ä¸‹è½½æ–‡ä»¶
                    const blob = await response.blob();
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = fileName;
                    link.click();
                    URL.revokeObjectURL(url);
                } else {
                    // å®¢æˆ·ç«¯ç”Ÿæˆå¯¼å‡ºæ–‡ä»¶
                    if (exportType === 'valid') {
                        // åªå¯¼å‡ºæœ‰æ•ˆå¯†é’¥ä¸ºçº¯æ–‡æœ¬æ ¼å¼ï¼Œæ¯è¡Œä¸€ä¸ª
                        const validKeys = validationResults
                            .filter(r => r.valid)
                            .map(r => r.key);
                        
                        if (validKeys.length === 0) {
                            alert('æ²¡æœ‰æœ‰æ•ˆçš„å¯†é’¥å¯å¯¼å‡º');
                            return;
                        }
                        
                        const textContent = validKeys.join('\n');
                        const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8;' });
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `${currentApiType}_valid_keys_${getFormattedDate()}.txt`;
                        link.click();
                        URL.revokeObjectURL(url);
                    } else {
                        // å¯¼å‡ºæ‰€æœ‰ç»“æœä¸ºCSVæ ¼å¼(ä¿æŒåŸæœ‰åŠŸèƒ½)
                        let csvContent = 'APIå¯†é’¥,çŠ¶æ€,é”™è¯¯ä»£ç ,é”™è¯¯ä¿¡æ¯\n';
                        
                        validationResults.forEach(result => {
                            const status = result.valid ? 'æœ‰æ•ˆ' : 'æ— æ•ˆ';
                            const errorCode = result.error_code || '';
                            const errorMessage = result.error_message || '';
                            
                            // æ­£ç¡®å¤„ç†CSVæ ¼å¼
                            const escapedKey = `"${result.key.replace(/"/g, '""')}"`;
                            const escapedMessage = `"${errorMessage.replace(/"/g, '""')}"`;
                            
                            csvContent += `${escapedKey},${status},${errorCode},${escapedMessage}\n`;
                        });
                        
                        // åˆ›å»ºå¹¶ä¸‹è½½æ–‡ä»¶
                        const blob = new Blob([new Uint8Array([0xEF, 0xBB, 0xBF]), csvContent], { type: 'text/csv;charset=utf-8;' });
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `${currentApiType}_all_results_${getFormattedDate()}.csv`;
                        link.click();
                        URL.revokeObjectURL(url);
                    }
                }
            } catch (error) {
                alert(`å¯¼å‡ºå¤±è´¥: ${error.message}`);
            }
        }
        
        // è·å–æ ¼å¼åŒ–æ—¥æœŸ
        function getFormattedDate() {
            const date = new Date();
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}${month}${day}`;
        }
        
        // è·å–æµè§ˆå™¨åç§°
        function getBrowserName(userAgent) {
            if (userAgent.indexOf("Firefox") > -1) return "Firefox";
            if (userAgent.indexOf("Opera") > -1 || userAgent.indexOf("OPR") > -1) return "Opera";
            if (userAgent.indexOf("Trident") > -1) return "Internet Explorer";
            if (userAgent.indexOf("Edge") > -1) return "Edge";
            if (userAgent.indexOf("Chrome") > -1) return "Chrome";
            if (userAgent.indexOf("Safari") > -1) return "Safari";
            return "Unknown";
        }
        
        // è·å–æ“ä½œç³»ç»Ÿåç§°
        function getOSName(userAgent) {
            if (userAgent.indexOf("Win") > -1) return "Windows";
            if (userAgent.indexOf("Mac") > -1) return "MacOS";
            if (userAgent.indexOf("Linux") > -1) return "Linux";
            if (userAgent.indexOf("Android") > -1) return "Android";
            if (userAgent.indexOf("iOS") > -1 || userAgent.indexOf("iPhone") > -1 || userAgent.indexOf("iPad") > -1) return "iOS";
            return "Unknown";
        }
        
        // ä¿å­˜ç”¨æˆ·è®¾ç½®
        function saveUserSettings() {
            const settings = {
                currentApiType: currentApiType,
                isClientSideValidation: isClientSideValidation,
                batchSize: batchSize,
                concurrencyEnabled: concurrencyEnabled,
                concurrencyCount: concurrencyCount,
                autoDetectModels: autoDetectModels
            };
            
            localStorage.setItem('userSettings', JSON.stringify(settings));
        }
        
        // è®¾ç½®ä¿å­˜è®¾ç½®çš„äº‹ä»¶ç›‘å¬å™¨
        function setupSettingsSaving() {
            // æ‰¹é‡å¤§å°æ»‘å—
            document.getElementById('batch-size-slider').addEventListener('change', saveUserSettings);
            document.getElementById('batch-size-input').addEventListener('change', saveUserSettings);
            
            // å¹¶å‘è®¾ç½®
            document.getElementById('concurrency-toggle').addEventListener('change', saveUserSettings);
            document.getElementById('concurrency-input').addEventListener('change', saveUserSettings);
            
            // å®¢æˆ·ç«¯éªŒè¯
            document.getElementById('client-side-toggle').addEventListener('change', saveUserSettings);
            
            // è‡ªåŠ¨æ£€æµ‹æ¨¡å‹
            document.getElementById('auto-detect-toggle').addEventListener('change', saveUserSettings);
        }
        
        // åŠ è½½ç”¨æˆ·è®¾ç½®
        function loadUserSettings() {
            const settingsJson = localStorage.getItem('userSettings');
            if (!settingsJson) return;
            
            try {
                const settings = JSON.parse(settingsJson);
                
                // åŠ è½½APIç±»å‹
                if (settings.currentApiType) {
                    currentApiType = settings.currentApiType;
                    
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    document.querySelectorAll('.api-type-btn').forEach(btn => {
                        if (btn.dataset.apiType === currentApiType) {
                            btn.classList.add('active');
                        } else {
                            btn.classList.remove('active');
                        }
                    });
                    
                    // æ›´æ–°è®¾ç½®æ˜¾ç¤º
                    document.querySelectorAll('.api-settings').forEach(setting => {
                        setting.style.display = setting.id === `${currentApiType}-settings` ? 'block' : 'none';
                    });
                }
                
                // åŠ è½½å®¢æˆ·ç«¯éªŒè¯è®¾ç½®
                if (typeof settings.isClientSideValidation === 'boolean') {
                    isClientSideValidation = settings.isClientSideValidation;
                    document.getElementById('client-side-toggle').checked = isClientSideValidation;
                }
                
                // åŠ è½½æ‰¹é‡å¤§å°è®¾ç½®
                if (settings.batchSize) {
                    batchSize = settings.batchSize;
                    document.getElementById('batch-size-slider').value = batchSize;
                    document.getElementById('batch-size-input').value = batchSize;
                }
                
                // åŠ è½½å¹¶å‘è®¾ç½®
                if (typeof settings.concurrencyEnabled === 'boolean') {
                    concurrencyEnabled = settings.concurrencyEnabled;
                    document.getElementById('concurrency-toggle').checked = concurrencyEnabled;
                    document.getElementById('concurrency-controls').style.display = concurrencyEnabled ? 'flex' : 'none';
                }
                
                if (settings.concurrencyCount) {
                    concurrencyCount = settings.concurrencyCount;
                    document.getElementById('concurrency-input').value = concurrencyCount;
                }
                
                // åŠ è½½è‡ªåŠ¨æ£€æµ‹æ¨¡å‹è®¾ç½®
                if (typeof settings.autoDetectModels === 'boolean') {
                    autoDetectModels = settings.autoDetectModels;
                    document.getElementById('auto-detect-toggle').checked = autoDetectModels;
                }
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·è®¾ç½®å¤±è´¥:', error);
            }
        }
        
        // æŸ¥è¯¢å¯ç”¨çš„æ¨¡å‹
        async function detectAvailableModels(keys, apiType) {
            if (!autoDetectModels || modelDetectionInProgress) return;
            
            // æ£€æŸ¥æ˜¯å¦æœ‰è¯¥APIç±»å‹çš„æ¨¡å‹é€‰æ‹©å™¨
            const modelSelect = document.getElementById(`${apiType}-model`);
            if (!modelSelect) return;
            
            // å°†é€‰æ‹©å™¨ç½®ä¸º"åŠ è½½ä¸­"çŠ¶æ€
            modelDetectionInProgress = true;
            const loadingOption = modelSelect.querySelector('option[value="loading"]');
            if (loadingOption) {
                loadingOption.style.display = 'block';
                modelSelect.value = 'loading';
            }
            
            try {
                // åªä½¿ç”¨ç¬¬ä¸€ä¸ªå¯†é’¥è¿›è¡Œæ£€æµ‹
                const key = keys[0];
                
                // æ ¹æ®ä¸åŒAPIç±»å‹è®¾ç½®è¯·æ±‚å‚æ•°
                let url, headers;
                
                switch (apiType) {
                    case 'openai':
                        url = 'https://api.openai.com/v1/models';
                        headers = { 'Authorization': `Bearer ${key}` };
                        break;
                    case 'claude':
                        url = 'https://api.anthropic.com/v1/models';
                        headers = { 
                            'x-api-key': key,
                            'anthropic-version': '2023-06-01'
                        };
                        break;
                    case 'gemini':
                        url = `https://generativelanguage.googleapis.com/v1beta/models?key=${key}`;
                        headers = {};
                        break;
                    case 'deepseek':
                        url = 'https://api.deepseek.com/v1/models';
                        headers = { 'Authorization': `Bearer ${key}` };
                        break;
                    case 'xai':
                        url = 'https://api.xai.com/v1/models';
                        headers = { 'Authorization': `Bearer ${key}` };
                        break;
                    case 'openai_like':
                        if (!API_ENDPOINTS.openai_like.models) {
                            throw new Error('è¯·æä¾›æœ‰æ•ˆçš„è‡ªå®šä¹‰API URL');
                        }
                        url = API_ENDPOINTS.openai_like.models;
                        headers = { 'Authorization': `Bearer ${key}` };
                        break;
                    default:
                        throw new Error(`ä¸æ”¯æŒçš„APIç±»å‹: ${apiType}`);
                }
                
                console.log(`å°è¯•è·å–${apiType}çš„æ¨¡å‹åˆ—è¡¨ï¼ŒURL: ${url}`);
                
                // å‘é€è¯·æ±‚
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 15000); // å¢åŠ è¶…æ—¶æ—¶é—´åˆ°15ç§’
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: headers,
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`HTTP error: ${response.status}`);
                }
                
                const data = await response.json();
                let models = [];
                
                // æ ¹æ®ä¸åŒAPIç±»å‹è§£æè¿”å›æ•°æ®
                switch (apiType) {
                    case 'openai':
                    case 'deepseek':
                    case 'xai':
                    case 'openai_like':
                        models = data.data
                            .filter(model => model.id)
                            .map(model => model.id);
                        break;
                    case 'claude':
                        models = data.models
                            .filter(model => model.id)
                            .map(model => model.id);
                        break;
                    case 'gemini':
                        models = data.models
                            .filter(model => model.name)
                            .map(model => {
                                // ä»å…¨åä¸­æå–æ¨¡å‹åç§°
                                const nameParts = model.name.split('/');
                                return nameParts[nameParts.length - 1];
                            });
                        break;
                }
                
                // æ›´æ–°æ¨¡å‹é€‰æ‹©å™¨
                if (models.length > 0) {
                    console.log(`æˆåŠŸè·å–åˆ°${apiType}çš„${models.length}ä¸ªæ¨¡å‹`);
                    
                    // ä¿å­˜å½“å‰é€‰ä¸­çš„å€¼
                    const currentValue = modelSelect.value;
                    
                    // æ¸…é™¤é™¤äº†ç‰¹æ®Šé€‰é¡¹å¤–çš„æ‰€æœ‰é€‰é¡¹
                    const options = Array.from(modelSelect.options);
                    options.forEach(option => {
                        if (!['loading', 'failed'].includes(option.value)) {
                            modelSelect.removeChild(option);
                        }
                    });
                    
                    // æ·»åŠ æ£€æµ‹åˆ°çš„æ¨¡å‹é€‰é¡¹
                    models.forEach(modelId => {
                        const option = document.createElement('option');
                        option.value = modelId;
                        option.textContent = modelId;
                        
                        // å°†æ¨¡å‹é€‰é¡¹æ’å…¥åˆ°ç‰¹æ®Šé€‰é¡¹ä¹‹å‰
                        const loadingOption = modelSelect.querySelector('option[value="loading"]');
                        modelSelect.insertBefore(option, loadingOption);
                    });
                    
                    // å°è¯•æ¢å¤ä¹‹å‰é€‰ä¸­çš„å€¼ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™é€‰æ‹©ç¬¬ä¸€ä¸ª
                    if (models.includes(currentValue) && currentValue !== 'loading' && currentValue !== 'failed') {
                        modelSelect.value = currentValue;
                    } else {
                        modelSelect.value = models[0];
                    }
                    
                    // å­˜å‚¨å¯ç”¨æ¨¡å‹åˆ—è¡¨
                    availableModels[apiType] = models;
                } else {
                    throw new Error('æœªæ£€æµ‹åˆ°ä»»ä½•å¯ç”¨æ¨¡å‹');
                }
            } catch (error) {
                console.error(`æ£€æµ‹${apiType}æ¨¡å‹å¤±è´¥:`, error);
                
                // æ˜¾ç¤ºå¤±è´¥é€‰é¡¹
                const failedOption = modelSelect.querySelector('option[value="failed"]');
                if (failedOption) {
                    failedOption.style.display = 'block';
                    modelSelect.value = 'failed';
                }
            } finally {
                // éšè—åŠ è½½é€‰é¡¹
                const loadingOption = modelSelect.querySelector('option[value="loading"]');
                if (loadingOption) {
                    loadingOption.style.display = 'none';
                }
                
                modelDetectionInProgress = false;
            }
        }
        
        // æ ¹æ®å±å¹•é«˜åº¦è°ƒæ•´ä¾§è¾¹æ é«˜åº¦
        function adjustSidebarHeight() {
            const settingsSidebar = document.getElementById('settings-sidebar');
            const viewportHeight = window.innerHeight;
            // è®¾ç½®æœ€å¤§é«˜åº¦ä¸ºè§†å£é«˜åº¦å‡å»20pxçš„è¾¹è·
            settingsSidebar.style.maxHeight = (viewportHeight - 20) + 'px';
            settingsSidebar.style.overflowY = 'auto';
        }
        
        // ç›‘å¬çª—å£å¤§å°å˜åŒ–äº‹ä»¶ï¼ŒåŠ¨æ€è°ƒæ•´ä¾§è¾¹æ é«˜åº¦
        window.addEventListener('resize', function() {
            const settingsSidebar = document.getElementById('settings-sidebar');
            // åªæœ‰å½“ä¾§è¾¹æ æ‰“å¼€æ—¶æ‰è°ƒæ•´é«˜åº¦
            if (settingsSidebar.style.left === '0px') {
                adjustSidebarHeight();
            }
        });
        
        // å…³é—­ä¾§è¾¹æ å‡½æ•°
        function closeSidebar() {
            const settingsSidebar = document.getElementById('settings-sidebar');
            const settingsOverlay = document.getElementById('settings-overlay');
            
            settingsSidebar.style.left = '-400px'; // å¢åŠ å®½åº¦ï¼Œç¡®ä¿å®Œå…¨éšè—
            settingsOverlay.style.display = 'none';
            localStorage.setItem('settingsSidebarOpen', 'false');
            
            // æ˜¾ç¤ºè®¾ç½®å·²ä¿å­˜æç¤º
            showToast('è®¾ç½®å·²è‡ªåŠ¨ä¿å­˜', 'success');
        }
        
        // ä¾§è¾¹æ æ§åˆ¶
        const toastNotification = document.getElementById('toast-notification');
        
        // æ˜¾ç¤ºå¼¹å¹•é€šçŸ¥
        function showToast(message) {
            if (message) {
                toastNotification.textContent = message;
            }
            toastNotification.classList.add('show');
            
            setTimeout(() => {
                toastNotification.classList.add('hide');
                setTimeout(() => {
                    toastNotification.classList.remove('show');
                    toastNotification.classList.remove('hide');
                }, 500);
            }, 3000);
        }
        
        // æ›´æ–°å…³é—­ä¾§è¾¹æ çš„ä»£ç ï¼Œæ·»åŠ å¼¹å¹•é€šçŸ¥
        function closeSidebar() {
            const settingsSidebar = document.getElementById('settings-sidebar');
            const settingsOverlay = document.getElementById('settings-overlay');
            settingsSidebar.style.left = '-400px';
            settingsOverlay.style.display = 'none';
            // æ˜¾ç¤ºè®¾ç½®å·²ä¿å­˜çš„å¼¹å¹•æç¤º
            showToast('è®¾ç½®å·²è‡ªåŠ¨ä¿å­˜');
            localStorage.setItem('settingsSidebarOpen', 'false');
        }
        
        // æ‰“å¼€ä¾§è¾¹æ 
        settingsGearBtn.addEventListener('click', function() {
            settingsSidebar.style.left = '0';
            settingsOverlay.style.display = 'block';
            localStorage.setItem('settingsSidebarOpen', 'true');
            
            // æ ¹æ®å±å¹•é«˜åº¦è°ƒæ•´ä¾§è¾¹æ é«˜åº¦ï¼Œé¿å…å‡ºç°æ»šåŠ¨æ¡
            adjustSidebarHeight();
        });
        
        // å…³é—­ä¾§è¾¹æ  - ç‚¹å‡»å…³é—­æŒ‰é’®
        settingsCloseBtn.addEventListener('click', closeSidebar);
        
        // å…³é—­ä¾§è¾¹æ  - ç‚¹å‡»é®ç½©å±‚
        settingsOverlay.addEventListener('click', closeSidebar);
        
        // è®¾ç½®ä¿å­˜ç”¨æˆ·è®¾ç½®çš„äº‹ä»¶ç›‘å¬å™¨
        setupSettingsSaving();
        
        // å°è¯•ä»ç¯å¢ƒå˜é‡åŠ è½½ipdata APIå¯†é’¥
        // è¿™æ®µä»£ç ä¼šåœ¨éƒ¨ç½²åˆ°Vercelæ—¶ä»ç¯å¢ƒå˜é‡ä¸­è·å–å¯†é’¥
        try {
            if (typeof process !== 'undefined' && process.env && process.env.IPDATA_API_KEY) {
                ipdataApiKey = process.env.IPDATA_API_KEY;
            }
        } catch (e) {
            console.log('æœªæ£€æµ‹åˆ°Vercelç¯å¢ƒå˜é‡');
        }
    </script>
</body>
</html>